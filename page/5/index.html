<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="b946c5a0bf547c89">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="b946c5a0bf547c89">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Ginger">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>b946c5a0bf547c89</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">b946c5a0bf547c89</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">My Silent Hill</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/08/tcp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo-4-blog.png">
      <meta itemprop="name" content="Ginger">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b946c5a0bf547c89">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/08/tcp/" class="post-title-link" itemprop="url">tcp setting</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-01-08 23:26:29" itemprop="dateCreated datePublished" datetime="2017-01-08T23:26:29+08:00">2017-01-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-01 09:03:27" itemprop="dateModified" datetime="2020-04-01T09:03:27+08:00">2020-04-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2017/01/08/tcp/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/01/08/tcp/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>28k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>25 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="/img/Tcp_state_diagram.png"></a></p>
<h4 id="TCP-timer"><a href="#TCP-timer" class="headerlink" title="TCP timer"></a><a href="http://blog.qiusuo.im/blog/2014/03/19/tcp-timeout/" target="_blank" rel="noopener">TCP timer</a></h4><h5 id="RTT-three-types"><a href="#RTT-three-types" class="headerlink" title="RTT three types"></a><a href="https://www.geeksforgeeks.org/tcp-timers/" target="_blank" rel="noopener">RTT three types</a></h5><p>Measured RTT(RTTm) – The measured round-trip time for a segment is the time required for the segment to reach the destination and be acknowledged, although the acknowledgment may include other segments.</p>
<p>Smoothed RTT(RTTs) – It is the weighted average of RTTm. RTTm is likely to change and its fluctuation is so high that a single measurement cannot be used to calculate RTO.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Initially -&gt; No value</span><br><span class="line">After the first measurement -&gt; RTTs=RTTm</span><br><span class="line">After each measurement -&gt; RTTs= (1-t)*RTTs + t*RTTm</span><br><span class="line">Note: t=1/8 (default <span class="keyword">if</span> not given)</span><br></pre></td></tr></table></figure>

<p>Deviated RTT(RTTd) – Most implementation do not use RTTs alone so RTT deviated is also calculated to find out RTO.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Initially -&gt; No value</span><br><span class="line">After the first measurement -&gt; RTTd&#x3D;RTTm&#x2F;2</span><br><span class="line">After each measurement -&gt; RTTd&#x3D; (1-k)*RTTd + k*(RTTm-RTTs)</span><br><span class="line">Note: k&#x3D;1&#x2F;4 (default if not given)</span><br></pre></td></tr></table></figure>

<h5 id="Retransmission-Timeout"><a href="#Retransmission-Timeout" class="headerlink" title="Retransmission Timeout"></a>Retransmission Timeout</h5><p>RTO calculation – The value of RTO is based on the smoothed round-trip time and its deviation. Most implementations use the following formula to calculate the RTO:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Initial value -&gt; Original (given in question)</span><br><span class="line">After any measurement -&gt; RTO&#x3D;RTTs + 4*RTTd</span><br><span class="line">#NOTE: At every retransmission the value of RTO doubles. ( RTO(new) &#x3D; RTO(before retransmission) *2 ) </span><br><span class="line"></span><br><span class="line">## in linux</span><br><span class="line">tcp_retries1 (integer; default: 3; since Linux 2.2)</span><br><span class="line"></span><br><span class="line">The number of times TCP will attempt to retransmit a packet on an established connection normally, without the extra effort of getting the network layers involved. Once we exceed this number of retransmits, we first have the network layer update the route if possible before each new retransmit. The default is the RFC specified minimum of 3.</span><br><span class="line"></span><br><span class="line">tcp_retries2 (integer; default: 15; since Linux 2.2)</span><br><span class="line"></span><br><span class="line">The maximum number of times a TCP packet is retransmitted in established state before giving up. The default value is 15, which corresponds to a duration of approxi‐mately between 13 to 30 minutes, depending on the retransmission timeout. The RFC 1122 specified minimum limit of 100 seconds is typically deemed too short.</span><br></pre></td></tr></table></figure>

<h5 id="Delayed-ACK-Timer"><a href="#Delayed-ACK-Timer" class="headerlink" title="Delayed ACK Timer"></a>Delayed ACK Timer</h5><p>If reach the timeout, reply the ACK, if in the timeout range, it will wait data to transmit, 200 ms in Microsoft Windows by default</p>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_for_real_time/7/html/tuning_guide/reducing_the_tcp_delayed_ack_timeout" target="_blank" rel="noopener">In real time system</a></p>
<ul>
<li>This mode is used at the start of a TCP connection so that the congestion window can grow quickly.</li>
<li>The acknowledgment (ACK) timeout interval (ATO) is set to tcp_ato_min, the minimum timeout value.</li>
<li>To change the default TCP ACK timeout value, write the required value in milliseconds to the /proc/sys/net/ipv4/tcp_ato_min file<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo 4 &gt; &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_ato_min</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>Delayed ACK</p>
<ul>
<li>After the connection is established, TCP assumes this mode, in which ACKs for multiple received packets can be sent in a single packet.</li>
<li>ATO is set to tcp_delack_min to restart or reset the timer.</li>
<li>To change the default TCP Delayed ACK value, write the required value in milliseconds to the /proc/sys/net/ipv4/tcp_delack_min file:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> 4 &gt; /proc/sys/net/ipv4/tcp_delack_min</span><br></pre></td></tr></table></figure>
TCP switches between the two modes depending on the current congestion.<br>Some applications that send small network packets could experience latencies due to the TCP quick and delayed acknowledgment timeouts, which previously were 40 ms by default. That means small packets from an application that seldom sends information through the network could experience a delay up to 40 ms to receive the acknowledgment that a packet has been received by the other side. To minimize this issue, both tcp_ato_min and tcp_delack_min timeouts are now 4 ms by default.</li>
</ul>
<h5 id="Persist-Timer"><a href="#Persist-Timer" class="headerlink" title="Persist Timer"></a>Persist Timer</h5><p>When receive the zero window, stop to transmit data.<br>In tcp, just confirm data package, it ‘s not confirm the ack (no data) package. if the B transmit the ack(no data) loss, the B is waitting to get some data from A(the ack loss, and it tell A that it ‘s not the zero window ),but the A is waitting the data for update window size from B. It ‘s the deadlock case.<br>When the A receive the zero window notice, the A will start a persist timer to send the ack in the time interval. the segment to detect TCP Zero Window</p>
<p>The RFC1122 suggest the window probe timer is RTO</p>
<h5 id="Keepalive-Timer"><a href="#Keepalive-Timer" class="headerlink" title="Keepalive Timer"></a>Keepalive Timer</h5><p>In the tcp_keepalive_intvl, the server will send the Probe Segment to make sure the other side is online ? if no respond, it will resend until timeout, if timeout that means the other side has crash.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tcp_keepalive_intvl (<span class="built_in">integer</span>; default: 75; since Linux 2.4)</span><br><span class="line">The number of seconds between TCP keep-alive probes.</span><br><span class="line"></span><br><span class="line">tcp_keepalive_probes (<span class="built_in">integer</span>; default: 9; since Linux 2.2)</span><br><span class="line">The maximum number of TCP keep-alive probes to send before giving up and killing the connection <span class="keyword">if</span> no response is obtained from the other end.</span><br><span class="line"></span><br><span class="line">tcp_keepalive_time (<span class="built_in">integer</span>; default: 7200; since Linux 2.2)</span><br><span class="line">The number of seconds a connection needs to be idle before TCP begins sending out keep-alive probes. Keep-alives are only sent when the SO_KEEPALIVE socket option is enabled. The default value is 7200 seconds (2 hours). An idle connection is terminated after approximately an additional 11 minutes (9 probes an interval of 75 sec‐onds apart) when keep-alive is enabled.</span><br></pre></td></tr></table></figure>

<h5 id="FIN-WAIT-2-Timer"><a href="#FIN-WAIT-2-Timer" class="headerlink" title="FIN_WAIT_2 Timer"></a>FIN_WAIT_2 Timer</h5><p>The activer try to disable the tcp connection, send the FIN and get the ACK, the activer to convert the FIN_WAIT_1 to FIN_WAIT_2 and it could not send any data, just wait the FIN from the client. if the client down or don’t send the FIN to the activer, same with Dos attack.<br>If timeout, give up the tcp connection.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcp_fin_timeout (<span class="built_in">integer</span>; default: 60; since Linux 2.2)</span><br><span class="line">This specifies how many seconds to <span class="built_in">wait</span> <span class="keyword">for</span> a final FIN packet before the socket is forcibly closed. This is strictly a violation of the TCP specification, but required to prevent denial-of-service attacks. In Linux 2.2, the default value was 180.</span><br></pre></td></tr></table></figure>

<h5 id="TIME-WAIT-Timer"><a href="#TIME-WAIT-Timer" class="headerlink" title="TIME_WAIT Timer"></a>TIME_WAIT Timer</h5><p>timeout = 2xMSL<br>Linux was net.ipv4.tcp_fin_timeout = 60</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TCP_TIMEWAIT_LEN (60*HZ) <span class="comment">/* how long to wait to destroy TIME-WAIT</span></span></span><br><span class="line"><span class="meta"><span class="comment">                              * state, about 60 seconds     */</span></span></span><br></pre></td></tr></table></figure>

<p>the server(FIN_WAIT_2) receive the FIN from the client, after the server reply the ACK,the server will convert FIN_WAIT_2 to TIME_WAIT and start the TIME_WAIT timer<br>and the ack loss, when the client will retrans the FIN to the server. </p>
<ol>
<li><p>if the server not in TIME_WAIT, if the port re-use for another application, maybe the application will go to the wrong state. if the connection in the TIME_WAIT state, it ‘s OK.<br>So the TIME_WAIT must be a long time enough, to avoid the wandering duplicates</p>
</li>
<li><p>because the ack package loss, if the activer has disable the A tcp connection, the client is waitting the ack. if the activer want create a new tcp connection to use the same port, the activer will send the SYN packet, the client is waitting the ack, the client will reply the RST cause the new connection interrupt </p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">When the persist timer expires, 1 byte of data is sent(segment 6). The receiving application has <span class="built_in">read</span> 256 bytes from the receivebuffer (at time 3.99), so the byte is accepted and acknowledged (segment 7).But the advertised window is still 0, since the receiver does not have room foreither one full-sized segment or one-half of its buffer. This is silly windowavoidance by the receiver.</span><br><span class="line"></span><br><span class="line">tcp_rcv_state_process</span><br><span class="line">    |--&gt;tcp_time_wait</span><br><span class="line">           |--&gt;inet_twsk_alloc</span><br><span class="line">           |      |--&gt;setup_pinned_timer(&amp;tw-&gt;tw_timer, tw_timer_handler,(unsigned long)tw);</span><br><span class="line">           |--&gt;__inet_twsk_schedule(tw, timeo, <span class="literal">false</span>);</span><br><span class="line">                  |--&gt;mod_timer(&amp;tw-&gt;tw_timer, jiffies + timeo);</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line"><span class="comment"># TIME_WAIT port use the new tcp connection</span></span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line"><span class="comment"># In some NAT/loading balancing env cause DROP the SYN packet and reply the RST</span></span><br><span class="line"><span class="comment"># remove from linux kernel 4.10</span></span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_fin_timeout = 60</span><br><span class="line">net.ipv4.ip_local_port_range = 32768 60999</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 6000</span><br><span class="line"><span class="comment"># TIME_WAIT socket max number</span></span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"><span class="comment">##### MSL (Maximum Segment Lifetime)</span></span><br><span class="line">	2MSL server/client send the close request <span class="keyword">in</span> the last ack(time <span class="built_in">wait</span> status), timewait = 2MSL ? after timeout ,send fin ? <span class="keyword">in</span> this time, the port could not be used.</span><br><span class="line">	<span class="keyword">if</span> you <span class="built_in">set</span> SO_REUSEPORT, don <span class="string">'t to wait 2MSL to use the port </span></span><br><span class="line"><span class="string">        SO_REUSEPORT (since Linux 3.9)</span></span><br><span class="line"><span class="string">        Permits multiple AF_INET or AF_INET6 sockets to be bound to an identical socket address.  This option must be set on each socket (including the first socket) prior to calling bind(2) on the socket.  To prevent port hijacking, all of the processes binding to the same address must have the same effective UID.  This option can be employed with both TCP an UDP sockets.</span></span><br><span class="line"><span class="string">        the SO_REUSEPORT socket option support was implemented in a series of patches by Tom Herbert. The new socket option allows multiple sockets on the same host to bind to the same port, and is intended to improve the performance of multithreaded network server applications running on top of multicore systems.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">tcp segment (报文) + tcp datagram (data)</span></span><br><span class="line"><span class="string">TTL (time to live) in ip head</span></span><br><span class="line"><span class="string">MSL &gt; TTL ?</span></span><br><span class="line"><span class="string">RTT (round-trip time)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">URG: Urget pointer is valid</span></span><br><span class="line"><span class="string">SYN: </span></span><br><span class="line"><span class="string">FIN: </span></span><br><span class="line"><span class="string">ACK:</span></span><br><span class="line"><span class="string">PSH:</span></span><br><span class="line"><span class="string">RST:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">RST+ACK</span></span><br><span class="line"><span class="string">only RST</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">packets per second (pps)</span></span><br><span class="line"><span class="string">bytes per second (bps)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;!-- more --&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### [tcp_fin_timeout and tcp_max_tw_buckets](https://access.redhat.com/solutions/41776)</span></span><br><span class="line"><span class="string">If you set too large value to tcp_fin_timeout, the system may become out of port, file-descripter and memory. If you set too small value, the system may leak delayed packets.</span></span><br><span class="line"><span class="string">If you set too large value to tcp_max_tw_buckets, the system may become out of port, file-descripter and memory. If you set too small value, the system may not communicate another host.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">TCP(7)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       tcp_fin_timeout (integer; default: 60)</span></span><br><span class="line"><span class="string">              This  specifies  how many seconds to wait for a final FIN packet</span></span><br><span class="line"><span class="string">              before the socket is forcibly closed.  This is strictly a viola-</span></span><br><span class="line"><span class="string">              tion  of  the TCP specification, but required to prevent denial-</span></span><br><span class="line"><span class="string">              of-service attacks.  In Linux 2.2, the default value was 180.</span></span><br><span class="line"><span class="string">&lt;snip&gt;</span></span><br><span class="line"><span class="string">       tcp_max_tw_buckets (integer; default: see below)</span></span><br><span class="line"><span class="string">              The  maximum number of sockets in TIME_WAIT state allowed in the</span></span><br><span class="line"><span class="string">              system.  This limit exists only to prevent simple denial-of-ser-</span></span><br><span class="line"><span class="string">              vice  attacks.   The  default  value  of  NR_FILE*2  is adjusted</span></span><br><span class="line"><span class="string">              depending on the memory  in  the  system.   If  this  number  is</span></span><br><span class="line"><span class="string">              exceeded, the socket is closed and a warning is printed.</span></span><br><span class="line"><span class="string">&lt;snip&gt;</span></span><br><span class="line"><span class="string">       TCP_LINGER2</span></span><br><span class="line"><span class="string">              The  lifetime  of orphaned FIN_WAIT2 state sockets.  This option</span></span><br><span class="line"><span class="string">              can be used to override the system wide  sysctl  tcp_fin_timeout</span></span><br><span class="line"><span class="string">              on  this  socket.  This is not to be confused with the socket(7)</span></span><br><span class="line"><span class="string">              level option SO_LINGER.  This option should not be used in  code</span></span><br><span class="line"><span class="string">              intended to be portable.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### tcpdump</span></span><br><span class="line"><span class="string">```bash</span></span><br><span class="line"><span class="string">tcpdump -n -i eth0 -A -x dst port 443 and greater 100</span></span><br></pre></td></tr></table></figure>

<h3 id="Linux-kernel"><a href="#Linux-kernel" class="headerlink" title="Linux kernel"></a>Linux kernel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">don<span class="string">'t cache ssthresh from previous connection</span></span><br><span class="line"><span class="string">Disable cache metrics so the initial conditions of the closed connections will not be saved to be used in near future connections:</span></span><br><span class="line"><span class="string">net.ipv4.tcp_no_metrics_save = 1</span></span><br><span class="line"><span class="string">'</span>1<span class="string">' means disable caching.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">tcp_slow_start_after_idle = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">tcp_slow_start_after_idle (Boolean; default: enabled(1); since Linux 2.6.18),If enabled, provide RFC 2861 behavior and time out the congestion window after an idle period. An idle period is defined as the current RTO (retransmission timeout). If disabled, the congestion window will not be timed out after an idle period.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string"># Vendors settings live in /usr/lib/sysctl.d/.</span></span><br><span class="line"><span class="string"># To override a whole file, create a new file with the same in</span></span><br><span class="line"><span class="string"># /etc/sysctl.d/ and put new settings there. To override</span></span><br><span class="line"><span class="string"># only specific settings, add a file with a lexically later</span></span><br><span class="line"><span class="string"># name in /etc/sysctl.d/ and put new settings there.</span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string"># For more information, see sysctl.conf(5) and sysctl.d(5).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># each socket will use some fd</span></span><br><span class="line"><span class="string">fs.file-max = 1048576 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># tcp short connection will cause a lot of TIME_WAIT</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_tw_buckets = 7000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># disable tcp source trace</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.accept_source_route = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.tcp_fin_timeout = 30 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#TIMEOUT socket re-use</span></span><br><span class="line"><span class="string">net.ipv4.tcp_tw_reuse= 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_timestamps = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syncookies = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog = 8388608</span></span><br><span class="line"><span class="string">net.core.netdev_max_backlog = 8388608</span></span><br><span class="line"><span class="string">net.core.somaxconn = 8388608</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># in our internal LAN, a lots of out of range and tcp retrans</span></span><br><span class="line"><span class="string">net.ipv4.tcp_sack = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.core.netdev_budget=600</span></span><br><span class="line"><span class="string">net.ipv4.tcp_low_latency = 1</span></span><br><span class="line"><span class="string"># socket buffer to 256MB</span></span><br><span class="line"><span class="string">net.core.rmem_max = 268435456</span></span><br><span class="line"><span class="string">net.core.wmem_max = 268435456</span></span><br><span class="line"><span class="string"># allow tcp ipv4 buffer auto-tuning up to 256MB</span></span><br><span class="line"><span class="string"># min,init,maxinum size</span></span><br><span class="line"><span class="string">net.ipv4.tcp_rmem = 65536 134217728 268435456</span></span><br><span class="line"><span class="string">net.ipv4.tcp_wmem = 65536 134217728 268435456</span></span><br><span class="line"><span class="string">net.ipv4.tcp_mem = 65536 134217728 268435456</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.tcp_adv_win_scale= 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.tcp_window_scaling = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.tcp_mtu_probing= 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.core.default_qdisc = pfifo_fast</span></span><br><span class="line"><span class="string">net.ipv4.tcp_congestion_control = cubic</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">kernel.numa_balancing=0</span></span><br><span class="line"><span class="string">net.ipv4.tcp_frto=1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_no_metrics_save = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_slow_start_after_idle = 0</span></span><br><span class="line"><span class="string">net.ipv4.tcp_mtu_probing = 1</span></span><br><span class="line"><span class="string">#net.ipv4.tcp_syn_retries = 8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># works best with &gt;= 500 client computers ##</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_interval = 3600</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_stale_time = 3600</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh3 = 8192</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh2 = 4096</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh1 = 2048</span></span><br><span class="line"><span class="string"># Keep alive</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_intvl = 60</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_probes = 3</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_time = 7200</span></span><br><span class="line"><span class="string">#net.ipv4.tcp_syn_retries=8</span></span><br><span class="line"><span class="string">##net.ipv4.tcp_keepalive_intvl = 30</span></span><br><span class="line"><span class="string">###net.ipv4.tcp_keepalive_probes = 25</span></span><br><span class="line"><span class="string">###net.ipv4.tcp_keepalive_time = 360</span></span><br></pre></td></tr></table></figure>

<h4 id="tcp-tw-reuse"><a href="#tcp-tw-reuse" class="headerlink" title="tcp_tw_reuse"></a><a href="https://vincent.bernat.ch/en/blog/2014-tcp-time-wait-state-linux" target="_blank" rel="noopener">tcp_tw_reuse</a></h4><p>NOTE: net.ipv4.tcp_tw_recycle has been removed from Linux 4.12<br>Linux will randomize timestamp offsets for each connection, making this option completely broken, with or without NAT. It has been completely removed from Linux 4.12.<br>The LAST-ACK state is handled in the exact same way as for net.ipv4.tcp_tw_recycle.</p>
<p>By enabling net.ipv4.tcp_tw_reuse, Linux will reuse an existing connection in the TIME-WAIT state for a new outgoing connection if the new timestamp is strictly bigger than the most recent timestamp recorded for the previous connection: an outgoing connection in the TIME-WAIT state can be reused after just one second.</p>
<p>   Allow to reuse TIME-WAIT sockets for new connections when it is safe from protocol viewpoint. Default value is 0. It should not be changed without advice/request of technical experts.<br>   The mere result of this lack of documentation is that we find numerous tuning guides advising to set both these settings to 1 to reduce the number of entries in the TIME-WAIT state. However, as stated by tcp(7) manual page, the net.ipv4.tcp_tw_recycle option is quite problematic for public-facing servers as it won’t handle connections from two different computers behind the same NAT device, which is a problem hard to detect and waiting to bite you:<br>   Enable fast recycling of TIME-WAIT sockets. Enabling this option is not recommended since this causes problems when working with NAT (Network Address Translation).<br><img src="/img/tcp-state-diagram-v2.svg" alt=""></p>
<p><img src="/img/duplicate-segment.svg" alt=""><br>Due to a shortened TIME-WAIT state, a delayed TCP segment has been accepted in an unrelated connection.</p>
<p>The other purpose is to ensure the remote end has closed the connection. When the last ACK is lost, the remote end stays in the LAST-ACK state. Without the TIME-WAIT state, a connection could be reopened while the remote end still thinks the previous connection is valid. When it receives a SYN segment (and the sequence number matches), it will answer with a RST as it is not expecting such a segment. The new connection will be aborted with an error<br><img src="/img/last-ack.svg" alt=""><br>If the remote end stays in LAST-ACK state because the last ACK was lost, opening a new connection with the same quadruplet will not work.</p>
<p>RFC 793 requires the TIME-WAIT state to last twice the time of the MSL. On Linux, this duration is not tunable and is defined in include/net/tcp.h as one minute:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define TCP_TIMEWAIT_LEN (60*HZ) /* how long to wait to destroy TIME-WAIT</span></span><br><span class="line">				  * state, about 60 seconds	*/</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ss -tan state time-wait</span><br></pre></td></tr></table></figure>

<p>A hash table of connections, named the “TCP established hash table” (despite containing connections in other states) is used to locate an existing connection, for example when receiving a new segment.</p>
<p>the TIME-WAIT connection in this table</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ dmesg | grep <span class="string">"TCP established hash table"</span></span><br><span class="line">[    1.041036] TCP established <span class="built_in">hash</span> table entries: 524288 (order: 10, 4194304 bytes)</span><br><span class="line">$ dmesg | grep <span class="string">"TCP bind hash table"</span></span><br><span class="line">[    1.041724] TCP <span class="built_in">bind</span> <span class="built_in">hash</span> table entries: 65536 (order: 8, 1048576 bytes)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slabtop -o | grep -E &#39;(^  OBJS|tw_sock_TCP|tcp_bind_bucket)&#39;</span><br></pre></td></tr></table></figure>

<p>If the FIN segments are received in a timely manner, the local end socket will still be in the TIME-WAIT state and the expected ACK segments will be sent.</p>
<p>Once a new connection replaces the TIME-WAIT entry, the SYN segment of the new connection is ignored (thanks to the timestamps) and won’t be answered by a RST but only by a retransmission of the FIN segment. The FIN segment will then be answered with a RST (because the local connection is in the SYN-SENT state) which will allow the transition out of the LAST-ACK state. The initial SYN segment will eventually be resent (after one second) because there was no answer and the connection will be established without apparent error, except a slight delay:<br><img src="/img/last-ack-reuse.svg" alt=""></p>
<h3 id="ethtool"><a href="#ethtool" class="headerlink" title="ethtool"></a><a href="https://voipmagazine.wordpress.com/tag/tcp_no_metrics_save/" target="_blank" rel="noopener">ethtool</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ethtool -s p4p2 speed 1000 duplex full autoneg off</span><br><span class="line">$ grep ETHTOOL_OPTS /etc/sysconfig/network-scripts/ifcfg-p4p1</span><br><span class="line">ETHTOOL_OPTS=speed 1000 duplex full</span><br><span class="line">$ systemctl restart network</span><br><span class="line">$ ifconfig eth0 txqueuelen 3000</span><br></pre></td></tr></table></figure>

<h3 id="SLE-and-SER-in-SACK-RFC2018"><a href="#SLE-and-SER-in-SACK-RFC2018" class="headerlink" title="SLE and SER in SACK(RFC2018)"></a>SLE and SER in SACK(RFC2018)</h3><p>tcpdump will show some packet show “SLE=20480 SER=24576”</p>
<p>SLE: Sequence Left Edge of already acknowledged data when Selective Acknowledgments are used<br>SRE: Sequence Right Edge of already acknowledged data when Selective Acknowledgments are used</p>
<p>When server send the package length from 1<del>24576, the client just return ack=$((seq+18736))<br>The client receive 18736 bytes, and recevice the out of order packets from 20480</del>24576 bytes, and just loss from 18737<del>20479 Bytes<br>The server don ‘t need to retrans 20480 to 24576 bytes. if the system not enable sack, it will retrans from 18737</del>24576</p>
<h3 id="Spurious-retransmission-timeouts"><a href="#Spurious-retransmission-timeouts" class="headerlink" title="Spurious retransmission timeouts"></a>Spurious retransmission timeouts</h3><p>Because packets out of order or another issue trigger the packet RTO, but the packet was not loss, it ‘s misjudging, that means Spurious retransmission timeouts.</p>
<p>Active F-RTO<br>net.ipv4.tcp_frto=2</p>
<h3 id="Thin-stream"><a href="#Thin-stream" class="headerlink" title="Thin-stream"></a><a href="https://nnc3.com/mags/LJ_1994-2014/LJ/219/11180.html" target="_blank" rel="noopener">Thin-stream</a></h3><p>For latency env</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># default eq 0</span></span><br><span class="line">sysctl -w net.ipv4.tcp_thin_linear_timeouts=1</span><br><span class="line">sysctl -w net.ipv4.tcp_thin_dupack=1</span><br><span class="line"><span class="built_in">echo</span> 1 &gt;  /proc/sys/net/ipv4/tcp_thin_linear_timeouts</span><br><span class="line"><span class="built_in">echo</span> 1 &gt;  /proc/sys/net/ipv4/tcp_thin_dupack</span><br></pre></td></tr></table></figure>

<h3 id="tcp-retrans"><a href="#tcp-retrans" class="headerlink" title="tcp retrans"></a><a href="http://perthcharles.github.io/2015/09/07/wiki-tcp-retries/" target="_blank" rel="noopener">tcp retrans</a></h3><p>RTO(retransmission timeout)<br>RRT(round-trip time)<br>TCP keep the weight value SRTT(smoothed RRT)</p>
<p>The latest RRTS = (1-a) * ( last RTTS) + a * (the lastest RRT)<br>In RFC2988, a = 1/8<br>RTTD was the RTT deviation weight value<br>First get RTTD, RTTD value = RRT/2<br>Next the RTTD=(1-B)<em>(the last RTTD) + B(RTTS-the lastest RRT)<br>RFC B=1/4<br>RTO= RTTS + 4</em>RTTD<br>The RFC suggest if the message retrans, this RRT value will be drop<br>When the trigger tcp retrans, the latest RTO * 2 = the last RTO until the maximum</p>
<p>But RFC != the real implementation</p>
<p><a href="https://ms2008.github.io/2017/04/14/tcp-timeout/" target="_blank" rel="noopener">tcp_syn_retries 三次握手</a><br>net.ipv4.tcp_syn_retries retrans interval was [1,3,7,15,31]s </p>
<p>tcp_syn_retries2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if tcp_retries2&#x3D;15，the timeout was 924600ms。</span><br><span class="line"></span><br><span class="line">1. If RTT is tiny that the RTO init value was about 200ms</span><br><span class="line">   The total timeout was 924600ms，looks like retrans 15 times cause over the timeout value and end the tcp stream</span><br><span class="line"></span><br><span class="line">2. If RTT is large,the RTO calculate value was 1000ms</span><br><span class="line">   it doesn&#39; t need retrans 15 times，the timeout value will over 924600ms.</span><br><span class="line">   if the RTT&#x3D;400ms,set tcp_retries2&#x3D;10, only 3 times the tcp stream will end</span><br></pre></td></tr></table></figure>

<h3 id="tcp-retrans-1"><a href="#tcp-retrans-1" class="headerlink" title="tcp retrans"></a>tcp retrans</h3><p>There are 3 server in test env</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ numactl --physcpubind=2 iperf3 -c <span class="variable">$serverC</span> -P 1 -M 8960 -S 0x08 -t 36000 -p 5201 -l 512k</span><br><span class="line">Connecting to host 10.53.19.52, port 5201</span><br><span class="line">[  4] <span class="built_in">local</span> <span class="variable">$ServerB</span> port 58064 connected to <span class="variable">$ServerC</span> port 5201</span><br><span class="line">[ ID] Interval           Transfer     Bandwidth       Retr  Cwnd</span><br><span class="line">[  4]   0.00-1.00   sec  1.15 GBytes  9.92 Gbits/sec    0    690 KBytes</span><br><span class="line">...</span><br><span class="line">[  4]  66.00-67.00  sec  1.15 GBytes  9.90 Gbits/sec    0    717 KBytes</span><br><span class="line">... always no retrans, cwnd increase slowly</span><br><span class="line">[  4] 189.00-190.00 sec  1.15 GBytes  9.89 Gbits/sec    0    725 KBytes</span><br><span class="line">...</span><br><span class="line">[  4] 418.00-419.00 sec  1.15 GBytes  9.89 Gbits/sec    0    909 KBytes</span><br><span class="line">...</span><br><span class="line">[  4] 4195.00-4196.00 sec  1.15 GBytes  9.90 Gbits/sec    0    909 KBytes</span><br><span class="line">[  4] 4196.00-4197.00 sec  1.15 GBytes  9.90 Gbits/sec    0    909 KBytes</span><br><span class="line">[  4] 4197.00-4198.00 sec  1.15 GBytes  9.89 Gbits/sec    0    909 KBytes</span><br><span class="line">[  4] 4198.00-4198.51 sec   606 MBytes  9.91 Gbits/sec    0    909 KBytes</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bandwidth       Retr</span><br><span class="line">[  4]   0.00-4198.51 sec  0.00 (null)s  9.90 Gbits/sec    6             sender</span><br><span class="line">[  4]   0.00-4198.51 sec  0.00 Bytes  0.00 bits/sec                  receiver</span><br><span class="line">iperf3: interrupt - the client has terminated</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ numactl --physcpubind=2 iperf3 -c <span class="variable">$serverA</span> -P 1 -M 8960 -S 0x08 -t 36000 -p 5201 -l 512k</span><br><span class="line"></span><br><span class="line">[  4] 188.00-189.00 sec  1.15 GBytes  9.89 Gbits/sec   10   2.04 MBytes</span><br><span class="line">[  4] 189.00-190.00 sec  1.15 GBytes  9.87 Gbits/sec   14   1.97 MBytes</span><br><span class="line">[  4] 190.00-191.00 sec  1.15 GBytes  9.87 Gbits/sec   38   1.65 MBytes</span><br><span class="line">[  4] 191.00-192.00 sec  1.15 GBytes  9.89 Gbits/sec   18   1.59 MBytes</span><br><span class="line">[  4] 192.00-193.00 sec  1.15 GBytes  9.86 Gbits/sec   12   2.20 MBytes</span><br><span class="line">[  4] 193.00-194.00 sec  1.15 GBytes  9.90 Gbits/sec    8   2.01 MBytes</span><br><span class="line">[  4] 194.00-195.00 sec  1.15 GBytes  9.86 Gbits/sec    9   1.70 MBytes</span><br><span class="line">[  4] 195.00-196.00 sec  1.15 GBytes  9.87 Gbits/sec    8   2.26 MBytes</span><br><span class="line">[  4] 196.00-196.72 sec   851 MBytes  9.88 Gbits/sec    4   1.99 MBytes</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bandwidth       Retr</span><br><span class="line">[  4]   0.00-196.72 sec   226 GBytes  9.87 Gbits/sec  3776             sender</span><br><span class="line">[  4]   0.00-196.72 sec  0.00 Bytes  0.00 bits/sec                  receiver</span><br><span class="line">iperf3: interrupt - the client has terminated</span><br></pre></td></tr></table></figure>

<h4 id="Make-sure-retrans-type"><a href="#Make-sure-retrans-type" class="headerlink" title="Make sure retrans type"></a>Make sure retrans type</h4><p><a href="https://github.com/brendangregg/perf-tools" target="_blank" rel="noopener">tcpretrans</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">$ nstat -rsz | grep -Ei <span class="string">'fail|crc|dis|drop|miss|err|over|timeout|jabb'</span></span><br><span class="line">TcpExtTCPSackFailures           559232             0.0</span><br><span class="line">TcpExtTCPLossFailures           44575              0.0</span><br><span class="line">TcpExtTCPRenoRecoveryFail       0                  0.0</span><br><span class="line">TcpExtTCPSackRecoveryFail       400237             0.0</span><br><span class="line">TcpExtTCPSchedulerFailed        0                  0.0</span><br><span class="line">TcpExtTCPAbortFailed            3                  0.0</span><br><span class="line">TcpExtTCPSACKDiscard            0                  0.0</span><br><span class="line">TcpExtTCPBacklogDrop            0                  0.0</span><br><span class="line">TcpExtPFMemallocDrop            0                  0.0</span><br><span class="line">TcpExtTCPMinTTLDrop             0                  0.0</span><br><span class="line">TcpExtTCPDeferAcceptDrop        0                  0.0</span><br><span class="line">TcpExtTCPReqQFullDrop           0                  0.0</span><br><span class="line">TcpExtTCPRetransFail            631                0.0</span><br><span class="line">TcpExtTCPOFODrop                15819              0.0</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ netstat -s | grep -i retrans</span><br><span class="line">    36900 segments retransmited</span><br><span class="line">    TCPLostRetransmit: 135</span><br><span class="line">    36854 fast retransmits</span><br><span class="line">    32 forward retransmits</span><br><span class="line">    9 retransmits <span class="keyword">in</span> slow start</span><br><span class="line">    5 SACK retransmits failed</span><br><span class="line">$ netstat -s | grep -i retrans</span><br><span class="line">    36963 segments retransmited</span><br><span class="line">    TCPLostRetransmit: 135</span><br><span class="line">    36917 fast retransmits</span><br><span class="line">    32 forward retransmits</span><br><span class="line">    9 retransmits <span class="keyword">in</span> slow start</span><br><span class="line">    5 SACK retransmits failed</span><br><span class="line"></span><br><span class="line">17:18:03 0      10.53.19.2:40770     R&gt; 10.53.19.1:5201      ESTABLISHED</span><br><span class="line"> =&gt; tcp_retransmit_skb</span><br><span class="line"> =&gt; tcp_fastretrans_alert</span><br><span class="line"> =&gt; tcp_ack</span><br><span class="line"> =&gt; tcp_rcv_established</span><br><span class="line"> =&gt; tcp_v4_do_rcv</span><br><span class="line"> =&gt; tcp_v4_rcv</span><br><span class="line"> =&gt; ip_local_deliver_finish</span><br><span class="line"> =&gt; ip_local_deliver</span><br><span class="line"> =&gt; ip_rcv_finish</span><br><span class="line"> =&gt; ip_rcv</span><br><span class="line"> =&gt; __netif_receive_skb_core</span><br><span class="line"> =&gt; __netif_receive_skb</span><br><span class="line"> =&gt; netif_receive_skb_internal</span><br><span class="line"> =&gt; napi_gro_receive</span><br><span class="line"> =&gt; i40e_clean_rx_irq</span><br><span class="line"> =&gt; i40e_napi_poll</span><br><span class="line"> =&gt; net_rx_action</span><br><span class="line"> =&gt; __do_softirq</span><br><span class="line"> =&gt; call_softirq</span><br><span class="line"> =&gt; do_softirq</span><br><span class="line"> =&gt; irq_exit</span><br><span class="line"> =&gt; do_IRQ</span><br><span class="line"> =&gt; ret_from_intr</span><br><span class="line"> =&gt; cpuidle_enter_state</span><br><span class="line"> =&gt; cpuidle_idle_call</span><br><span class="line"> =&gt; arch_cpu_idle</span><br><span class="line"> =&gt; cpu_startup_entry</span><br><span class="line"> =&gt; start_secondary</span><br><span class="line"> =&gt; start_cpu</span><br><span class="line">17:18:03 11610  10.53.19.2:40770     R&gt; 10.53.19.1:5201      ESTABLISHED</span><br><span class="line"> =&gt; tcp_retransmit_skb</span><br><span class="line"> =&gt; tcp_fastretrans_alert</span><br><span class="line"> =&gt; tcp_ack</span><br><span class="line"> =&gt; tcp_rcv_established</span><br><span class="line"> =&gt; tcp_v4_do_rcv</span><br><span class="line"> =&gt; release_sock</span><br><span class="line"> =&gt; tcp_sendmsg</span><br><span class="line"> =&gt; inet_sendmsg</span><br><span class="line"> =&gt; sock_aio_write</span><br><span class="line"> =&gt; do_sync_write</span><br><span class="line"> =&gt; vfs_write</span><br><span class="line"> =&gt; SyS_write</span><br><span class="line"> =&gt; system_call_fastpath</span><br><span class="line"></span><br><span class="line">$ ps aux | grep 11610</span><br><span class="line">root     11610 11.9  0.0  10084  1524 pts/1    S+   17:15   0:28 iperf3 -c 10.53.19.1 -P 1 -M 8960 -S 0x08 -t 36000 -p 5201 -l 512k</span><br></pre></td></tr></table></figure>

<h4 id="Analysis-wireshark-log"><a href="#Analysis-wireshark-log" class="headerlink" title="Analysis wireshark log"></a>Analysis wireshark log</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ tshark -r first.pcapng <span class="string">"tcp.analysis.retransmission"</span></span><br><span class="line">no output</span><br><span class="line"></span><br><span class="line">$ tshark -r first.pcapng <span class="string">"tcp.analysis.duplicate_ack"</span></span><br><span class="line"></span><br><span class="line">21801 0.710632534   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#1] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794721 TSecr=61820560 SLE=777178578 SRE=777375434</span></span><br><span class="line">21804 0.710733730   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#2] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794721 TSecr=61820560 SLE=777178578 SRE=777500706</span></span><br><span class="line">21811 0.711034519   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#3] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794722 TSecr=61820560 SLE=777178578 SRE=777867574</span></span><br><span class="line">21814 0.711153496   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#4] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794722 TSecr=61820560 SLE=777178578 SRE=778010742</span></span><br><span class="line">21816 0.711206308   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#5] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794722 TSecr=61820560 SLE=777178578 SRE=778082326</span></span><br><span class="line">21818 0.711259113   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#6] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794722 TSecr=61820560 SLE=777178578 SRE=778144962</span></span><br><span class="line">21820 0.711369837   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#7] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794722 TSecr=61820560 SLE=777178578 SRE=778279182</span></span><br><span class="line">21823 0.711477980   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#8] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794722 TSecr=61820560 SLE=777178578 SRE=778413402</span></span><br><span class="line">21826 0.711584396   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#9] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794722 TSecr=61820560 SLE=777178578 SRE=778547622</span></span><br><span class="line">21829 0.711695472   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#10] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794722 TSecr=61820560 SLE=777178578 SRE=778681842</span></span><br><span class="line">21831 0.711749935   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#11] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794722 TSecr=61820560 SLE=777178578 SRE=778753426</span></span><br><span class="line">21834 0.711911211   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#12] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794723 TSecr=61820560 SLE=777178578 SRE=778950282</span></span><br><span class="line">21837 0.712018290   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#13] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794723 TSecr=61820560 SLE=777178578 SRE=779084502</span></span><br><span class="line">21839 0.712073239   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#14] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794723 TSecr=61820560 SLE=777178578 SRE=779147138</span></span><br><span class="line">21842 0.712182142   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#15] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794723 TSecr=61820560 SLE=777178578 SRE=779281358</span></span><br><span class="line">21844 0.712229813   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#16] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794723 TSecr=61820560 SLE=777178578 SRE=779317150</span></span><br><span class="line">21846 0.712343529   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#17] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794723 TSecr=61820560 SLE=777178578 SRE=779487162</span></span><br><span class="line">21848 0.712400110   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#18] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794723 TSecr=61820560 SLE=777178578 SRE=779549798</span></span><br><span class="line">21851 0.712507000   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 21799<span class="comment">#19] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=777160682 Win=5263360 Len=0 TSval=2597794723 TSecr=61820560 SLE=777178578 SRE=779684018</span></span><br><span class="line">28272 1.007961111   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#1] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795019 TSecr=61820858 SLE=1144493978 SRE=1144672938</span></span><br><span class="line">28276 1.008232476   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#2] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795019 TSecr=61820858 SLE=1144493978 SRE=1145012962</span></span><br><span class="line">28278 1.008288165   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#3] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795019 TSecr=61820858 SLE=1144493978 SRE=1145075598</span></span><br><span class="line">28284 1.008612213   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#4] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795019 TSecr=61820858 SLE=1144493978 SRE=1145478258</span></span><br><span class="line">28287 1.008719487   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#5] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795019 TSecr=61820858 SLE=1144493978 SRE=1145612478</span></span><br><span class="line">28290 1.008945676   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#6] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795020 TSecr=61820858 SLE=1144493978 SRE=1145898814</span></span><br><span class="line">28292 1.008995223   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#7] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795020 TSecr=61820858 SLE=1144493978 SRE=1145961450</span></span><br><span class="line">28294 1.009095692   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#8] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795020 TSecr=61820858 SLE=1144493978 SRE=1146077774</span></span><br><span class="line">28296 1.009144335   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#9] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795020 TSecr=61820858 SLE=1144493978 SRE=1146140410</span></span><br><span class="line">28298 1.009194590   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#10] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795020 TSecr=61820858 SLE=1144493978 SRE=1146203046</span></span><br><span class="line">28300 1.009296391   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#11] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795020 TSecr=61820858 SLE=1144493978 SRE=1146328318</span></span><br><span class="line">28303 1.009447610   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#12] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795020 TSecr=61820858 SLE=1144493978 SRE=1146516226</span></span><br><span class="line">28305 1.009498110   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#13] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795020 TSecr=61820858 SLE=1144493978 SRE=1146578862</span></span><br><span class="line">28307 1.009544808   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#14] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795020 TSecr=61820858 SLE=1144493978 SRE=1146632550</span></span><br><span class="line">28309 1.009647030   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#15] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795020 TSecr=61820858 SLE=1144493978 SRE=1146757822</span></span><br><span class="line">28312 1.009798430   10.53.19.1 -&gt; 10.53.19.2   TCP 78 [TCP Dup ACK 28269<span class="comment">#16] targus-getdata1 &gt; 40746 [ACK] Seq=1 Ack=1144476082 Win=18720768 Len=0 TSval=2597795021 TSecr=61820858 SLE=1144493978 SRE=1146945730</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/tshark-1.png" alt=""><br><img src="/img/tshark-2.png" alt=""></p>
<p>TCP has this inherent mechanism of recovery. In tcp stream eq 8 of your trace there was a condition of retransmission generated due to timing but not because of drops. Here is the snippet of your trace.</p>
<p>Step-1)Server send a packet to client(Let us call it packet-A){Packet.no-150}</p>
<p>Step-2)Client acknowledged the packet (Let us call it ack-A){Packet.no-192}</p>
<p>Step-3)Somehow packet-A was retransmitted by Server.The reason might be the delay in receiving ack-A from client and ack timer got out and retransmission timer got kicked in.(Dup of Packet-A){Packet.no-194}</p>
<p>Step-4)Client generated a duplicate ack for the retransmitted packet.(Dup of ack-A){Packet.no-195}</p>
<p><a href="https://osqa-ask.wireshark.org/questions/21006/tcp-dup-acktcp-retransmission" target="_blank" rel="noopener">https://osqa-ask.wireshark.org/questions/21006/tcp-dup-acktcp-retransmission</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/28/learn-zfs-internals-p1-p5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo-4-blog.png">
      <meta itemprop="name" content="Ginger">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b946c5a0bf547c89">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/28/learn-zfs-internals-p1-p5/" class="post-title-link" itemprop="url">A copy about ZFS Internals(p1-p5)</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-28 10:38:38" itemprop="dateCreated datePublished" datetime="2016-12-28T10:38:38+08:00">2016-12-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-04 18:24:05" itemprop="dateModified" datetime="2020-01-04T18:24:05+08:00">2020-01-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/filesystem/" itemprop="url" rel="index">
                    <span itemprop="name">filesystem</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/12/28/learn-zfs-internals-p1-p5/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/12/28/learn-zfs-internals-p1-p5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>15 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="ZFS-Internals"><a href="#ZFS-Internals" class="headerlink" title="ZFS Internals"></a><a href="http://www.eall.com.br/blog/?p=312" target="_blank" rel="noopener">ZFS Internals</a></h3>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2016/12/28/learn-zfs-internals-p1-p5/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/18/sparse/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo-4-blog.png">
      <meta itemprop="name" content="Ginger">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b946c5a0bf547c89">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/18/sparse/" class="post-title-link" itemprop="url">sparse file data segment</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-18 21:31:17" itemprop="dateCreated datePublished" datetime="2016-12-18T21:31:17+08:00">2016-12-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-05 22:55:04" itemprop="dateModified" datetime="2020-01-05T22:55:04+08:00">2020-01-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/filesystem/" itemprop="url" rel="index">
                    <span itemprop="name">filesystem</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/12/18/sparse/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/12/18/sparse/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>8.5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>8 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Test-file"><a href="#Test-file" class="headerlink" title="Test file"></a>Test file</h3><p>ubuntu 16.04<br>ext4 file system</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ rm data-A</span><br><span class="line">$ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..1500&#125;; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$i</span> &gt;&gt; data-A ; <span class="keyword">done</span></span><br><span class="line">$ filefrag -v data-A </span><br><span class="line">Filesystem <span class="built_in">type</span> is: ef53</span><br><span class="line">File size of data-A is 6394 (2 blocks of 4096 bytes)</span><br><span class="line"> ext:     logical_offset:        physical_offset: length:   expected: flags:</span><br><span class="line">   0:        0..       0:    3464588..   3464588:      1:            </span><br><span class="line">   1:        1..       1:          0..         0:      1:    3464589: last,unknown_loc,delalloc,eof</span><br><span class="line">$ dd <span class="keyword">if</span>=data-A of=data-A-1 bs=4096 count=1</span><br><span class="line">$ dd <span class="keyword">if</span>=data-A of=data-A-2 bs=4096 count=1 skip=1</span><br><span class="line">$ head data-A-2</span><br><span class="line">1</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ cat data-A-1 data-A-2 | md5sum</span><br><span class="line">30ef7f11d29b8ad47542e97ed9d2a398  -</span><br><span class="line">$ cat data-A | md5sum</span><br><span class="line">30ef7f11d29b8ad47542e97ed9d2a398  -</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2016/12/18/sparse/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/04/openzfs-tips/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo-4-blog.png">
      <meta itemprop="name" content="Ginger">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b946c5a0bf547c89">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/04/openzfs-tips/" class="post-title-link" itemprop="url">openzfs tips</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-04 15:06:13" itemprop="dateCreated datePublished" datetime="2016-12-04T15:06:13+08:00">2016-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-02 17:01:46" itemprop="dateModified" datetime="2020-06-02T17:01:46+08:00">2020-06-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/filesystem/" itemprop="url" rel="index">
                    <span itemprop="name">filesystem</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/12/04/openzfs-tips/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/12/04/openzfs-tips/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>43k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>39 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="How-many-devices-in-single-raidz-zpool"><a href="#How-many-devices-in-single-raidz-zpool" class="headerlink" title="How many devices in single raidz zpool"></a>How many devices in single raidz zpool</h3><p>2^n + parity<br>raidz2 2^3+2=10 2^4+2=18 , we have 14 x HDDs in single raidz2 zpool in production<br>raidz3 2^3+3=11 2^4+3=19 , next we will choice 19 x HDDs in single raidz3</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2016/12/04/openzfs-tips/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/04/kcptun/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo-4-blog.png">
      <meta itemprop="name" content="Ginger">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b946c5a0bf547c89">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/09/04/kcptun/" class="post-title-link" itemprop="url">proxychains and kcptun</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-09-04 19:06:05" itemprop="dateCreated datePublished" datetime="2016-09-04T19:06:05+08:00">2016-09-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-05 20:00:16" itemprop="dateModified" datetime="2020-01-05T20:00:16+08:00">2020-01-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/09/04/kcptun/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/09/04/kcptun/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>824</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Server-Parameters"><a href="#Server-Parameters" class="headerlink" title="Server Parameters"></a>Server Parameters</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/bash nobody -c <span class="string">'./server_linux_amd64 -l "vps_ip:kcptun_port" -t "serer_ip:shadowsocks_port" -key yourkeyfile -mode fast2 --crypt aes-128 --datashard 10 --parityshard 3'</span></span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2016/09/04/kcptun/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/10/block_device/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo-4-blog.png">
      <meta itemprop="name" content="Ginger">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b946c5a0bf547c89">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/08/10/block_device/" class="post-title-link" itemprop="url">The block device</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-08-10 00:04:26" itemprop="dateCreated datePublished" datetime="2016-08-10T00:04:26+08:00">2016-08-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-31 11:11:29" itemprop="dateModified" datetime="2020-05-31T11:11:29+08:00">2020-05-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/scsi/" itemprop="url" rel="index">
                    <span itemprop="name">scsi</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/08/10/block_device/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/10/block_device/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>53k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>48 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Hardware"><a href="#Hardware" class="headerlink" title="Hardware"></a>Hardware</h3><h4 id="Why-use-4K-device"><a href="#Why-use-4K-device" class="headerlink" title="Why use 4K device"></a>Why use 4K device</h4><ul>
<li>4-KB native (4Kn) HDDs<pre><code>* The 4Kn HDD directly maps 4-KB logical sectors (or blocks) to the 4-KB physical sectors.</code></pre></li>
<li>512-byte emulation (512e) HDDs<pre><code>* The 512e HDD transparently translates 512-byte logical block I/O requests into 4-KB physical sector operations. Each physical sector contains eight logical blocks.</code></pre></li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2016/08/10/block_device/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/20/fault_ratio/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo-4-blog.png">
      <meta itemprop="name" content="Ginger">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b946c5a0bf547c89">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/07/20/fault_ratio/" class="post-title-link" itemprop="url">calculate HDD SSD fault ratio</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-20 14:30:04" itemprop="dateCreated datePublished" datetime="2016-07-20T14:30:04+08:00">2016-07-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-05 20:10:25" itemprop="dateModified" datetime="2020-01-05T20:10:25+08:00">2020-01-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hardware/" itemprop="url" rel="index">
                    <span itemprop="name">hardware</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/20/fault_ratio/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/20/fault_ratio/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="calculate-fault-ratio"><a href="#calculate-fault-ratio" class="headerlink" title="calculate fault ratio"></a>calculate fault ratio</h3><p>First year failure four HDD at the same time,single HDD fault rate 0.01<br>Third year failure four HDD at the same time,single HDD fault rate 0.03<br>Fifth year failure four HDD at the same time,single HDD fault rate 0.05</p>
<p>In third year, Raidz3 broken four HDD at the same time<br>$ awk ‘BEGIN{printf “%.12f\n”, 1-(480/(365*24/0.03)+0.03)^4}’<br>0.999998997334</p>
<p>Real MTBF<br>$ awk ‘BEGIN{printf “%.10f\n”, 365*24/0.03}’<br>292000.0000000000</p>
<h3 id="AFR"><a href="#AFR" class="headerlink" title="AFR"></a>AFR</h3><p><a href="https://documents.westerndigital.com/content/dam/doc-library/en_us/assets/public/western-digital/product/data-center-drives/ultrastar-dc-hc500-series/data-sheet-ultrastar-dc-hc510.pdf" target="_blank" rel="noopener">https://documents.westerndigital.com/content/dam/doc-library/en_us/assets/public/western-digital/product/data-center-drives/ultrastar-dc-hc500-series/data-sheet-ultrastar-dc-hc510.pdf</a><br>2.5M hours MTBF and 0.35% AFR(Annualized Failure Rate),<br>356x24=8760<br>$ awk ‘BEGIN{printf “%.2f\n”, 8760/0.004}’<br>2190000.00<br>$ awk ‘BEGIN{printf “%.2f\n”, 8760/0.035}’<br>2502857.14</p>
<h3 id="Nonrecoverable-Read-Errors-URE-per-Bits-Read"><a href="#Nonrecoverable-Read-Errors-URE-per-Bits-Read" class="headerlink" title="Nonrecoverable Read Errors(URE) per Bits Read"></a>Nonrecoverable Read Errors(URE) per Bits Read</h3><p>1 byte per 10E15 (Enterprise 7.2k HDD 10E15=1000000000000000)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1e12*8 bytes &#x3D; 1 (TB)</span><br><span class="line">(1e15)&#x2F;(1e12*8)&#x3D;125 (TB)</span><br></pre></td></tr></table></figure>

<p>1 byte per 10E14 (Desktop 5.9k/7.2k HDD)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(1e14)&#x2F;(1e12*8)&#x3D;12.5 (TB)</span><br></pre></td></tr></table></figure>

<p>1 byte per 10E17 (Enterprise SSD)<br>1 byte per 10E16 (Desktop SSD/SAS 15k HDD)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/06/16/storage_spec/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo-4-blog.png">
      <meta itemprop="name" content="Ginger">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b946c5a0bf547c89">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/06/16/storage_spec/" class="post-title-link" itemprop="url">storage spec</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-06-16 15:35:11" itemprop="dateCreated datePublished" datetime="2016-06-16T15:35:11+08:00">2016-06-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-31 11:04:54" itemprop="dateModified" datetime="2020-05-31T11:04:54+08:00">2020-05-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hardware/" itemprop="url" rel="index">
                    <span itemprop="name">hardware</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/06/16/storage_spec/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/06/16/storage_spec/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>20k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>19 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Device-parameters"><a href="#Device-parameters" class="headerlink" title="Device parameters"></a><a href="https://www.seagate.com/www-content/surveillance-center/files/Understanding-Reliability-Metrics.pdf" target="_blank" rel="noopener">Device parameters</a></h3><h4 id="MTBF-Mean-Time-Between-Failure"><a href="#MTBF-Mean-Time-Between-Failure" class="headerlink" title="(MTBF) Mean Time Between Failure"></a>(MTBF) Mean Time Between Failure</h4><p>MTBF, however, can be subject to misinterpretation. For example, an HDD might carry a 1M-hour MTBF, causing some customers to erroneously assume that the drive should be able to run 24 hours a day for a century or more. Obviously, this is theoretical.</p>
<p>MTBF is actually reached by dividing the total time a population of samples is under observation by the number of failures. If you have 1000 drives running for 1000 hours each, and five of them fail (1000×1000/5 ), you’ve then derived a 200K-hour MTBF. Because MTBF is typically calculated during an HDD’s useful life, consider a graph of failure rate over time, starting when a population of HDDs rolls off of the manufacturing line. </p>
<h4 id="AFR-Annualized-Failure-Rate"><a href="#AFR-Annualized-Failure-Rate" class="headerlink" title="(AFR) Annualized Failure Rate"></a>(AFR) Annualized Failure Rate</h4><p>Recently, Seagate began offering AFR specs on some drives in addition to conventional MTBF ratings. Although the two metrics are similar, AFR is a percentage estimate of the products that will likely fail due to a defect over a 1-year period. The subtle distinction lies in a switch from averages to percentages. MTBF is based on probabilities; AFR relies on HDD return numbers and analyses for its estimates. AFRs don’t include HDDs returned without issues, those subjected to excessive shock or HDDs that were mishandled. Seagate expects AFR to help facilitate better service plans and spare unit strategies.<br>Remember: AFR, as with any reliability metric, makes specific assumptions about how many hours an HDD is running per year, endured motor start/stop cycles, and internal temperature, all of which affect reliability. But AFR doesn’t necessarily help you get to the bottom of which HDD is right for your application. Enter the annualized workload rate (WRL).</p>
<h4 id="WRL-Workload-Rate-Limit"><a href="#WRL-Workload-Rate-Limit" class="headerlink" title="(WRL) Workload Rate Limit"></a>(WRL) Workload Rate Limit</h4><p>Seagate specifies a WRL—that is, the maximum read/write workload (also in terabytes per year) a given HDD is designed to accommodate. Enterprise-class drives feature a WRL of 300TB to 550TB/year. Specialty-tuned drives, including NAS, archive, video and surveillance families, are rated for 180TB/year; Seagate’s client portfolio (desktop and laptop HDDs) has a workload rate limit of 55TB/year, which is still a formidable amount of data within the client market segment.</p>
<p>Consider environmental conditions in your reliability projections. An insufficiently-cooled storage device, even operating under its WRL, will experience a higher failure rate than those at or under manufacturer specifications. Similarly, using a desktop HDD in a highly active chassis with significant vibration levels can also take a toll on the performance and reliability of the drive.</p>
<p><a href="https://www.seagate.com/support/kb/annualized-workload-rate-005902en/" target="_blank" rel="noopener">Annualized Workload Rate</a> = (Lifetime Writes + Lifetime Reads) * (8760 / Lifetime Power On Hours)<br>8760 are the number of hours in a year.  The Workload Rate becomes an annualized average expressed as TB/year.</p>
<p>Enterprise                300~550TB/year<br>NAS/archive/surveillance  180TB/year<br>desktop/laptop            55TB/year</p>
<h3 id="PCI-PCI-X-speed"><a href="#PCI-PCI-X-speed" class="headerlink" title="PCI/PCI-X speed"></a>PCI/PCI-X speed</h3><table>
<thead>
<tr>
<th>Bus and frequency</th>
<th>32 bit transfer rate</th>
<th>64 bit Transfer rate</th>
</tr>
</thead>
<tbody><tr>
<td>33-MHz PCI</td>
<td>1064Mb/s</td>
<td>2128Mb/s</td>
</tr>
<tr>
<td>66-MHz PCI</td>
<td>2128Mb/s</td>
<td>4256Mb/s</td>
</tr>
<tr>
<td>100-MHz PCI-X</td>
<td>Not applicable</td>
<td>6400Mb/s</td>
</tr>
<tr>
<td>133-MHz PCI-X</td>
<td>Not applicable</td>
<td>8192Mb/s</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>PCIE</th>
<th>Encoded</th>
<th>transmit rate</th>
<th>code</th>
</tr>
</thead>
<tbody><tr>
<td>Gen 1 x1</td>
<td>0.25GB/s</td>
<td>2.5GT</td>
<td>8/10b</td>
</tr>
<tr>
<td>Gen 2 x1</td>
<td>0.5GB/s</td>
<td>5GT/s</td>
<td>8/10b</td>
</tr>
<tr>
<td>Gen 3 x1</td>
<td>0.9846GB/s</td>
<td>8GT/s</td>
<td>128/130b</td>
</tr>
<tr>
<td>Gen 4 x1</td>
<td>1.969GB/s</td>
<td>16GT/s</td>
<td>128/130b</td>
</tr>
</tbody></table>
<p>Eg: 16GT/s * 128/130/8 = 1.96923GB/s</p>
<table>
<thead>
<tr>
<th>SAS3 performance</th>
<th>bandwidth GBps</th>
</tr>
</thead>
<tbody><tr>
<td>SAS3 64 x read raw single SAS port</td>
<td>4</td>
</tr>
<tr>
<td>SAS3 64 x write raw single SAS port</td>
<td>3.9</td>
</tr>
<tr>
<td>SAS3 64 x rw 1:1 raw single SAS port</td>
<td>1.9/1.9</td>
</tr>
<tr>
<td>SAS3 64 x rw 1:1 raw dual SAS port</td>
<td>3.63/3.62</td>
</tr>
</tbody></table>
<p>single LSI 9300-8e SAS port(4e) with 84 x 3.5inch NLSAS HDD<br>Not enough SSD for test iops </p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2016/06/16/storage_spec/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/04/awk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo-4-blog.png">
      <meta itemprop="name" content="Ginger">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b946c5a0bf547c89">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/04/04/awk/" class="post-title-link" itemprop="url">awk tips</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-04-04 00:03:44" itemprop="dateCreated datePublished" datetime="2016-04-04T00:03:44+08:00">2016-04-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-31 11:05:47" itemprop="dateModified" datetime="2020-05-31T11:05:47+08:00">2020-05-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/awk/" itemprop="url" rel="index">
                    <span itemprop="name">awk</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/04/04/awk/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/04/04/awk/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2.7k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Set-awk-env"><a href="#Set-awk-env" class="headerlink" title="Set awk env"></a>Set awk env</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> AWKBUFSIZE=$((1024*1024)) </span><br><span class="line"><span class="comment">#you could strace</span></span><br><span class="line"><span class="built_in">read</span>(3, <span class="string">"B2000712/17B2000712.TPM2.data\t34"</span>..., 1048576) = 1048576</span><br></pre></td></tr></table></figure>

<h3 id="write-file-in-awk"><a href="#write-file-in-awk" class="headerlink" title="write file in awk"></a>write file in awk</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'&#123;print $2 &gt;"text.out"&#125;'</span> text.txt</span><br></pre></td></tr></table></figure>

<h3 id="Sort-array-by-awk"><a href="#Sort-array-by-awk" class="headerlink" title="Sort array by awk"></a>Sort array by awk</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">cat</span> <span class="string">file</span></span><br><span class="line"><span class="string">port</span> <span class="number">12</span></span><br><span class="line"><span class="string">zest</span> <span class="number">2</span></span><br><span class="line"><span class="string">status</span> <span class="number">4</span></span><br><span class="line"><span class="string">flash</span> <span class="number">4</span></span><br><span class="line"><span class="string">hero</span> <span class="number">3</span></span><br><span class="line"><span class="string">awk</span> <span class="number">3</span></span><br><span class="line"><span class="string">innovation</span> <span class="number">10</span></span><br><span class="line"><span class="string">test</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2016/04/04/awk/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/01/blktrace/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo-4-blog.png">
      <meta itemprop="name" content="Ginger">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b946c5a0bf547c89">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/04/01/blktrace/" class="post-title-link" itemprop="url">Blktrace</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-04-01 15:06:39" itemprop="dateCreated datePublished" datetime="2016-04-01T15:06:39+08:00">2016-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-22 15:04:04" itemprop="dateModified" datetime="2020-05-22T15:04:04+08:00">2020-05-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/scsi/" itemprop="url" rel="index">
                    <span itemprop="name">scsi</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/04/01/blktrace/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/04/01/blktrace/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>27k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>24 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>OS version :CentOS 7.2<br>It ‘s a good tool for trace hot block in your block device</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2016/04/01/blktrace/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ginger"
      src="/img/logo-4-blog.png">
  <p class="site-author-name" itemprop="name">Ginger</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">55</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">63</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ginger</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">965k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">14:37</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.6.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://b946c5a0bf547c89.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
