<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="How many devices in single raidz zpool2^n + parityraidz2 2^3+2&#x3D;10 2^4+2&#x3D;18 , we have 14 x HDDs in single raidz2 zpool in productionraidz3 2^3+3&#x3D;11 2^4+3&#x3D;19 , next we will choice 19 x HDDs in single ra">
<meta property="og:type" content="article">
<meta property="og:title" content="openzfs tips">
<meta property="og:url" content="http://yoursite.com/2016/12/04/openzfs-tips/index.html">
<meta property="og:site_name" content="b946c5a0bf547c89">
<meta property="og:description" content="How many devices in single raidz zpool2^n + parityraidz2 2^3+2&#x3D;10 2^4+2&#x3D;18 , we have 14 x HDDs in single raidz2 zpool in productionraidz3 2^3+3&#x3D;11 2^4+3&#x3D;19 , next we will choice 19 x HDDs in single ra">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2016-12-04T07:06:13.000Z">
<meta property="article:modified_time" content="2020-01-04T06:33:03.912Z">
<meta property="article:author" content="Ginger">
<meta property="article:tag" content="zfs">
<meta property="article:tag" content="scsi">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2016/12/04/openzfs-tips/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>openzfs tips | b946c5a0bf547c89</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">b946c5a0bf547c89</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">My Silent Hill</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/04/openzfs-tips/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo-4-blog.png">
      <meta itemprop="name" content="Ginger">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b946c5a0bf547c89">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          openzfs tips
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-04 15:06:13" itemprop="dateCreated datePublished" datetime="2016-12-04T15:06:13+08:00">2016-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-04 14:33:03" itemprop="dateModified" datetime="2020-01-04T14:33:03+08:00">2020-01-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/filesystem/" itemprop="url" rel="index">
                    <span itemprop="name">filesystem</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/12/04/openzfs-tips/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/12/04/openzfs-tips/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>30k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>27 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="How-many-devices-in-single-raidz-zpool"><a href="#How-many-devices-in-single-raidz-zpool" class="headerlink" title="How many devices in single raidz zpool"></a>How many devices in single raidz zpool</h3><p>2^n + parity<br>raidz2 2^3+2=10 2^4+2=18 , we have 14 x HDDs in single raidz2 zpool in production<br>raidz3 2^3+3=11 2^4+3=19 , next we will choice 19 x HDDs in single raidz3</p>
<a id="more"></a>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">10TBxHDD  ashift12    ashift9(TiB)  a12&#x2F;a9   raw(TB)    raw compare with 9   raw compare with 12</span><br><span class="line">8+2         68           71         95.77%   100           71%  (recommand)      68%</span><br><span class="line">10+2        81           88         92%      120           73.3%                 68.5%</span><br><span class="line">12+2       102          106         96.22%   140           75.7%a                72.8%</span><br><span class="line">14+2       116          123         94.3%    160           76.8%                 72.5%</span><br><span class="line">16+2       141          141         100%     180           78.3% (recommand)     78.3%</span><br><span class="line">8+3         71           71         100%     110           64.5%                 64.5%</span><br><span class="line">11+3        90           97         92.78%   140           69.2%                 64.2%</span><br><span class="line">12+3        97          105         92.38%   150           70%                   64.6%</span><br><span class="line">16+3       134          141         95%      190           74.2% (recommand)     70.5%</span><br><span class="line">17+3       141          149         94.6%    200           74.5%                 70.5%</span><br><span class="line">18+3       148          156         94.8%    210           74.2%                 70.47%</span><br><span class="line">19+3       155          166         93.3%    220           75.4%                 70.45%</span><br><span class="line">20+3       162          175         92.5%    230           76%                   70.43%</span><br><span class="line"></span><br><span class="line">12TBxHDD  ashift12    ashift9(TiB)  a12&#x2F;a9   raw(TB)   raw compare with 9       raw compare with 12</span><br><span class="line">5+3         49	         53         92.4%    96          55.2%                   51%</span><br><span class="line">6+2         61           64         92.4%    96          66.6%                   63.5%</span><br><span class="line">8+2         81           85         95.2%    120         70.8%                   67.5%</span><br><span class="line">16+2       170          170         100%     216         78.7%  (recommand)    78.7%</span><br><span class="line">8+3         85           85         100%     132         64.3%                 64.3%</span><br><span class="line">11+3       108          116         93.1%    168         69%                   64.2%</span><br><span class="line">12+3       116          126         92%      180         70%                   64.4%</span><br><span class="line">15+3       139          157         88.5%    216         72.6%                 64.3%</span><br><span class="line">16+3       161          170         94.7%    228         74.5% (recommand)     70.6%</span><br><span class="line">20+3       195          210         91.42%   276         76%                   70.6%</span><br><span class="line">21+3       203          220         92.2%    288         76.3%                 70.4%</span><br><span class="line"></span><br><span class="line">12TB SAS device</span><br><span class="line">5U 84 bay 12TB</span><br><span class="line">(16+2)*4+(6+2)+4 hs &#x3D; 170*4+61 &#x3D; 741TiB&#x2F;1008TB &#x3D; 73.4% (TiB&#x2F;TB) (ashfit 12, raidz2, 4 hot spare)</span><br><span class="line">(16+3)*4+(8+2) &#x3D; 161*4 + 61 &#x3D; 705TiB&#x2F;1008TB &#x3D; 69.9% (ashfit 12, raidz3)</span><br><span class="line">(16+3)*4+(8+2) &#x3D; 170*4 + 64 &#x3D; 744TiB&#x2F;1008TB &#x3D; 73.8% (ashfit 9, raidz3)</span><br><span class="line"></span><br><span class="line">4U 60 bay 12TB</span><br><span class="line">(16+2)*3+6hs&#x3D;170*3&#x2F;720&#x3D;70.8% (ashfit 12,raidz2,6 hot spare)</span><br><span class="line">(16+3)*3+3hs&#x3D;161*3&#x2F;720&#x3D;67%   (ashfit 12, raidz3, 3 hot spare)</span><br><span class="line">(16+3)*3+3hs&#x3D;170*3&#x2F;720&#x3D;70.8% (ashfit 9, raidz3, 3 hot spare)</span><br><span class="line"></span><br><span class="line">4U 90 bay 12TB</span><br><span class="line">(16+2)*4+(12+2)+4 hs&#x3D;(170*4+102)&#x2F;1080 &#x3D; 72.4% (ahsift 12, raidz2, 4 hot spare)</span><br><span class="line">(16+3)*4+(8+2)&#x3D;170*4+81&#x2F;1080 &#x3D; 70.4% (ahsift 12, raidz3)</span><br><span class="line">(16+3)*4+(8+2)&#x3D;170*4+85&#x2F;1080 &#x3D; 70.8% (ahsift 9, raidz3)</span><br><span class="line"></span><br><span class="line">4U 102 bay</span><br><span class="line">(16+2)*5+(6+2)+4hs &#x3D;(170*5+61)&#x2F;1224 &#x3D; 74.4% (ashfit 12, raidz2, 4 hot spare)</span><br><span class="line">(16+3)*5+ 43(4+2)+1hs &#x3D;((161*5)+43)&#x2F;1224 &#x3D; 69.2% (ashfit 12, raidz3, 1 hot spare)</span><br><span class="line">(16+3)*5+ 43(4+2)+1hs &#x3D;((170*5)+43)&#x2F;1224 &#x3D; 72.9% (ashfit 9, raidz3, 1 hot spare)</span><br></pre></td></tr></table></figure>

<p>not make sure</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[381558.364210] sd 17:0:132:0: [sg134] CDB: Test Unit Ready 00 00 00 00 00 00</span><br><span class="line">[381558.365100] scsi target17:0:132: handle(0x0097), sas_address(0x5000c500955e5855), phy(23)</span><br><span class="line">[381558.365961] scsi target17:0:132: enclosure_logical_id(0x50050cc11ac01572), slot(45)</span><br><span class="line">[381558.368328] sd 17:0:132:0: task abort: SUCCESS scmd(ffff8803abf18a80)</span><br><span class="line">[381558.369172] scsi target17:0:132: attempting target reset! scmd(ffff8803abf18a80)</span><br><span class="line">[381558.370012] sd 17:0:132:0: [sg134] CDB: Inquiry 12 01 83 00 f0 00</span><br><span class="line">[381558.370845] scsi target17:0:132: handle(0x0097), sas_address(0x5000c500955e5855), phy(23)</span><br><span class="line">[381558.371660] scsi target17:0:132: enclosure_logical_id(0x50050cc11ac01572), slot(45)</span><br><span class="line">[381558.631612] scsi target17:0:132: target reset: SUCCESS scmd(ffff8803abf18a80)</span><br><span class="line">[381568.608006] sd 17:0:132:0: attempting task abort! scmd(ffff8803abf18a80)</span><br><span class="line">[381568.608802] sd 17:0:132:0: [sg134] CDB: Test Unit Ready 00 00 00 00 00 00</span><br><span class="line">[381568.609600] scsi target17:0:132: handle(0x0097), sas_address(0x5000c500955e5855), phy(23)</span><br><span class="line">[381568.610369] scsi target17:0:132: enclosure_logical_id(0x50050cc11ac01572), slot(45)</span><br><span class="line">[381568.612506] sd 17:0:132:0: task abort: SUCCESS scmd(ffff8803abf18a80)</span><br><span class="line">[381568.613253] mpt2sas0: attempting host reset! scmd(ffff8803abf18a80)</span><br><span class="line">[381568.613989] sd 17:0:132:0: [sg134] CDB: Inquiry 12 01 83 00 f0 00</span><br><span class="line">[381568.614761] mpt2sas0: sending diag reset !!</span><br><span class="line">[381569.611617] mpt2sas0: diag reset: SUCCESS</span><br><span class="line">[381569.747649] mpt2sas0: LSISAS2308: FWVersion(20.00.07.00), ChipRevision(0x05), BiosVersion(07.27.01.01)</span><br><span class="line">[381569.748356] mpt2sas0: Protocol=(Initiator,Target), Capabilities=(TLR,EEDP,Snapshot Buffer,Diag Trace Buffer,Task Set Full,NCQ)</span><br><span class="line">[381569.749818] mpt2sas0: sending port <span class="built_in">enable</span> !!</span><br><span class="line">[381573.276922] WARNING: Pool <span class="string">'ost_81'</span> has encountered an uncorrectable I/O failure and has been suspended.</span><br><span class="line"></span><br><span class="line">[381573.392645] WARNING: Pool <span class="string">'ost_85'</span> has encountered an uncorrectable I/O failure and has been suspended.</span><br><span class="line"></span><br><span class="line">[381573.420579] WARNING: Pool <span class="string">'ost_83'</span> has encountered an uncorrectable I/O failure and has been suspended.</span><br><span class="line"></span><br><span class="line">[381573.445523] WARNING: Pool <span class="string">'ost_87'</span> has encountered an uncorrectable I/O failure and has been suspended.</span><br><span class="line"></span><br><span class="line">[381576.820367] mpt2sas0: port <span class="built_in">enable</span>: SUCCESS</span><br><span class="line">[381576.821174] mpt2sas0: search <span class="keyword">for</span> end-devices: start</span><br><span class="line">[381576.823066] scsi target17:0:0: handle(0x000e), sas_addr(0x50050cc11938283e), enclosure logical id(0x50050cc11ac018e1), slot(0)</span><br><span class="line">[381576.824595] scsi target17:0:1: handle(0x000f), sas_addr(0x5000cca2735b5bd5), enclosure logical id(0x50050cc11ac018e1), slot(76)</span><br><span class="line">[381576.826169] scsi target17:0:2: handle(0x0010), sas_addr(0x5000cca2735d80cd), enclosure logical id(0x50050cc11ac018e1), slot(79)a</span><br><span class="line">[381576.827819] scsi target17:0:3: handle(0x0011), sas_addr(0x5000cca2732f2521), enclosure logical id(0x50050cc11ac018e1), slot(82)</span><br><span class="line">[381576.829497] scsi target17:0:4: handle(0x0012), sas_addr(0x5000cca27355f089), enclosure logical id(0x50050cc11ac018e1), slot(83)</span><br></pre></td></tr></table></figure>

<h3 id="NVME-SSD-test-with-openzfs-0-7"><a href="#NVME-SSD-test-with-openzfs-0-7" class="headerlink" title="NVME SSD test with openzfs 0.7"></a>NVME SSD test with openzfs 0.7</h3><h3 id="6x-Intel-P3520"><a href="#6x-Intel-P3520" class="headerlink" title="[6x Intel P3520]"></a>[6x Intel P3520]</h3><p>Before modify default parameter. there are only 1.xGB/s read or write. too slow…….</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">parted /dev/nvme0n1 p</span><br><span class="line">Model: Unknown (unknown)</span><br><span class="line">Disk /dev/nvme0n1: 2000GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system  Name  Flags</span><br><span class="line"> 1      1049kB  1900GB  1900GB               disk1</span><br><span class="line"></span><br><span class="line">zpool destroy tank01</span><br><span class="line">zpool create tank01 -o ashift=13 -O recordsize=1M /dev/nvme&#123;0..5&#125;n1p1</span><br><span class="line"></span><br><span class="line"><span class="comment">#test mds</span></span><br><span class="line">$ zpool create -f tank01 -O canmount=on -O xattr=sa -O acltype=posixacl -o ashift=12 -O recordsize=32k -O secondarycache=none -O logbias=throughput  /dev/sd&#123;b..d&#125;</span><br><span class="line"></span><br><span class="line">xattr=on stores extended attributes <span class="keyword">in</span> hidden sub directories, <span class="built_in">which</span> can require multiple lookups when accessing a file</span><br><span class="line">The alternative, xattr=sa, stores extended attributes <span class="keyword">in</span> inodes, resulting <span class="keyword">in</span> less IO requests when extended attributes are <span class="keyword">in</span> use</span><br><span class="line"></span><br><span class="line">The logbias property – You can use this property to provide a hint to ZFS about handling synchronous requests <span class="keyword">for</span> a specific dataset. If logbias is <span class="built_in">set</span> to latency, ZFS uses the pool<span class="string">'s separate log devices, if any, to handle the requests at low latency. If logbias is set to throughput, ZFS does not use the pool'</span>s separate <span class="built_in">log</span> devices. Instead, ZFS optimizes synchronous operations <span class="keyword">for</span> global pool throughput and efficient use of resources.</span><br><span class="line"></span><br><span class="line">Does it mean <span class="keyword">in</span> all flash env, you<span class="string">'d better set logbias=throughput</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">              capacity     operations     bandwidth</span></span><br><span class="line"><span class="string">pool        alloc   free   read  write   read  write</span></span><br><span class="line"><span class="string">----------  -----  -----  -----  -----  -----  -----</span></span><br><span class="line"><span class="string">tank01       132G  10.2T      0  16.7K      0  5.79G</span></span><br><span class="line"><span class="string">tank01       146G  10.2T      0  12.4K      0  7.22G</span></span><br><span class="line"><span class="string">tank01       161G  10.2T      0  10.9K      0  7.41G</span></span><br><span class="line"><span class="string">tank01       174G  10.1T      0  12.1K      0  7.18G</span></span><br></pre></td></tr></table></figure>

<h3 id="the-old-optimize-with-lustre"><a href="#the-old-optimize-with-lustre" class="headerlink" title="the old optimize with lustre"></a><a href="http://wiki.lustre.org/images/4/48/ZFS-As-Backend-File-System_Paciucci.pdf" target="_blank" rel="noopener">the old optimize with lustre</a></h3><p><code>There are some issue in this config that means the engineer not make zfs struct clearly</code><br>If you are disbale compression function, zio_taskq_batch_pct could must be limit</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/modprobe.d/zfs.conf</span><br><span class="line">options zfs zfs_prefetch_disable=1</span><br><span class="line">options zfs metaslab_debug_unload=1</span><br><span class="line">options zfs zfs_arc_max=$(awk <span class="string">'$0~/MemTotal/&#123;printf "%.0f \n", $2*1024*0.6&#125;'</span> /proc/meminfo) <span class="comment">#60%, 3/5</span></span><br><span class="line">options zfs zfs_arc_meta_limit=$(awk <span class="string">'$0~/MemTotal/&#123;printf "%.0f \n", $2*1024*0.75&#125;'</span> /proc/meminfo) <span class="comment">#MDS only,75%</span></span><br><span class="line">options zfs zfs_dirty_data_max=$(awk <span class="string">'$0~/MemTotal/&#123;printf "%.0f \n", $2*1024*0.15&#125;'</span> /proc/meminfo) <span class="comment">#15%</span></span><br><span class="line">options zfs zfs_vdev_async_write_min_active=5 <span class="comment"># depends your hdd number of your volume ,SSD could be higher</span></span><br><span class="line">options zfs zfs_vdev_async_write_max_active=15</span><br><span class="line">options zfs zfs_vdev_sync_read_min_active=16 <span class="comment"># depends your hdd number of your volume ,SSD could be higher</span></span><br><span class="line">options zfs zfs_vdev_sync_read_max_active=16</span><br><span class="line">options zfs zfs_vdev_async_write_active_min_dirty_percent=20</span><br><span class="line">options zfs zfs_vdev_scheduler=deadline <span class="comment">#noop for SSD</span></span><br></pre></td></tr></table></figure>
<p>zfs_vdev_scheduler not support mq-deadline<br>since ZFS has its own I/O scheduler, using a simple scheduler can result in more consistent performance<br>expected: noop, cfq, bfq, and deadline</p>
<p><a href="http://lustre.ornl.gov/ecosystem-2016/documents/tutorials/Stearman-LLNL-ZFS.pdf" target="_blank" rel="noopener">Tutorial: How to install, tune and Monitor a ZFS based Lustre file system</a></p>
<h4 id="zfs-txg-timeout"><a href="#zfs-txg-timeout" class="headerlink" title="zfs_txg_timeout"></a>zfs_txg_timeout</h4><p>The last zfs_txg_history txg commits are available in /proc/spl/kstat/zfs/POOL_NAME/txgs</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/spl/kstat/zfs/tank/txgs</span><br><span class="line">25 0 0x01 83 9296 11320470741 2382694537989353</span><br><span class="line">txg      birth            state ndirty       nread        nwritten     reads    writes   otime        qtime        wtime        stime</span><br><span class="line">13974499 2382281791630216 C     1949696      0            1433600      0        526      4999917952   44691        34328        382573295</span><br><span class="line">13974500 2382286791548168 C     1998848      0            1453056      0        552      5000003695   46223        44384        386415831</span><br><span class="line">13974501 2382291791551863 C     1458176      0            1245696      0        539      4999926718   45704        33119        386636075</span><br><span class="line">13974502 2382296791478581 C     950272       0            887296       0        492      4999981264   44784        34896        336542457</span><br><span class="line">13974503 2382301791459845 C     1146880      0            1244672      0        546      4999967135   67884        46074        346304560</span><br><span class="line">13974504 2382306791426980 C     4177920      0            2828288      0        600      4999946876   46380        45891        423776127</span><br></pre></td></tr></table></figure>

<h4 id="L2ARC-and-slog"><a href="#L2ARC-and-slog" class="headerlink" title="L2ARC and slog"></a>L2ARC and slog</h4><p>l2arc_write_max<br>If the cache devices can sustain the write workload, increasing the rate of cache device fill when workloads generate new data at a rate higher than l2arc_write_max can increase L2ARC hit rate</p>
<h1 id="max-write-speed-to-l2arc"><a href="#max-write-speed-to-l2arc" class="headerlink" title="max write speed to l2arc"></a>max write speed to l2arc</h1><h1 id="tradeoff-between-write-read-and-durability-of-ssd"><a href="#tradeoff-between-write-read-and-durability-of-ssd" class="headerlink" title="tradeoff between write/read and durability of ssd (?)"></a>tradeoff between write/read and durability of ssd (?)</h1><h1 id="default-8-1024-1024-8-MB-s"><a href="#default-8-1024-1024-8-MB-s" class="headerlink" title="default : 8 * 1024 * 1024  = 8 MB/s"></a>default : 8 * 1024 * 1024  = 8 MB/s</h1><h1 id="setting-here-500-1024-1024"><a href="#setting-here-500-1024-1024" class="headerlink" title="setting here : 500 * 1024 * 1024"></a>setting here : 500 * 1024 * 1024</h1><p>options zfs l2arc_write_max=524288000</p>
<p>l2arc_headroom</p>
<h1 id="number-of-max-device-writes-to-precache"><a href="#number-of-max-device-writes-to-precache" class="headerlink" title="number of max device writes to precache"></a>number of max device writes to precache</h1><h1 id="default-2"><a href="#default-2" class="headerlink" title="default : 2"></a>default : 2</h1><p>options zfs l2arc_headroom=12</p>
<p>zfs_immediate_write_sz</p>
<h1 id="default-32768"><a href="#default-32768" class="headerlink" title="default : 32768"></a>default : 32768</h1><p>options zfs zfs_immediate_write_sz=131072</p>
<p>zil_slog_limit</p>
<h1 id="default-1024-1024-1mb"><a href="#default-1024-1024-1mb" class="headerlink" title="default : 1024*1024 = 1mb"></a>default : 1024*1024 = 1mb</h1><p>options zfs zil_slog_limit=536870912</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ arcstat.py -f <span class="string">"time,read,hit%,hits,miss%,miss,arcsz,c"</span> 1</span><br><span class="line"></span><br><span class="line">$ cat /proc/spl/kstat/zfs/arcstats</span><br><span class="line">$ arcstat.py 2</span><br><span class="line">$ arc_summary.py | grep <span class="string">"L2 ARC Breakdown"</span> -A 2</span><br><span class="line">L2 ARC Breakdown:                               846.25m</span><br><span class="line">        Hit Ratio:                      0.47%   3.98m</span><br><span class="line">        Miss Ratio:                     99.53%  842.27m</span><br></pre></td></tr></table></figure>


<h4 id="zfs-vdev-scheduler"><a href="#zfs-vdev-scheduler" class="headerlink" title="zfs_vdev_scheduler"></a>zfs_vdev_scheduler</h4><p>Set the IO scheduler used by ZFS. Both noop and deadline, which implement simple scheduling algorithms, are good options, as the storage daemon is run by a single Linux user.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> deadline &gt; /sys/module/zfs/parameters/zfs_vdev_scheduler</span><br></pre></td></tr></table></figure>

<h4 id="zfs-read-chunk-size"><a href="#zfs-read-chunk-size" class="headerlink" title="zfs_read_chunk_size"></a>zfs_read_chunk_size</h4><p>Data is read by ZFS in data chunks of a certain size.  it depends your zfs setting</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1310720 &gt; /sys/module/zfs/parameters/zfs_read_chunk_size</span><br></pre></td></tr></table></figure>

<h4 id="zfs-max-recordsize"><a href="#zfs-max-recordsize" class="headerlink" title="zfs_max_recordsize"></a>zfs_max_recordsize</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 4194304 &gt; /sys/module/zfs/parameters/zfs_max_recordsize</span><br></pre></td></tr></table></figure>

<h4 id="zfs-vdev-aggregation-limit"><a href="#zfs-vdev-aggregation-limit" class="headerlink" title="zfs_vdev_aggregation_limit"></a>zfs_vdev_aggregation_limit</h4><p>ZFS is able to aggregate small IO operations that handle neighboring or overlapping data into larger operations, in order to reduce the number of IOPs</p>
<p>Setting zfs_vdev_aggregation_limit = 0 effectively disables aggregation by ZFS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 262144 &gt; /sys/module/zfs/parameters/zfs_vdev_aggregation_limit</span><br></pre></td></tr></table></figure>


<h4 id="HDD-prefetch"><a href="#HDD-prefetch" class="headerlink" title="HDD prefetch"></a>HDD prefetch</h4><p>Set this option to 0 to activate data prefetching if you are using spinning disks. Set it to 1 to disable it if you are using flash devices like SSDs.</p>
<p>increase HDD performance a lot</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfs_prefetch_disable&#x3D;0 #Must enable for HDD</span><br></pre></td></tr></table></figure>

<h4 id="Vdev-cache"><a href="#Vdev-cache" class="headerlink" title="Vdev cache"></a>Vdev cache</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">options zfs zfs_vdev_cache_size=1310720</span><br><span class="line">options zfs zfs_vdev_cache_max=131072</span><br><span class="line">options zfs zfs_vdev_cache_bshift=17</span><br></pre></td></tr></table></figure>

<h4 id="txg-timeout"><a href="#txg-timeout" class="headerlink" title="txg_timeout"></a>txg_timeout</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cat /sys/module/zfs/parameters/zfs_txg_timeout</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">every 5s will <span class="keyword">do</span> transaction sync</span><br><span class="line"></span><br><span class="line">$ zdb -lu /dev/sdc1 | grep <span class="string">"txg ="</span> -c</span><br><span class="line">128</span><br><span class="line"></span><br><span class="line">128 x 5s= 640s</span><br><span class="line"></span><br><span class="line">If <span class="keyword">in</span> 640s, power off the server imported the zpool ASAP, reboot single server to check the zpool status.</span><br><span class="line">If out of 640s, restart another server, keep the single import server, and backup your data, hope it not be panic.</span><br><span class="line">Need a zfs fsck tool.</span><br><span class="line"></span><br><span class="line">should I improve the value ??? Dangerous !!! impact performance,  enough memory ?</span><br><span class="line">$ <span class="built_in">echo</span> 10 &gt;/sys/module/zfs/parameters/zfs_txg_timeout</span><br></pre></td></tr></table></figure>

<h4 id="zpool-sync-mode"><a href="#zpool-sync-mode" class="headerlink" title="zpool sync mode"></a>zpool sync mode</h4><p>sync=standard : sync writes are written 2 times (first to LOG, second as normal write every ~5 seconds), async write are written only once (every ~5 seconds)<br>sync=always : sync writes and async writes are written 2 times (first to LOG, second as normal write every ~5 seconds).<br>sync=disabled : sync writes and async writes are written only once (every ~5 seconds)<br>Of course ZFS can flush it write cache between 5 second period but the biggest flush is every ~5 seconds.</p>
<h4 id="Limit-memory-usage"><a href="#Limit-memory-usage" class="headerlink" title="Limit memory usage"></a>Limit memory usage</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> xxx &gt; /sys/module/zfs/parameters/zfs_arc_max</span><br><span class="line">cat xxx &gt; /sys/module/zfs/parameters/zfs_arc_min</span><br><span class="line"></span><br><span class="line">cat /etc/modprobe.d/zfs.conf <span class="comment"># Min 4096MB / Max 8192MB limit</span></span><br><span class="line">options zfs zfs_arc_min=4294967296</span><br><span class="line">options zfs zfs_arc_max=8589934592</span><br><span class="line"></span><br><span class="line">modprobe zfs zfs_arc_min=4294967296</span><br></pre></td></tr></table></figure>

<h4 id="zfs-multihost-history"><a href="#zfs-multihost-history" class="headerlink" title="zfs_multihost_history"></a>zfs_multihost_history</h4><p>The pool multihost multimodifier protection (MMP) subsystem can record historical updates in the /proc/spl/kstat/zfs/POOL_NAME/multihost</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/spl/kstat/zfs/ost_0/multihost</span><br><span class="line">47 0 0x01 109 9592 181591887850 4241294257803975</span><br><span class="line">id         txg        timestamp  error  duration   mmp_delay    vdev_guid                vdev_label vdev_path</span><br><span class="line">88663237   43205944   1556725492      0     259182    409397766 5775269556738108556      0          /dev/disk/by-id/scsi-35000c500a670c847-part1</span><br><span class="line">88663238   43205944   1556725492      0    1651942    406910425 10040726243797242983     1          /dev/disk/by-id/scsi-35000c500a670c6cb-part1</span><br><span class="line">88663239   43205944   1556725492      0     262443    404453220 85871317386613310        0          /dev/disk/by-id/scsi-35000c500a65ada5f-part1</span><br><span class="line">88663240   43205944   1556725492      0   16196129    401993428 14057198631110435259     1          /dev/disk/by-id/scsi-35000c500a6753f53-part1</span><br><span class="line">88663241   43205944   1556725493      0     148851    399688210 15150783868311748605     2          /dev/disk/by-id/scsi-35000c500a670c73b-part1</span><br><span class="line">88663242   43205944   1556725493      0     213149    397151149 14018438879105052775     1          /dev/disk/by-id/scsi-35000c500a670cbc7-part1</span><br><span class="line">88663243   43205944   1556725493      0     916612    394759789 12962037773541489706     2          /dev/disk/by-id/scsi-35000c500a65afba7-part1</span><br></pre></td></tr></table></figure>

<p><a href="https://www.svennd.be/tuning-of-zfs-module/" target="_blank" rel="noopener">reference</a></p>
<h3 id="zpool-could-not-mount"><a href="#zpool-could-not-mount" class="headerlink" title="[zpool could not mount]"></a>[zpool could not mount]</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ zpool <span class="built_in">set</span> cachefile=none tank</span><br><span class="line">$ zpool import -N -o cachefile=none -d /dev/disk/by-id tank01</span><br><span class="line">$ zfs mount -o ro tank01</span><br><span class="line"></span><br><span class="line">$ zpool import -Nm tank</span><br><span class="line"></span><br><span class="line"><span class="comment"># very dangerours, please backup all data</span></span><br><span class="line">$ zpool import -fFX -R /tmp/tank ost_11</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Security script</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Just check, not take action</span></span><br><span class="line">pool=<span class="string">"tank"</span></span><br><span class="line"><span class="comment">#find a vdev of pool</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line1</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  vdev=<span class="variable">$line1</span></span><br><span class="line">  zdb -lu <span class="variable">$vdev</span> |grep <span class="string">"txg "</span> |cut -d <span class="string">" "</span> -f 3 &gt; /tmp/txg</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">'echo ----'</span><span class="variable">$line1</span><span class="string">'-----'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> <span class="built_in">read</span> LINE;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">'echo zdb -e '</span><span class="variable">$pool</span><span class="string">' -d -t '</span><span class="variable">$LINE</span></span><br><span class="line">    <span class="built_in">echo</span> zdb -e <span class="variable">$pool</span> -d -t <span class="variable">$LINE</span></span><br><span class="line">  <span class="keyword">done</span> &lt; /tmp/txg</span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">'echo ----'</span><span class="variable">$vdev</span><span class="string">'--finish-----'</span></span><br><span class="line"><span class="keyword">done</span> &lt; zpool_devs</span><br></pre></td></tr></table></figure>

<h4 id="Try-zpool-T-parameter"><a href="#Try-zpool-T-parameter" class="headerlink" title="Try zpool -T parameter"></a><a href="https://github.com/zfsonlinux/zfs/issues/2831" target="_blank" rel="noopener">Try zpool -T parameter</a></h4><p>You’ll need to make this one line change and rebuild the module. After which you’ll be able to use the -T option. This effectively disables the logic which prevents you from using uberblocks which are older than the label.</p>
<p>import from txg, like import snapshot timestamp</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/module/zfs/vdev_label.c b/module/zfs/vdev_label.c</span><br><span class="line">index 1c2f00f..509e812 100644</span><br><span class="line">--- a/module/zfs/vdev_label.c</span><br><span class="line">+++ b/module/zfs/vdev_label.c</span><br><span class="line">@@ -471,7 +471,7 @@ retry:</span><br><span class="line">                        <span class="keyword">if</span> ((error || label_txg == 0) &amp;&amp; !config) &#123;</span><br><span class="line">                                config = label;</span><br><span class="line">                                <span class="built_in">break</span>;</span><br><span class="line">-                       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (label_txg &lt;= txg &amp;&amp; label_txg &gt; best_txg) &#123;</span><br><span class="line">+                       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (label_txg &gt; best_txg) &#123;</span><br><span class="line">                                best_txg = label_txg;</span><br><span class="line">                                nvlist_free(config);</span><br><span class="line">                                config = fnvlist_dup(label);</span><br></pre></td></tr></table></figure>

<h4 id="Add-skip-error-by-some-parameters-in-ZOL-0-8"><a href="#Add-skip-error-by-some-parameters-in-ZOL-0-8" class="headerlink" title="Add skip error by some parameters in ZOL 0.8"></a>Add skip error by some parameters in ZOL 0.8</h4><p>spa_load_verify_data<br>At the risk of data integrity, to speed extreme import of large pool<br>If this parameter is set to 0, the traversal skips non-metadata blocks. It can be toggled once the import has started to stop or start the traversal of non-metadata blocks.</p>
<p>spa_load_verify_metadata<br>At the risk of data integrity, to speed extreme import of large pool<br>If this parameter is set to 0, the traversal is not performed. It can be toggled once the import has started to stop or start the traversal</p>
<h4 id="zfs-vol"><a href="#zfs-vol" class="headerlink" title="zfs vol"></a>zfs vol</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">zfs create -V 40T -o volblocksize=128k tank/zvol</span><br><span class="line">ls -l /dev/zvol/tank/zvol</span><br><span class="line">``</span><br><span class="line"></span><br><span class="line"><span class="comment">### mount zfs</span></span><br><span class="line">```bash</span><br><span class="line">pool=tank</span><br><span class="line">zfs <span class="built_in">set</span> canmount=on <span class="variable">$pool</span></span><br><span class="line">zfs <span class="built_in">set</span> mountpoint=/mnt <span class="variable">$pool</span></span><br><span class="line">zfs mount <span class="variable">$pool</span></span><br><span class="line">rm -f /mnt/xxx/xxx/xxx</span><br><span class="line">zfs umount <span class="variable">$pool</span></span><br><span class="line">zfs <span class="built_in">set</span> canmount=off</span><br></pre></td></tr></table></figure>

<h3 id="zfs-event"><a href="#zfs-event" class="headerlink" title="zfs event"></a>zfs event</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ zpool events -c <span class="comment"># clean events</span></span><br><span class="line">$ zpool import tank</span><br><span class="line">$ zpool events -v</span><br><span class="line">$ zpool events -v &gt; zpool_import_tank</span><br></pre></td></tr></table></figure>

<h3 id="Compression"><a href="#Compression" class="headerlink" title="Compression"></a>Compression</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zfs <span class="built_in">set</span> compression=lz4 tank</span><br><span class="line">zfs <span class="built_in">set</span> compression=gzip-9 tank</span><br></pre></td></tr></table></figure>
<h3 id="Xattr"><a href="#Xattr" class="headerlink" title="Xattr"></a>Xattr</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfs <span class="built_in">set</span> xattr=sa tank</span><br></pre></td></tr></table></figure>

<h3 id="ACL"><a href="#ACL" class="headerlink" title="ACL"></a>ACL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zfs <span class="built_in">set</span> acltype=posixacl tank/gentoo/home</span><br><span class="line">zfs get acltype tank/gentoo/home</span><br></pre></td></tr></table></figure>

<h3 id="Rmount"><a href="#Rmount" class="headerlink" title="Rmount"></a>Rmount</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zfs <span class="built_in">set</span> mountpoint=/var/lib/mysql tank/mysql</span><br><span class="line">zfs umount tank/mysql</span><br><span class="line">zfs mount tank/mysql</span><br></pre></td></tr></table></figure>

<h3 id="Zpool-rename"><a href="#Zpool-rename" class="headerlink" title="Zpool rename"></a>Zpool rename</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zpool <span class="built_in">export</span> app</span><br><span class="line">zpool import app apps</span><br></pre></td></tr></table></figure>

<h3 id="Detach-hdd-from-mirror"><a href="#Detach-hdd-from-mirror" class="headerlink" title="Detach hdd from mirror"></a>Detach hdd from mirror</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">zpool detach tank sdz <span class="comment">#detach zda from mirror-17</span></span><br><span class="line">only sdal <span class="keyword">in</span> mirror-17, and mirror-17 is missing</span><br><span class="line"></span><br><span class="line">          mirror-16  ONLINE       0     0     0</span><br><span class="line">            sdai     ONLINE       0     0     0</span><br><span class="line">            sdaj     ONLINE       0     0     0</span><br><span class="line">          sdal       ONLINE       0     0     0</span><br><span class="line">          mirror-18  ONLINE       0     0     0</span><br><span class="line">            sdam     ONLINE       0     0     0</span><br><span class="line">            sdan     ONLINE       0     0     0</span><br></pre></td></tr></table></figure>

<h3 id="Attach-one-hdd-to-mirror"><a href="#Attach-one-hdd-to-mirror" class="headerlink" title="Attach one hdd to mirror"></a>Attach one hdd to mirror</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zpool attach tank sdal sdz</span><br><span class="line">          mirror-17  ONLINE       0     0     0</span><br><span class="line">            sdal     ONLINE       0     0     0</span><br><span class="line">            sdz      ONLINE       0     0     0  (resilvering)</span><br></pre></td></tr></table></figure>

<h3 id="sub-zpool"><a href="#sub-zpool" class="headerlink" title="sub zpool"></a>sub zpool</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfs create tank/<span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h3 id="Quota"><a href="#Quota" class="headerlink" title="Quota"></a>Quota</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zfs <span class="built_in">set</span> quota=1024G tank/<span class="built_in">test</span></span><br><span class="line"><span class="comment"># disable</span></span><br><span class="line">zfs <span class="built_in">set</span> quota=none tank</span><br></pre></td></tr></table></figure>

<h3 id="user-quota"><a href="#user-quota" class="headerlink" title="user quota"></a>user quota</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">zfs <span class="built_in">set</span> userquota@nagios=2G tank</span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/tank01/<span class="built_in">test</span>/nagios bs=1M</span><br><span class="line">dd: writing /tank/<span class="built_in">test</span>/nagios:Disk quota exceeded</span><br><span class="line"></span><br><span class="line"><span class="comment"># zfs get userquota@nagios</span></span><br><span class="line">NAME            PROPERTY          VALUE             SOURCE</span><br><span class="line">tank01          userquota@nagios  2G                <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># group</span></span><br><span class="line">zfs <span class="built_in">set</span> groupquota@staff=10G tank/staff/admins</span><br></pre></td></tr></table></figure>

<h3 id="Add-and-remove-hotspare"><a href="#Add-and-remove-hotspare" class="headerlink" title="Add and remove hotspare"></a>Add and remove hotspare</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zpool add tank spare c1t4d0 c1t5d0</span><br><span class="line">zpool remove tank c1t5d0</span><br></pre></td></tr></table></figure>

<h3 id="Clear-zfs-label"><a href="#Clear-zfs-label" class="headerlink" title="Clear zfs label"></a><a href="https://icesquare.com/wordpress/freebsdhow-to-remove-zfs-meta-data/" target="_blank" rel="noopener">Clear zfs label</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ zpool labelclear &#x2F;dev&#x2F;sdxxx</span><br><span class="line">or</span><br><span class="line">$ dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;&#x2F;dev&#x2F;sdXX bs&#x3D;512 count&#x3D;10</span><br><span class="line">$ dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;&#x2F;dev&#x2F;sdXX bs&#x3D;512 seek&#x3D;$(( $(blockdev --getsz &#x2F;dev&#x2F;sdXX) - 4096 ))</span><br></pre></td></tr></table></figure>

<h3 id="Auto-rebuild-in-0-7-x"><a href="#Auto-rebuild-in-0-7-x" class="headerlink" title="Auto rebuild in 0.7.x"></a>Auto rebuild in 0.7.x</h3><p><a href="https://github.com/zfsonlinux/zfs/issues/2449" target="_blank" rel="noopener">Autoreplace not working</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zpool <span class="built_in">set</span> autoreplace=on tank</span><br></pre></td></tr></table></figure>

<h3 id="Show-status"><a href="#Show-status" class="headerlink" title="Show status"></a>Show status</h3><p>Mapping /dev/shm/zil_cache to loop0p1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line">$ dd <span class="keyword">if</span>=/dev/zero of=/dev/shm/zil_cache bs=1M count=4096</span><br><span class="line">$ losetup -v -f /dev/shm/zil_cache</span><br><span class="line">$ losetup -a</span><br><span class="line">/dev/loop0: [0018]:55156303 (/dev/shm/zil_cache)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add zil by mirror</span></span><br><span class="line">$ zpool add tank <span class="built_in">log</span> mirror /dev/loop0p1 /dev/loop0p2, because it <span class="string">'s test file from /dev/shm</span></span><br><span class="line"><span class="string">$ zpool add tank log /dev/loop0p1</span></span><br><span class="line"><span class="string">$ zpool iostat -v 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">pool                                            alloc   free   read  write   read  write</span></span><br><span class="line"><span class="string">----------------------------------------------  -----  -----  -----  -----  -----  -----</span></span><br><span class="line"><span class="string">tank                                            24.4G  1.30T      0  8.74K      0   575M</span></span><br><span class="line"><span class="string">  scsi-3600605b005811bf01db36f957f619f26-part1  24.4G  1.30T      0  5.50K      0   448M</span></span><br><span class="line"><span class="string">logs                                                -      -      -      -      -      -</span></span><br><span class="line"><span class="string">  loop0p1                                        102M  3.87G      0  3.23K      0   127M</span></span><br><span class="line"><span class="string">----------------------------------------------  -----  -----  -----  -----  -----  -----</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ zpool iostat -r 1</span></span><br><span class="line"><span class="string">tank_7         sync_read    sync_write    async_read    async_write      scrub</span></span><br><span class="line"><span class="string">req_size      ind    agg    ind    agg    ind    agg    ind    agg    ind    agg</span></span><br><span class="line"><span class="string">----------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----</span></span><br><span class="line"><span class="string">512             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">1K              0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">2K              0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">4K              0      0      8      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">8K              0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">16K             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">32K             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">64K             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">128K           63      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">256K            0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">512K            0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">1M              0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">2M              0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">4M              0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">8M              0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">16M             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">--------------------------------------------------------------------------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ zpool iostat -L -v -q 2</span></span><br><span class="line"><span class="string">              capacity     operations     bandwidth    syncq_read    syncq_write   asyncq_read  asyncq_write   scrubq_read   trimq_write</span></span><br><span class="line"><span class="string">pool        alloc   free   read  write   read  write   pend  activ   pend  activ   pend  activ   pend  activ   pend  activ   pend  activ</span></span><br><span class="line"><span class="string">----------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----</span></span><br><span class="line"><span class="string">tank         161G  90.8T      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">  raidz2     161G  90.8T      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">    sda         -      -      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">    sdb         -      -      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">    sdc         -      -      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">    sdd         -      -      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">    sde         -      -      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">    sdf         -      -      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">    sdg         -      -      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">    sdi         -      -      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">    sdk         -      -      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">    sdl         -      -      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">----------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ zpool iostat -w 2</span></span><br><span class="line"><span class="string">tank         total_wait     disk_wait    syncq_wait    asyncq_wait</span></span><br><span class="line"><span class="string">latency      read  write   read  write   read  write   read  write  scrub   trim</span></span><br><span class="line"><span class="string">----------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----</span></span><br><span class="line"><span class="string">1ns             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">3ns             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">7ns             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">15ns            0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">31ns            0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">63ns            0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">127ns           0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">255ns           0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">511ns           0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">1us             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">2us             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">4us             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">8us             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">16us            0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">32us            0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">65us            0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">131us           0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">262us           0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">524us           0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">1ms             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">2ms             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">4ms             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">8ms             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">16ms            0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">33ms            0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">67ms            0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">134ms           0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">268ms           0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">536ms           0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">1s              0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">2s              0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">4s              0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">8s              0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">17s             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">34s             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">68s             0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">137s            0      0      0      0      0      0      0      0      0      0</span></span><br><span class="line"><span class="string">--------------------------------------------------------------------------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ cat /proc/spl/kstat/zfs/ost_86/dmu_tx_assign</span></span><br><span class="line"><span class="string">75 1 0x01 41 1968 259828173343194 262983153792140</span></span><br><span class="line"><span class="string">name                            type data</span></span><br><span class="line"><span class="string">1 ns                            4    0</span></span><br><span class="line"><span class="string">2 ns                            4    0</span></span><br><span class="line"><span class="string">4 ns                            4    0</span></span><br><span class="line"><span class="string">8 ns                            4    0</span></span><br><span class="line"><span class="string">16 ns                           4    0</span></span><br><span class="line"><span class="string">32 ns                           4    0</span></span><br><span class="line"><span class="string">64 ns                           4    0</span></span><br><span class="line"><span class="string">128 ns                          4    40</span></span><br><span class="line"><span class="string">256 ns                          4    40</span></span><br><span class="line"><span class="string">512 ns                          4    6</span></span><br><span class="line"><span class="string">1024 ns                         4    1</span></span><br><span class="line"><span class="string">2048 ns                         4    0</span></span><br><span class="line"><span class="string">4096 ns                         4    0</span></span><br><span class="line"><span class="string">8192 ns                         4    0</span></span><br><span class="line"><span class="string">16384 ns                        4    0</span></span><br><span class="line"><span class="string">32768 ns                        4    0</span></span><br><span class="line"><span class="string">65536 ns                        4    5</span></span><br><span class="line"><span class="string">131072 ns                       4    105</span></span><br><span class="line"><span class="string">262144 ns                       4    331</span></span><br><span class="line"><span class="string">524288 ns                       4    419</span></span><br><span class="line"><span class="string">1048576 ns                      4    325</span></span><br><span class="line"><span class="string">2097152 ns                      4    338</span></span><br><span class="line"><span class="string">4194304 ns                      4    188</span></span><br><span class="line"><span class="string">8388608 ns                      4    65</span></span><br><span class="line"><span class="string">16777216 ns                     4    59</span></span><br><span class="line"><span class="string">33554432 ns                     4    47</span></span><br><span class="line"><span class="string">67108864 ns                     4    34</span></span><br><span class="line"><span class="string">134217728 ns                    4    60</span></span><br><span class="line"><span class="string">268435456 ns                    4    55</span></span><br><span class="line"><span class="string">536870912 ns                    4    65</span></span><br><span class="line"><span class="string">1073741824 ns                   4    94</span></span><br><span class="line"><span class="string">2147483648 ns                   4    56</span></span><br><span class="line"><span class="string">4294967296 ns                   4    271</span></span><br><span class="line"><span class="string">8589934592 ns                   4    3454</span></span><br><span class="line"><span class="string">17179869184 ns                  4    4687</span></span><br><span class="line"><span class="string">34359738368 ns                  4    1970</span></span><br><span class="line"><span class="string">68719476736 ns                  4    642</span></span><br><span class="line"><span class="string">137438953472 ns                 4    380</span></span><br><span class="line"><span class="string">274877906944 ns                 4    440</span></span><br><span class="line"><span class="string">549755813888 ns                 4    299</span></span><br><span class="line"><span class="string">1099511627776 ns                4    36</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ zpool iostat -v -y -l 2</span></span><br><span class="line"><span class="string">tank                           146T  13.8T  1.46K    345  49.0M   319K   24ms    2ms   24ms    1ms  741ns  627ns  610ns    1ms      -</span></span><br><span class="line"><span class="string">  raidz3                       146T  13.8T  1.46K    345  49.0M   319K   24ms    2ms   24ms    1ms  741ns  627ns  610ns    1ms      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a66cec97        -      -     88     18  2.76M  15.6K    8ms  840us    8ms  442us  664ns  474ns  758ns  407us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a670caef        -      -     93     18  2.93M  15.1K   68ms   11ms   68ms   10ms  919ns    1us  758ns  281us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a65a02fb        -      -     73     18  2.40M  14.8K   16ms  514us   16ms  335us  714ns  758ns  568ns  239us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a670bbc7        -      -     79     17  2.74M  13.8K   10ms  556us   10ms  334us  679ns  474ns  568ns  244us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a6754b03        -      -     70     20  2.36M  15.6K   26ms  679us   26ms  360us  766ns  474ns  758ns  329us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a675ae43        -      -     88     19  2.89M  15.1K   60ms    5ms   60ms    5ms  802ns  985ns  758ns  366us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a670c787        -      -     82     20  2.61M  16.8K   15ms  833us   15ms  468us  713ns  379ns  379ns  394us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a6754d7b        -      -     97     25  3.05M  43.9K    8ms   14ms    8ms    6ms  710ns  379ns  379ns    9ms      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a67540d7        -      -     74     19  2.50M  18.3K   23ms  796us   23ms  466us  727ns  474ns  379ns  371us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a675455b        -      -     83     19  2.79M  17.3K   32ms  687us   32ms  393us  760ns  474ns  758ns  315us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a670ca8f        -      -     71     19  2.38M  17.0K    9ms  771us    9ms  398us  644ns  474ns      -  361us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a65b55bb        -      -     89     18  2.84M  16.0K    8ms  909us    8ms  567us  779ns  682ns      -  329us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a65a7f57        -      -     82     20  2.60M  17.8K   32ms  527us   32ms  318us  744ns  695ns      -  289us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a65b2683        -      -     92     17  2.99M  15.3K   57ms  687us   57ms  443us  863ns    1us  758ns  242us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a675449f        -      -     74     16  2.55M  16.0K   11ms  625us   11ms  425us  633ns  474ns  379ns  257us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a670c30f        -      -     82     16  2.82M  15.6K    9ms  808us    9ms  539us  680ns  379ns  758ns  363us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a670af17        -      -     77     19  2.65M  17.5K    8ms  876us    8ms  458us  695ns  474ns  758ns  380us      -</span></span><br><span class="line"><span class="string">    scsi-35000c500a670c2ab        -      -     95     18  3.10M  17.8K   18ms  786us   18ms  498us  770ns  758ns  379ns  333us      -</span></span><br><span class="line"><span class="string">----------------------------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----</span></span><br></pre></td></tr></table></figure>

<h3 id="Custom-script-show-temperature"><a href="#Custom-script-show-temperature" class="headerlink" title="Custom script ,show temperature"></a>Custom script ,show temperature</h3><p>/etc/zfs/zpool.d</p>
<p>$  ZPOOL_SCRIPTS_AS_ROOT=1 zpool status -c temp<br>  pool: tank<br> state: ONLINE<br>  scan: scrub repaired 0B in 0 days 06:46:11 with 0 errors on Tue Oct 15 06:46:14 2019<br>config:</p>
<pre><code>NAME        STATE     READ WRITE CKSUM  temp
tank        ONLINE       0     0     0
  raidz2-0  ONLINE       0     0     0
    sdc     ONLINE       0     0     0    27
    sdd     ONLINE       0     0     0    28
    sde     ONLINE       0     0     0    27
    sdf     ONLINE       0     0     0    29
    sdg     ONLINE       0     0     0    27
    sdh     ONLINE       0     0     0    28
logs
  mirror-1  ONLINE       0     0     0
    sda3    ONLINE       0     0     0    24
    sdb3    ONLINE       0     0     0    25
cache
  sda4      ONLINE       0     0     0    24
  sdb4      ONLINE       0     0     0    25</code></pre><p>errors: No known data errors</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### [Tuning for Scrubs and Resilvers](http:&#x2F;&#x2F;broken.net&#x2F;uncategorized&#x2F;zfs-performance-tuning-for-scrubs-and-resilvers&#x2F;)</span><br><span class="line">Prioritize resilvering by setting the delay to zero</span><br><span class="line">Idle window in clock ticks</span><br><span class="line">* set zfs:zfs_resilver_delay &#x3D; 0</span><br><span class="line"></span><br><span class="line">Prioritize scrubs by setting the delay to zero</span><br><span class="line">Number of ticks to delay scrub</span><br><span class="line">* set zfs:zfs_scrub_delay &#x3D; 0</span><br><span class="line"></span><br><span class="line">Maximum number of scrub I&#x2F;O per top-level vdev, by default 32. Increases zfs scrub speed. (at what cost, no idea)</span><br><span class="line">set maximum number of inflight IOs to a reasonable value - this number will vary for your environment</span><br><span class="line">* set zfs:zfs_top_maxinflight &#x3D; 512</span><br><span class="line"></span><br><span class="line">zfs_scan_min_time_ms:Min millisecs to scrub per txg (int)</span><br><span class="line">resilver for five seconds per TXG</span><br><span class="line">* set zfs:zfs_resilver_min_time_ms &#x3D; 5000</span><br><span class="line"></span><br><span class="line">The resilvers or scrub speed increase from 50MB&#x2F;s to 800MB&#x2F;s, increase a lot</span><br><span class="line"></span><br><span class="line">### zdb</span><br><span class="line">&#96;&#96;&#96;bash</span><br><span class="line">zdb -MM -P test_0</span><br><span class="line">        vdev          0         metaslabs  116          fragmentation 88%</span><br><span class="line">                          9: 31097798 ***********************</span><br><span class="line">                         10: 33383938 ************************</span><br><span class="line">                         11: 56520516 ****************************************</span><br><span class="line">                         12: 53907990 ***************************************</span><br><span class="line">                         13: 11130025 ********</span><br><span class="line">                         14: 4519568 ****</span><br><span class="line">                         15: 2751108 **</span><br><span class="line">                         16: 179324 *</span><br><span class="line">                         17:   2534 *</span><br><span class="line">                         18:    138 *</span><br><span class="line">                         19:     16 *</span><br><span class="line">                         20:      3 *</span><br><span class="line">                         21:      2 *</span><br><span class="line">        pool test_0     fragmentation    88%</span><br><span class="line">                          9: 31097798 ***********************</span><br><span class="line">                         10: 33383938 ************************</span><br><span class="line">                         11: 56520516 ****************************************</span><br><span class="line">                         12: 53907990 ***************************************</span><br><span class="line">                         13: 11130025 ********</span><br><span class="line">                         14: 4519568 ****</span><br><span class="line">                         15: 2751108 **</span><br><span class="line">                         16: 179324 *</span><br><span class="line">                         17:   2534 *</span><br><span class="line">                         18:    138 *</span><br><span class="line">                         19:     16 *</span><br><span class="line">                         20:      3 *</span><br><span class="line">                         21:      2 *</span><br><span class="line"></span><br><span class="line">$ zdb -b test_0</span><br><span class="line"></span><br><span class="line">Traversing all blocks to verify nothing leaked ...</span><br><span class="line"></span><br><span class="line">loading space map for vdev 0 of 1, metaslab 115 of 116 ...</span><br><span class="line">39.0G completed (1569MB&#x2F;s) estimated time remaining: 0hr 30min 43sec</span><br><span class="line">2.80T completed ( 553MB&#x2F;s) estimated time remaining: 0hr 00min 00sec</span><br><span class="line">        No leaks (block sum matches space maps exactly)</span><br><span class="line"></span><br><span class="line">        bp count:      1154215521</span><br><span class="line">        ganged count:           0</span><br><span class="line">        bp logical:    3028205925888      avg:   2623</span><br><span class="line">        bp physical:   2695917303296      avg:   2335     compression:   1.12</span><br><span class="line">        bp allocated:  3076338462208      avg:   2665     compression:   0.98</span><br><span class="line">        bp deduped:             0    ref&gt;1:      0   deduplication:   1.00</span><br><span class="line">        SPA allocated: 3076338462208     used: 77.18%</span><br><span class="line"></span><br><span class="line">        additional, non-pointer bps of type 0:         40</span><br><span class="line">        Dittoed blocks on same vdev: 590073873</span><br></pre></td></tr></table></figure>

<p>ZDB Get file info</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/tank/<span class="built_in">test</span>/1 bs=1M count=1</span><br><span class="line"></span><br><span class="line">zdb -ddddd tank/<span class="built_in">test</span></span><br><span class="line">......</span><br><span class="line">Indirect blocks:</span><br><span class="line">               0 L0 0:86bef7d8400:600 4000L/200P F=1 B=11629333/11629333</span><br><span class="line">            4000 L0 0:867fb11c400:1800 4000L/e00P F=1 B=11629333/11629333</span><br><span class="line"></span><br><span class="line">                segment [0000000000000000, 0000000000008000) size   32K</span><br><span class="line"></span><br><span class="line">    Object  lvl   iblk   dblk  dsize  dnsize  lsize   %full  <span class="built_in">type</span></span><br><span class="line">       256    2   128K   128K  1.00M     512     1M  100.00  ZFS plain file</span><br><span class="line">                                               168   bonus  System attributes</span><br><span class="line">        dnode flags: USED_BYTES USERUSED_ACCOUNTED USEROBJUSED_ACCOUNTED</span><br><span class="line">        dnode maxblkid: 7</span><br><span class="line">        path    /1</span><br><span class="line">        uid     0</span><br><span class="line">        gid     0</span><br><span class="line">        atime   Tue Dec 25 22:25:42 2018</span><br><span class="line">        mtime   Tue Dec 25 22:25:42 2018</span><br><span class="line">        ctime   Tue Dec 25 22:25:42 2018</span><br><span class="line">        crtime  Tue Dec 25 22:25:42 2018</span><br><span class="line">        gen     11630673</span><br><span class="line">        mode    100644</span><br><span class="line">        size    1048576</span><br><span class="line">        parent  34</span><br><span class="line">        links   1</span><br><span class="line">        pflags  40800000004</span><br><span class="line">Indirect blocks:</span><br><span class="line">               0 L1  0:86d5203a600:c00 20000L/400P F=8 B=11630673/11630673</span><br><span class="line">               0  L0 0:86e648c9400:30000 20000L/20000P F=1 B=11630673/11630673</span><br><span class="line">           20000  L0 0:86e648f9400:30000 20000L/20000P F=1 B=11630673/11630673</span><br><span class="line">           40000  L0 0:86e64929400:30000 20000L/20000P F=1 B=11630673/11630673</span><br><span class="line">           60000  L0 0:86e64959400:30000 20000L/20000P F=1 B=11630673/11630673</span><br><span class="line">           80000  L0 0:86e64989400:30000 20000L/20000P F=1 B=11630673/11630673</span><br><span class="line">           a0000  L0 0:86e649b9400:30000 20000L/20000P F=1 B=11630673/11630673</span><br><span class="line">           c0000  L0 0:86e649e9400:30000 20000L/20000P F=1 B=11630673/11630673</span><br><span class="line">           e0000  L0 0:86e64a19400:30000 20000L/20000P F=1 B=11630673/11630673</span><br><span class="line"></span><br><span class="line">                segment [0000000000000000, 0000000000100000) size    1M</span><br><span class="line"></span><br><span class="line">    Dnode slots:</span><br><span class="line">        Total used:             8</span><br><span class="line">        Max used:             256</span><br><span class="line">        Percent empty:  96.875000</span><br></pre></td></tr></table></figure>
<p>0:86e648c9400:30000 20000L/20000P F=1 B=11630673/11630673<br>vdev:offset:size</p>
<p>vdev=0<br>offset=86e648c9400 (offset in logic disk ?)</p>
<p>20000L/20000P means size,  compressed size(2000L),the no compression file size(2000P)<br>0x2000=131072</p>
<p>B=11630673/11630673 means write operate transaction group</p>
<h3 id="performance-tuning"><a href="#performance-tuning" class="headerlink" title="performance tuning"></a>performance tuning</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># number of z_wr_iss processes tunable</span></span><br><span class="line">zio_taskq_batch_pct</span><br><span class="line">(The bad setting will casue the performance issue, Many thanks <span class="keyword">for</span> Javen <span class="string">'s help)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">core=1</span></span><br><span class="line"><span class="string">[[ $(grep MHz /proc/cpuinfo -c) -gt 8 ]] &amp;&amp; maxcpu=8 &amp;&amp; for i in $(pgrep '</span>z_wr_iss$<span class="string">')</span></span><br><span class="line"><span class="string">do</span></span><br><span class="line"><span class="string">   [[ $core -gt $maxcpu ]] &amp;&amp; core=0</span></span><br><span class="line"><span class="string">   taskset -p -c $core $i</span></span><br><span class="line"><span class="string">   ((core++))</span></span><br><span class="line"><span class="string">done</span></span><br></pre></td></tr></table></figure>

<h3 id="check-your-zpool-could-be-imported"><a href="#check-your-zpool-could-be-imported" class="headerlink" title="check your zpool could be imported"></a>check your zpool could be imported</h3><p>running it in another server(not import the pool), you can see can be import or can not be import<br>make sure the MMP was worked</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">$ zpool import</span><br><span class="line"></span><br><span class="line"><span class="comment">## export the zpool or you have antoher server connect this zpool</span></span><br><span class="line">$ zdb -ec <span class="variable">$poolname</span></span><br><span class="line">Traversing all blocks to verify metadata checksums and verify nothing leaked ...</span><br><span class="line"></span><br><span class="line">loading space map <span class="keyword">for</span> vdev 0 of 1, metaslab 1 of 139 ...</span><br><span class="line"></span><br><span class="line">$ zdb -ec -AAA <span class="variable">$poolname</span></span><br><span class="line"><span class="comment"># if there is "assertion failure"...</span></span><br><span class="line"><span class="comment"># -AAA could not abort</span></span><br><span class="line">Configuration <span class="keyword">for</span> import:</span><br><span class="line">        vdev_children: 1</span><br><span class="line">        version: 5000</span><br><span class="line">        pool_guid: 1548875728334022114</span><br><span class="line">        name: <span class="string">'mdt_0'</span></span><br><span class="line">        state: 0</span><br><span class="line">        hostid: 4281985155</span><br><span class="line">        hostname: <span class="string">'cngb-mds-m20-1'</span></span><br><span class="line">        vdev_tree:</span><br><span class="line">            <span class="built_in">type</span>: <span class="string">'root'</span></span><br><span class="line">            id: 0</span><br><span class="line">            guid: 1548875728334022114</span><br><span class="line">            children[0]:</span><br><span class="line">                <span class="built_in">type</span>: <span class="string">'raidz'</span></span><br><span class="line">                id: 0</span><br><span class="line">                guid: 1680148767042285697</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ zdb -e -AAA <span class="variable">$poolname</span> &gt; <span class="variable">$poolnam</span></span><br><span class="line">Configuration <span class="keyword">for</span> import:</span><br><span class="line">        vdev_children: 1</span><br><span class="line">        version: 5000</span><br><span class="line">        pool_guid: 1548875728334022114</span><br><span class="line">        name: <span class="string">'mdt_0'</span></span><br><span class="line">        state: 0</span><br><span class="line">        hostid: 4281985155</span><br><span class="line">        hostname: <span class="string">'cngb-mds-m20-1'</span></span><br><span class="line">        vdev_tree:</span><br><span class="line">            <span class="built_in">type</span>: <span class="string">'root'</span></span><br><span class="line">            id: 0</span><br><span class="line">            guid: 1548875728334022114</span><br><span class="line">            children[0]:</span><br><span class="line">                <span class="built_in">type</span>: <span class="string">'raidz'</span></span><br><span class="line">                id: 0</span><br><span class="line">                guid: 1680148767042285697</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ zdb -em -AAA <span class="variable">$poolname</span> <span class="comment"># to check metalab</span></span><br><span class="line">Metaslabs:</span><br><span class="line">        vdev          0</span><br><span class="line">        metaslabs   139   offset                spacemap          free</span><br><span class="line">        ---------------   -------------------   ---------------   -------------</span><br><span class="line">        metaslab      0   offset            0   spacemap     39   free    27.6G</span><br><span class="line">        metaslab      1   offset    800000000   spacemap     55   free    31.1G</span><br><span class="line">        metaslab      2   offset   1000000000   spacemap     58   free    30.3G</span><br><span class="line">        metaslab      3   offset   1800000000   spacemap     42   free    29.4G</span><br><span class="line">        metaslab      4   offset   2000000000   spacemap     45   free    28.3G</span><br><span class="line"></span><br><span class="line"><span class="comment">#metaslab check</span></span><br></pre></td></tr></table></figure>

<h3 id="zpool-status"><a href="#zpool-status" class="headerlink" title="zpool status"></a>zpool status</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ zpool status -x -v</span><br><span class="line">$ zpool status -v</span><br><span class="line"></span><br><span class="line">errors: Permanent errors have been detected <span class="keyword">in</span> the following files:</span><br><span class="line"></span><br><span class="line">        tank/mdt_0:/oi.1/0x1:0x1fcc1:0x0</span><br><span class="line">        tank/mdt_0:/oi.1/0x1:0x1fcc5:0x0</span><br><span class="line">        tank/mdt_0:/oi.1/0x1:0x1fccc:0x0</span><br><span class="line">        tank/mdt_0:/oi.1/0x1:0x1fcc2:0x0</span><br></pre></td></tr></table></figure>

<h3 id="Disable-AVX512-for-scalable-Xeon-silver-and-gold-5xxx"><a href="#Disable-AVX512-for-scalable-Xeon-silver-and-gold-5xxx" class="headerlink" title="Disable AVX512 for scalable Xeon silver and gold 5xxx"></a>Disable AVX512 for scalable Xeon silver and gold 5xxx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Gold 5115</span></span><br><span class="line">$ cat /proc/spl/kstat/zfs/fletcher_4_bench</span><br><span class="line">0 0 0x01 -1 0 43875755056 2388098231282525</span><br><span class="line">implementation   native         byteswap</span><br><span class="line">scalar           5097645469     4106654089</span><br><span class="line">superscalar      6876819423     5086086480</span><br><span class="line">superscalar4     5926587517     4946863265</span><br><span class="line">sse2             11659567916    6572225291</span><br><span class="line">ssse3            11660661610    10379355285</span><br><span class="line">avx2             17865482202    16120833783</span><br><span class="line">avx512f          24802818495    8841728748</span><br><span class="line">fastest          avx512f        avx2</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> ssse3 &gt; /sys/module/zcommon/parameters/zfs_fletcher_4_impl</span><br><span class="line"><span class="built_in">echo</span> ssse3 &gt; /sys/module/zfs/parameters/zfs_vdev_raidz_impl</span><br></pre></td></tr></table></figure>
<p>Because I ‘m wrong about when avx2 or avx512 called, The cpu will reduce the frequency and it will impact the others (no avx system call) at the same time<br><a href="https://github.com/zfsonlinux/zfs/wiki/ZFS-on-Linux-Module-Parameters#zfs_vdev_raidz_impl" target="_blank" rel="noopener">zfs_vdev_raidz_impl</a><br><a href="https://github.com/zfsonlinux/zfs/wiki/ZFS-on-Linux-Module-Parameters#zfs_fletcher_4_impl" target="_blank" rel="noopener">zfs_fletcher_4_impl</a></p>
<p>or you could disable AVX by kernel parameter</p>
<h1 id="not-make-sure"><a href="#not-make-sure" class="headerlink" title="not make sure"></a>not make sure</h1><h3 id="Too-bad-about-zfs-dracut"><a href="#Too-bad-about-zfs-dracut" class="headerlink" title="Too bad about zfs-dracut"></a>Too bad about zfs-dracut</h3><p>In zfs old version 0.6.x, there is no multihost parameter.<br>When you upgrade to 0.7.x, it ‘s not enable by default !!!  but you can see the mmp history is worked !!!<br>So if you zfs-dracut , maybe you will be brain-split, lsinitrd show hostid == 0 !!!<br>My version is 0.7.9-1</p>
<p>##not make sure<br>lsinitrd</p>
<p>Thanks Javen Wu save me again…</p>
<p>You could unistall the package or remove it , zfs dracut is too dangerous for HA arch</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rpm -ql zfs-dracut-0.7.9-1.el7.x86_64</span><br><span class="line">/usr/lib/dracut/modules.d/02zfsexpandknowledge</span><br><span class="line">/usr/lib/dracut/modules.d/02zfsexpandknowledge/module-setup.sh</span><br><span class="line">/usr/lib/dracut/modules.d/90zfs</span><br><span class="line">/usr/lib/dracut/modules.d/90zfs/<span class="built_in">export</span>-zfs.sh</span><br><span class="line">/usr/lib/dracut/modules.d/90zfs/module-setup.sh</span><br><span class="line">/usr/lib/dracut/modules.d/90zfs/mount-zfs.sh</span><br><span class="line">/usr/lib/dracut/modules.d/90zfs/parse-zfs.sh</span><br><span class="line">/usr/lib/dracut/modules.d/90zfs/zfs-generator.sh</span><br><span class="line">/usr/lib/dracut/modules.d/90zfs/zfs-lib.sh</span><br><span class="line">/usr/lib/dracut/modules.d/90zfs/zfs-needshutdown.sh</span><br><span class="line">/usr/share/doc/zfs-dracut-0.7.9</span><br><span class="line">/usr/share/doc/zfs-dracut-0.7.9/README.dracut.markdown</span><br></pre></td></tr></table></figure>

<h3 id="ZFS-0-7-x-MMP-cause-too-many-issues-the-ZFS-0-6-5-more-stable"><a href="#ZFS-0-7-x-MMP-cause-too-many-issues-the-ZFS-0-6-5-more-stable" class="headerlink" title="ZFS 0.7.x MMP cause too many issues, the ZFS 0.6.5 more stable"></a>ZFS 0.7.x MMP cause too many issues, the ZFS 0.6.5 more stable</h3><ul>
<li><a href="https://github.com/zfsonlinux/zfs/issues/7834" target="_blank" rel="noopener">Performance impact</a></li>
<li><a href="https://github.com/zfsonlinux/zfs/issues/7731" target="_blank" rel="noopener">Zpool import slow</a></li>
<li><a href="https://github.com/zfsonlinux/zfs/issues/7709" target="_blank" rel="noopener">Disk fail cause zpool suspend</a><ul>
<li><a href="https://github.com/zfsonlinux/zfs/pull/8495" target="_blank" rel="noopener">2</a></li>
</ul>
</li>
</ul>
<h3 id="Resolved-import-too-slow"><a href="#Resolved-import-too-slow" class="headerlink" title="Resolved import too slow"></a>Resolved import too slow</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat /sys/module/zfs/parameters/zfs_multihost_import_intervals</span><br><span class="line">10</span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /sys/module/zfs/parameters/zfs_multihost_import_intervals</span><br><span class="line">$ zpool import -a</span><br><span class="line">$ <span class="built_in">echo</span> 10 &gt; /sys/module/zfs/parameters/zfs_multihost_import_intervals</span><br></pre></td></tr></table></figure>

<h3 id="Enable-zfs-message-log"><a href="#Enable-zfs-message-log" class="headerlink" title="Enable zfs message log"></a>Enable zfs message log</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> 1 &gt;/sys/module/zfs/parameters/zfs_dbgmsg_enable</span><br><span class="line">$ cat /proc/spl/kstat/zfs/dbgmsg</span><br></pre></td></tr></table></figure>

<h3 id="Remove-slog"><a href="#Remove-slog" class="headerlink" title="Remove slog"></a>Remove slog</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## slog device has been destroy, skip/bypass import slog</span></span><br><span class="line">$ zpool import -m -a -f</span><br><span class="line"></span><br><span class="line">$ zpool status -x</span><br><span class="line">  pool: tank</span><br><span class="line"> state: DEGRADED</span><br><span class="line">status: One or more devices could not be used because the label is missing or</span><br><span class="line">        invalid.  Sufficient replicas exist <span class="keyword">for</span> the pool to <span class="built_in">continue</span></span><br><span class="line">        functioning <span class="keyword">in</span> a degraded state.</span><br><span class="line">action: Replace the device using <span class="string">'zpool replace'</span>.</span><br><span class="line">   see: http://zfsonlinux.org/msg/ZFS-8000-4J</span><br><span class="line">  scan: scrub repaired 0B <span class="keyword">in</span> 0 days 06:46:11 with 0 errors on Mon Oct 14 18:46:14 2019</span><br><span class="line">config:</span><br><span class="line"></span><br><span class="line">        NAME                      STATE     READ WRITE CKSUM</span><br><span class="line">        tank                      DEGRADED     0     0     0</span><br><span class="line">          raidz2-0                ONLINE       0     0     0</span><br><span class="line">            sdc                   ONLINE       0     0     0</span><br><span class="line">            sdd                   ONLINE       0     0     0</span><br><span class="line">            sde                   ONLINE       0     0     0</span><br><span class="line">            sdf                   ONLINE       0     0     0</span><br><span class="line">            sdg                   ONLINE       0     0     0</span><br><span class="line">            sdh                   ONLINE       0     0     0</span><br><span class="line">        logs</span><br><span class="line">          mirror-1                UNAVAIL      0     0     0  insufficient replicas</span><br><span class="line">            13378777246457412929  UNAVAIL      0     0     0  was /dev/sda3</span><br><span class="line">            1725913437883392852   UNAVAIL      0     0     0  was /dev/sdb</span><br><span class="line"></span><br><span class="line">$ zpool remove tank mirror-1</span><br><span class="line">that ok</span><br></pre></td></tr></table></figure>

<h3 id="About-SMR-HDD"><a href="#About-SMR-HDD" class="headerlink" title="About SMR HDD"></a><a href="https://github.com/zfsonlinux/zfs/issues/4877" target="_blank" rel="noopener">About SMR HDD</a></h3><p>Another thing you might try is to leave the block size set at 1M but increase the zfs_vdev_aggregation_limit to 16M. This way as long as your doing 1M aligned IO you should never write partial blocks and leave holes. ZFS will aggregate these 1M blocks in to larger 16M IOs to the disk.</p>
<p><a href="http://broken.net/uncategorized/zfs-performance-tuning-for-scrubs-and-resilvers/" target="_blank" rel="noopener">zfs-performance-tuning-for-scrubs-and-resilvers</a><br><a href="https://forum.proxmox.com/threads/zfs-zil-log-txg_sync-causing-high-io-every-5-seconds-any-solution.24376/" target="_blank" rel="noopener">zfs-zil-log-txg_sync-causing-high-io-every-5-seconds</a><br><a href="https://www.svennd.be/tuning-of-zfs-module/" target="_blank" rel="noopener">tuning zfs module</a><br><a href="http://lustre.ornl.gov/ecosystem-2016/documents/tutorials/Stearman-LLNL-ZFS.pdf" target="_blank" rel="noopener">Stearman-LLNL-ZFS</a><br><a href="http://fibrevillage.com/storage/171-zfs-on-linux-performance-tuning" target="_blank" rel="noopener">171-zfs-on-linux-performance</a><br><a href="http://list.zfsonlinux.org/pipermail/zfs-discuss/2018-March/030666.html" target="_blank" rel="noopener">Is the number of z_wr_iss processes tunable?</a><br><a href="https://www.beegfs.io/wiki/StorageServerTuning#hn_59ca4f8bbb_16" target="_blank" rel="noopener">Tips and Recommendations for Storage Server Tuning</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/zfs/" rel="tag"><i class="fa fa-tag"></i> zfs</a>
              <a href="/tags/scsi/" rel="tag"><i class="fa fa-tag"></i> scsi</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2016/09/04/kcptun/" rel="prev" title="proxychains and kcptun">
      <i class="fa fa-chevron-left"></i> proxychains and kcptun
    </a></div>
      <div class="post-nav-item">
    <a href="/2016/12/18/sparse/" rel="next" title="sparse file data segment">
      sparse file data segment <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#How-many-devices-in-single-raidz-zpool"><span class="nav-number">1.</span> <span class="nav-text">How many devices in single raidz zpool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NVME-SSD-test-with-openzfs-0-7"><span class="nav-number">2.</span> <span class="nav-text">NVME SSD test with openzfs 0.7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6x-Intel-P3520"><span class="nav-number">3.</span> <span class="nav-text">[6x Intel P3520]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#the-old-optimize-with-lustre"><span class="nav-number">4.</span> <span class="nav-text">the old optimize with lustre</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#zfs-txg-timeout"><span class="nav-number">4.1.</span> <span class="nav-text">zfs_txg_timeout</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#L2ARC-and-slog"><span class="nav-number">4.2.</span> <span class="nav-text">L2ARC and slog</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#max-write-speed-to-l2arc"><span class="nav-number"></span> <span class="nav-text">max write speed to l2arc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#tradeoff-between-write-read-and-durability-of-ssd"><span class="nav-number"></span> <span class="nav-text">tradeoff between write&#x2F;read and durability of ssd (?)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#default-8-1024-1024-8-MB-s"><span class="nav-number"></span> <span class="nav-text">default : 8 * 1024 * 1024  &#x3D; 8 MB&#x2F;s</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#setting-here-500-1024-1024"><span class="nav-number"></span> <span class="nav-text">setting here : 500 * 1024 * 1024</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#number-of-max-device-writes-to-precache"><span class="nav-number"></span> <span class="nav-text">number of max device writes to precache</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#default-2"><span class="nav-number"></span> <span class="nav-text">default : 2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#default-32768"><span class="nav-number"></span> <span class="nav-text">default : 32768</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#default-1024-1024-1mb"><span class="nav-number"></span> <span class="nav-text">default : 1024*1024 &#x3D; 1mb</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#zfs-vdev-scheduler"><span class="nav-number">0.1.</span> <span class="nav-text">zfs_vdev_scheduler</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#zfs-read-chunk-size"><span class="nav-number">0.2.</span> <span class="nav-text">zfs_read_chunk_size</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#zfs-max-recordsize"><span class="nav-number">0.3.</span> <span class="nav-text">zfs_max_recordsize</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#zfs-vdev-aggregation-limit"><span class="nav-number">0.4.</span> <span class="nav-text">zfs_vdev_aggregation_limit</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HDD-prefetch"><span class="nav-number">0.5.</span> <span class="nav-text">HDD prefetch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Vdev-cache"><span class="nav-number">0.6.</span> <span class="nav-text">Vdev cache</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#txg-timeout"><span class="nav-number">0.7.</span> <span class="nav-text">txg_timeout</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#zpool-sync-mode"><span class="nav-number">0.8.</span> <span class="nav-text">zpool sync mode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Limit-memory-usage"><span class="nav-number">0.9.</span> <span class="nav-text">Limit memory usage</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#zfs-multihost-history"><span class="nav-number">0.10.</span> <span class="nav-text">zfs_multihost_history</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zpool-could-not-mount"><span class="nav-number">1.</span> <span class="nav-text">[zpool could not mount]</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Try-zpool-T-parameter"><span class="nav-number">1.1.</span> <span class="nav-text">Try zpool -T parameter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Add-skip-error-by-some-parameters-in-ZOL-0-8"><span class="nav-number">1.2.</span> <span class="nav-text">Add skip error by some parameters in ZOL 0.8</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#zfs-vol"><span class="nav-number">1.3.</span> <span class="nav-text">zfs vol</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zfs-event"><span class="nav-number">2.</span> <span class="nav-text">zfs event</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Compression"><span class="nav-number">3.</span> <span class="nav-text">Compression</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Xattr"><span class="nav-number">4.</span> <span class="nav-text">Xattr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ACL"><span class="nav-number">5.</span> <span class="nav-text">ACL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rmount"><span class="nav-number">6.</span> <span class="nav-text">Rmount</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Zpool-rename"><span class="nav-number">7.</span> <span class="nav-text">Zpool rename</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Detach-hdd-from-mirror"><span class="nav-number">8.</span> <span class="nav-text">Detach hdd from mirror</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Attach-one-hdd-to-mirror"><span class="nav-number">9.</span> <span class="nav-text">Attach one hdd to mirror</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sub-zpool"><span class="nav-number">10.</span> <span class="nav-text">sub zpool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Quota"><span class="nav-number">11.</span> <span class="nav-text">Quota</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#user-quota"><span class="nav-number">12.</span> <span class="nav-text">user quota</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Add-and-remove-hotspare"><span class="nav-number">13.</span> <span class="nav-text">Add and remove hotspare</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Clear-zfs-label"><span class="nav-number">14.</span> <span class="nav-text">Clear zfs label</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Auto-rebuild-in-0-7-x"><span class="nav-number">15.</span> <span class="nav-text">Auto rebuild in 0.7.x</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Show-status"><span class="nav-number">16.</span> <span class="nav-text">Show status</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Custom-script-show-temperature"><span class="nav-number">17.</span> <span class="nav-text">Custom script ,show temperature</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#performance-tuning"><span class="nav-number">18.</span> <span class="nav-text">performance tuning</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#check-your-zpool-could-be-imported"><span class="nav-number">19.</span> <span class="nav-text">check your zpool could be imported</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zpool-status"><span class="nav-number">20.</span> <span class="nav-text">zpool status</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Disable-AVX512-for-scalable-Xeon-silver-and-gold-5xxx"><span class="nav-number">21.</span> <span class="nav-text">Disable AVX512 for scalable Xeon silver and gold 5xxx</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#not-make-sure"><span class="nav-number"></span> <span class="nav-text">not make sure</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Too-bad-about-zfs-dracut"><span class="nav-number">1.</span> <span class="nav-text">Too bad about zfs-dracut</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZFS-0-7-x-MMP-cause-too-many-issues-the-ZFS-0-6-5-more-stable"><span class="nav-number">2.</span> <span class="nav-text">ZFS 0.7.x MMP cause too many issues, the ZFS 0.6.5 more stable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Resolved-import-too-slow"><span class="nav-number">3.</span> <span class="nav-text">Resolved import too slow</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enable-zfs-message-log"><span class="nav-number">4.</span> <span class="nav-text">Enable zfs message log</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Remove-slog"><span class="nav-number">5.</span> <span class="nav-text">Remove slog</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#About-SMR-HDD"><span class="nav-number">6.</span> <span class="nav-text">About SMR HDD</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ginger"
      src="/img/logo-4-blog.png">
  <p class="site-author-name" itemprop="name">Ginger</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">47</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">54</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ginger</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">694k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">10:31</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.6.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://b946c5a0bf547c89.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "http://yoursite.com/2016/12/04/openzfs-tips/",
            identifier: "2016/12/04/openzfs-tips/",
            title: "openzfs tips"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://b946c5a0bf547c89.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
