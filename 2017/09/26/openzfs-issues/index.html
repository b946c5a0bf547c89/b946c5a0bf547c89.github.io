<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="OpenZFS on linux issues record">
<meta property="og:type" content="article">
<meta property="og:title" content="openzfs issues">
<meta property="og:url" content="http://yoursite.com/2017/09/26/openzfs-issues/index.html">
<meta property="og:site_name" content="b946c5a0bf547c89">
<meta property="og:description" content="OpenZFS on linux issues record">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://homerl.github.io/2018/06/05/SAS-JBOD-issues/">
<meta property="og:image" content="https://github.com/zfsonlinux/zfs/issues/7118">
<meta property="article:published_time" content="2017-09-26T08:30:03.000Z">
<meta property="article:modified_time" content="2020-01-05T12:47:22.692Z">
<meta property="article:author" content="Ginger">
<meta property="article:tag" content="zfs">
<meta property="article:tag" content="scsi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://homerl.github.io/2018/06/05/SAS-JBOD-issues/">

<link rel="canonical" href="http://yoursite.com/2017/09/26/openzfs-issues/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>openzfs issues | b946c5a0bf547c89</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">b946c5a0bf547c89</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">My Silent Hill</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/26/openzfs-issues/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo-4-blog.png">
      <meta itemprop="name" content="Ginger">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b946c5a0bf547c89">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          openzfs issues
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-09-26 16:30:03" itemprop="dateCreated datePublished" datetime="2017-09-26T16:30:03+08:00">2017-09-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-05 20:47:22" itemprop="dateModified" datetime="2020-01-05T20:47:22+08:00">2020-01-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/filesystem/" itemprop="url" rel="index">
                    <span itemprop="name">filesystem</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2017/09/26/openzfs-issues/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/09/26/openzfs-issues/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>66k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1:01</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>OpenZFS on linux issues record</p>
<a id="more"></a>

<h3 id="About-SMR-HDD"><a href="#About-SMR-HDD" class="headerlink" title="About SMR HDD"></a><a href="https://github.com/zfsonlinux/zfs/issues/4877" target="_blank" rel="noopener">About SMR HDD</a></h3><p>Another thing you might try is to leave the block size set at 1M but increase the zfs_vdev_aggregation_limit to 16M. This way as long as your doing 1M aligned IO you should never write partial blocks and leave holes. ZFS will aggregate these 1M blocks in to larger 16M IOs to the disk.</p>
<h3 id="I-don-‘t-think-it-‘s-the-MMP-issue-because-the-same-issue-in-OpenZFS-0-6-5-7"><a href="#I-don-‘t-think-it-‘s-the-MMP-issue-because-the-same-issue-in-OpenZFS-0-6-5-7" class="headerlink" title="I don ‘t think it ‘s the MMP issue, because the same issue in OpenZFS 0.6.5.7"></a>I don ‘t think it ‘s the MMP issue, because the same issue in OpenZFS 0.6.5.7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> state: DEGRADED</span><br><span class="line">status: One or more devices could not be used because the label is missing or</span><br><span class="line">        invalid.  Sufficient replicas exist <span class="keyword">for</span> the pool to <span class="built_in">continue</span></span><br><span class="line">        functioning <span class="keyword">in</span> a degraded state.</span><br></pre></td></tr></table></figure>

<h4 id="Reproduce-the-issue-and-my-work-experiences"><a href="#Reproduce-the-issue-and-my-work-experiences" class="headerlink" title="Reproduce the issue and my work experiences."></a>Reproduce the issue and my work experiences.</h4><ol>
<li>offline 4 disks at the single zpool<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /sys/block/sdc/device/delete</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /sys/block/sdd/device/delete</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /sys/block/sde/device/delete</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /sys/block/sdf/device/delete</span><br></pre></td></tr></table></figure></li>
<li>Plug out SAS expander or SAS Adapter or SAS cable you could reproduce it</li>
<li>Bad SAS cable, replace cable</li>
<li>SAS HBA,Expander,device Firmware update could reslove it<br> especially some of 10TB HDD old firmware, the hdd could be idle, hang, cause the system timeout<br><img src="http://homerl.github.io/2018/06/05/SAS-JBOD-issues/" alt="For more info"></li>
</ol>
<h5 id="Looks-like-MMP-will-cause-more-issues-on-zfs-0-7-9"><a href="#Looks-like-MMP-will-cause-more-issues-on-zfs-0-7-9" class="headerlink" title="Looks like MMP will cause more issues on zfs 0.7.9"></a>Looks like MMP will cause more issues on zfs 0.7.9</h5><p><a href="https://github.com/zfsonlinux/zfs/issues/745" target="_blank" rel="noopener">745</a>, The origin of Evil, because lustre, lustre will destory everything ,haha<br><a href="https://github.com/zfsonlinux/zfs/issues/7045" target="_blank" rel="noopener">7045</a>, because some of sas dev too busy, improve the check time<br><a href="https://github.com/zfsonlinux/zfs/issues/7118" target="_blank" rel="noopener">7118</a>, MMP cause more issues, if your JBOD/HBD/HDD has not return immediately<br><a href="https://github.com/zfsonlinux/zfs/issues/7709" target="_blank" rel="noopener">7709</a></p>
<p>zfs_multihost_fail_intervals:Max allowed period without a successful mmp write<br>zfs_multihost_import_intervals:Number of zfs_multihost_interval periods to wait for activity<br>zfs_multihost_interval:Milliseconds between mmp writes to each leaf</p>
<p>echo 100 &gt;  /sys/module/zfs/parameters/zfs_multihost_fail_intervals;<br>echo 200 &gt; /sys/module/zfs/parameters/zfs_multihost_import_intervals<br>echo 6000 &gt; /sys/module/zfs/parameters/zfs_multihost_interval<br>100 zfs_multihost_fail_intervals * 6000 zfs_multihost_interval = 600,000 ms</p>
<p>When  zfs_multihost_fail_intervals &gt; 0 then sequential mul‐tihost write failures will cause the pool to be  suspended.<br>      This occurs when zfs_multihost_fail_intervals * zfs_multi‐host_interval milliseconds have passed since the last successful<br>      multihost write.  This guarantees the activity test will see multihost writes if the pool is imported.</p>
<p>zfs_multihost_fail_intervals &gt;= zfs_multihost_import_intervals which could allow a pool to be imported on two nodes without any warnings.<br>MMP writes are done in the context of the sync thread</p>
<p>Looks like you have to reduce block timeout to avoid zfs MMP timeout, that too bad</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  pool: zpool</span><br><span class="line"> state: ONLINE</span><br><span class="line">status: The pool is suspended because multihost writes failed or were delayed;</span><br><span class="line">	another system could import the pool undetected</span><br></pre></td></tr></table></figure>

<h4 id="Openzfs-issue"><a href="#Openzfs-issue" class="headerlink" title="Openzfs issue"></a>Openzfs issue</h4><p><img src="https://github.com/zfsonlinux/zfs/issues/7118" alt="7118"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 100 &gt;/sys/module/zfs/parameters/zfs_multihost_history</span><br><span class="line">&lt;run <span class="built_in">test</span>&gt;</span><br><span class="line">cat /proc/spl/kstat/zfs/&lt;pool&gt;/multihost</span><br><span class="line"></span><br><span class="line">or you could increase the timeout intervals at zfs_multihost_fail_intervals </span><br><span class="line">my production env zfs version is 0.7.3</span><br><span class="line"></span><br><span class="line"><span class="comment">## get zpool log</span></span><br><span class="line">zpool events -v</span><br></pre></td></tr></table></figure>

<h3 id="zpool-could-not-mount"><a href="#zpool-could-not-mount" class="headerlink" title="[zpool could not mount]"></a>[zpool could not mount]</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ zpool import -o <span class="built_in">readonly</span>=on -o cachefile=none tank</span><br><span class="line">$ zpool import -Nm tank</span><br></pre></td></tr></table></figure>

<h3 id="Replace-FX-parameter"><a href="#Replace-FX-parameter" class="headerlink" title="[Replace FX parameter]"></a>[Replace FX parameter]</h3><h4 id="very-dangerours"><a href="#very-dangerours" class="headerlink" title="very dangerours"></a>very dangerours</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### -F will cause unrecoverable result, don 't use it</span></span><br><span class="line">$ zpool import -fFX -R /tmp/tank ost_11</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">### Just check, not take action</span></span><br><span class="line">pool=<span class="string">"your_pool_name"</span></span><br><span class="line"><span class="comment">#find a vdev of pool</span></span><br><span class="line">vdev=<span class="string">"/dev/mapper/35000cca2515fc6ac"</span></span><br><span class="line">zdb -lu <span class="variable">$vdev</span> |grep <span class="string">"txg "</span> |cut -d <span class="string">" "</span> -f 3 &gt; /tmp/txg</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> LINE;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">zdb -e <span class="variable">$pool</span> -d -t <span class="variable">$LINE</span></span><br><span class="line"><span class="keyword">done</span> &lt; /tmp/txg</span><br></pre></td></tr></table></figure>


<h4 id="Import-zpool-hang-single-dev-just-respond-very-slow-cause-all-zpool-command-hang"><a href="#Import-zpool-hang-single-dev-just-respond-very-slow-cause-all-zpool-command-hang" class="headerlink" title="Import zpool hang, single dev just respond very slow cause all zpool command hang"></a>Import zpool hang, single dev just respond very slow cause all zpool command hang</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /sys/class/block/sddh/device/delete</span><br><span class="line"><span class="comment">### remove the dev, all has been imported</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## issue log</span></span><br><span class="line">$ lsscsi -git  | grep sg118</span><br><span class="line">[17:0:116:0] disk    sas:0x5000c500a65b61f1          /dev/sddh  35000c500a65b61f3  /dev/sg118</span><br><span class="line">[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: Attached scsi generic sg178 <span class="built_in">type</span> 0</span><br><span class="line">[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] Enabling DIF Type 2 protection</span><br><span class="line">[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] 19134414848 512-byte logical blocks: (9.79 TB/8.91 TiB)</span><br><span class="line">[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] 4096-byte physical blocks</span><br><span class="line">[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] Write Protect is off</span><br><span class="line">[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] Mode Sense: d7 00 10 08</span><br><span class="line">[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] Write cache: enabled, <span class="built_in">read</span> cache: enabled, supports DPO and FUA</span><br><span class="line">[Sun Sep 23 11:03:43 2018]  sdfm: sdfm1 sdfm9</span><br><span class="line">[Sun Sep 23 11:03:43 2018] sd 17:0:176:0: [sdfm] Attached SCSI disk</span><br><span class="line">[Sun Sep 23 11:03:44 2018] scsi 17:0:177:0: Attached scsi generic sg179 <span class="built_in">type</span> 3</span><br><span class="line">[Sun Sep 23 11:07:09 2018] sd 17:0:116:0: attempting task abort! scmd(ffff88100abf2f40)</span><br><span class="line">[Sun Sep 23 11:07:09 2018] sd 17:0:116:0: [sg118] CDB: Inquiry 12 01 dc 01 52 00</span><br><span class="line">[Sun Sep 23 11:07:09 2018] scsi target17:0:116: handle(0x0087), sas_address(0x5000c500a65b61f1), phy(34)</span><br><span class="line">[Sun Sep 23 11:07:09 2018] scsi target17:0:116: enclosure_logical_id(0x50050cc11ac01572), slot(56)</span><br><span class="line">[Sun Sep 23 11:07:09 2018] sd 17:0:116:0: task abort: SUCCESS scmd(ffff88100abf2f40)</span><br><span class="line">[Sun Sep 23 11:07:09 2018] sd 17:0:116:0: attempting task abort! scmd(ffff880fe9784ec0)</span><br><span class="line">[Sun Sep 23 11:07:09 2018] sd 17:0:116:0: [sg118] CDB: Inquiry 12 01 dc 01 52 00</span><br><span class="line">[Sun Sep 23 11:07:09 2018] scsi target17:0:116: handle(0x0087), sas_address(0x5000c500a65b61f1), phy(34)</span><br><span class="line">[Sun Sep 23 11:07:09 2018] scsi target17:0:116: enclosure_logical_id(0x50050cc11ac01572), slot(56)</span><br><span class="line">[Sun Sep 23 11:07:09 2018] sd 17:0:116:0: task abort: SUCCESS scmd(ffff880fe9784ec0)</span><br><span class="line">[Sun Sep 23 11:07:58 2018] INFO: task zpool:3155 blocked <span class="keyword">for</span> more than 120 seconds.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] <span class="string">"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs"</span> disables this message.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] zpool           D ffffffffc0ade588     0  3155   3152 0x00000084</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff881011267ce0 0000000000000082 ffff881025d0cf10 ffff881011267fd8</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff881011267fd8 ffff881011267fd8 ffff881025d0cf10 ffffffffc0ade580</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff881025d0cf10 00000000ffffffff ffffffffc0ade588</span><br><span class="line">[Sun Sep 23 11:07:58 2018] Call Trace:</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d0744&gt;] spa_import+0x54/0x730 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc062cfc2&gt;] ? nvlist_lookup_common.part.71+0xa2/0xb0 [znvpair]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc090bc37&gt;] zfs_ioc_pool_import+0x147/0x160 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0910846&gt;] zfsdev_ioctl+0x606/0x650 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff812151bd&gt;] do_vfs_ioctl+0x33d/0x540</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b0091&gt;] ? __do_page_fault+0x171/0x450</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff81215461&gt;] SyS_ioctl+0xa1/0xc0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b5089&gt;] system_call_fastpath+0x16/0x1b</span><br><span class="line">[Sun Sep 23 11:07:58 2018] INFO: task zpool:3157 blocked <span class="keyword">for</span> more than 120 seconds.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] <span class="string">"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs"</span> disables this message.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] zpool           D ffffffffc0ade588     0  3157   3153 0x00000084</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff881011283c60 0000000000000086 ffff88103b1fdee0 ffff881011283fd8</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff881011283fd8 ffff881011283fd8 ffff88103b1fdee0 ffffffffc0ade580</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff88103b1fdee0 00000000ffffffff ffffffffc0ade588</span><br><span class="line">[Sun Sep 23 11:07:58 2018] Call Trace:</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cee41&gt;] spa_open_common+0x61/0x4d0 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff8118cb26&gt;] ? __alloc_pages_nodemask+0x176/0x420</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cf334&gt;] spa_get_stats+0x54/0x550 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc06021a0&gt;] ? spl_kmem_zalloc+0xc0/0x170 [spl]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff811ddbee&gt;] ? __kmalloc_node+0x27e/0x2b0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc090c019&gt;] zfs_ioc_pool_stats+0x39/0x90 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0910846&gt;] zfsdev_ioctl+0x606/0x650 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff812151bd&gt;] do_vfs_ioctl+0x33d/0x540</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b0091&gt;] ? __do_page_fault+0x171/0x450</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff81215461&gt;] SyS_ioctl+0xa1/0xc0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b5089&gt;] system_call_fastpath+0x16/0x1b</span><br><span class="line">[Sun Sep 23 11:07:58 2018] INFO: task zpool:3159 blocked <span class="keyword">for</span> more than 120 seconds.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] <span class="string">"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs"</span> disables this message.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] zpool           D ffffffffc0ade588     0  3159   3156 0x00000084</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff88101128bc60 0000000000000086 ffff88102fb3af70 ffff88101128bfd8</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff88101128bfd8 ffff88101128bfd8 ffff88102fb3af70 ffffffffc0ade580</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff88102fb3af70 00000000ffffffff ffffffffc0ade588</span><br><span class="line">[Sun Sep 23 11:07:58 2018] Call Trace:</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cee41&gt;] spa_open_common+0x61/0x4d0 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff8118cb26&gt;] ? __alloc_pages_nodemask+0x176/0x420</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cf334&gt;] spa_get_stats+0x54/0x550 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc06021a0&gt;] ? spl_kmem_zalloc+0xc0/0x170 [spl]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff811ddbee&gt;] ? __kmalloc_node+0x27e/0x2b0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc090c019&gt;] zfs_ioc_pool_stats+0x39/0x90 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0910846&gt;] zfsdev_ioctl+0x606/0x650 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff812151bd&gt;] do_vfs_ioctl+0x33d/0x540</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b0091&gt;] ? __do_page_fault+0x171/0x450</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff81215461&gt;] SyS_ioctl+0xa1/0xc0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b5089&gt;] system_call_fastpath+0x16/0x1b</span><br><span class="line">[Sun Sep 23 11:07:58 2018] INFO: task z_zvol:5492 blocked <span class="keyword">for</span> more than 120 seconds.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] <span class="string">"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs"</span> disables this message.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] z_zvol          D ffffffffc0ade588     0  5492      2 0x00000080</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff88100ef0f9a0 0000000000000046 ffff881033e46eb0 ffff88100ef0ffd8</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff88100ef0ffd8 ffff88100ef0ffd8 ffff881033e46eb0 ffffffffc0ade580</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff881033e46eb0 00000000ffffffff ffffffffc0ade588</span><br><span class="line">[Sun Sep 23 11:07:58 2018] Call Trace:</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cee41&gt;] spa_open_common+0x61/0x4d0 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08761d6&gt;] ? dbuf_rele+0x36/0x40 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cf2d3&gt;] spa_open+0x13/0x20 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08ad4f3&gt;] dsl_pool_hold+0x33/0x80 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0885935&gt;] dmu_objset_hold+0x35/0xd0 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08af0d4&gt;] dsl_prop_get+0x44/0xa0 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08af14e&gt;] dsl_prop_get_integer+0x1e/0x20 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc094269b&gt;] zvol_create_minors_cb+0x3b/0x140 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08c0880&gt;] ? rrw_exit+0x60/0x170 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0884692&gt;] dmu_objset_find_impl+0x112/0x430 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0942660&gt;] ? zvol_prefetch_minors_impl+0x90/0x90 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc088476e&gt;] dmu_objset_find_impl+0x1ee/0x430 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0942660&gt;] ? zvol_prefetch_minors_impl+0x90/0x90 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0942660&gt;] ? zvol_prefetch_minors_impl+0x90/0x90 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0884e58&gt;] dmu_objset_find+0x58/0x90 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0944a7b&gt;] zvol_task_cb+0x52b/0x5a0 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a902d&gt;] ? __schedule+0x39d/0x8b0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0604ed6&gt;] taskq_thread+0x246/0x470 [spl]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810c4820&gt;] ? wake_up_state+0x20/0x20</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0604c90&gt;] ? taskq_thread_spawn+0x60/0x60 [spl]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b099f&gt;] kthread+0xcf/0xe0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b4fd8&gt;] ret_from_fork+0x58/0x90</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Sun Sep 23 11:07:58 2018] INFO: task spa_async:6766 blocked <span class="keyword">for</span> more than 120 seconds.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] <span class="string">"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs"</span> disables this message.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] spa_async       D ffffffffc0ade588     0  6766      2 0x00000080</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff880fd3d3bdc0 0000000000000046 ffff881033689fa0 ffff880fd3d3bfd8</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff880fd3d3bfd8 ffff880fd3d3bfd8 ffff881033689fa0 ffffffffc0ade580</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff881033689fa0 00000000ffffffff ffffffffc0ade588</span><br><span class="line">[Sun Sep 23 11:07:58 2018] Call Trace:</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d2d00&gt;] ? spa_vdev_resilver_done+0x140/0x140 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d2f44&gt;] spa_async_thread+0x244/0x300 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff811dee33&gt;] ? kfree+0x103/0x140</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d2d00&gt;] ? spa_vdev_resilver_done+0x140/0x140 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0603fa1&gt;] thread_generic_wrapper+0x71/0x80 [spl]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0603f30&gt;] ? __thread_exit+0x20/0x20 [spl]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b099f&gt;] kthread+0xcf/0xe0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b4fd8&gt;] ret_from_fork+0x58/0x90</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Sun Sep 23 11:07:58 2018] INFO: task z_zvol:6806 blocked <span class="keyword">for</span> more than 120 seconds.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] <span class="string">"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs"</span> disables this message.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] z_zvol          D ffffffffc0ade588     0  6806      2 0x00000080</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff8810104cb9a0 0000000000000046 ffff881010b0af70 ffff8810104cbfd8</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff8810104cbfd8 ffff8810104cbfd8 ffff881010b0af70 ffffffffc0ade580</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff881010b0af70 00000000ffffffff ffffffffc0ade588</span><br><span class="line">[Sun Sep 23 11:07:58 2018] Call Trace:</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cee41&gt;] spa_open_common+0x61/0x4d0 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08761d6&gt;] ? dbuf_rele+0x36/0x40 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08cf2d3&gt;] spa_open+0x13/0x20 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08ad4f3&gt;] dsl_pool_hold+0x33/0x80 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0885935&gt;] dmu_objset_hold+0x35/0xd0 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08af0d4&gt;] dsl_prop_get+0x44/0xa0 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08af14e&gt;] dsl_prop_get_integer+0x1e/0x20 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc094269b&gt;] zvol_create_minors_cb+0x3b/0x140 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08c0880&gt;] ? rrw_exit+0x60/0x170 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0884692&gt;] dmu_objset_find_impl+0x112/0x430 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0942660&gt;] ? zvol_prefetch_minors_impl+0x90/0x90 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc088476e&gt;] dmu_objset_find_impl+0x1ee/0x430 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0942660&gt;] ? zvol_prefetch_minors_impl+0x90/0x90 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0942660&gt;] ? zvol_prefetch_minors_impl+0x90/0x90 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0884e58&gt;] dmu_objset_find+0x58/0x90 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0944a7b&gt;] zvol_task_cb+0x52b/0x5a0 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a902d&gt;] ? __schedule+0x39d/0x8b0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0604ed6&gt;] taskq_thread+0x246/0x470 [spl]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810c4820&gt;] ? wake_up_state+0x20/0x20</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0604c90&gt;] ? taskq_thread_spawn+0x60/0x60 [spl]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b099f&gt;] kthread+0xcf/0xe0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b4fd8&gt;] ret_from_fork+0x58/0x90</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Sun Sep 23 11:07:58 2018] INFO: task spa_async:7267 blocked <span class="keyword">for</span> more than 120 seconds.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] <span class="string">"echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs"</span> disables this message.</span><br><span class="line">[Sun Sep 23 11:07:58 2018] spa_async       D ffffffffc0ade588     0  7267      2 0x00000080</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff88107d987dc0 0000000000000046 ffff8810113fcf10 ffff88107d987fd8</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffff88107d987fd8 ffff88107d987fd8 ffff8810113fcf10 ffffffffc0ade580</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  ffffffffc0ade584 ffff8810113fcf10 00000000ffffffff ffffffffc0ade588</span><br><span class="line">[Sun Sep 23 11:07:58 2018] Call Trace:</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816aa489&gt;] schedule_preempt_disabled+0x29/0x70</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a83b7&gt;] __mutex_lock_slowpath+0xc7/0x1d0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d2d00&gt;] ? spa_vdev_resilver_done+0x140/0x140 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816a77cf&gt;] mutex_lock+0x1f/0x2f</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d2f44&gt;] spa_async_thread+0x244/0x300 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff811dee33&gt;] ? kfree+0x103/0x140</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc08d2d00&gt;] ? spa_vdev_resilver_done+0x140/0x140 [zfs]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0603fa1&gt;] thread_generic_wrapper+0x71/0x80 [spl]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffffc0603f30&gt;] ? __thread_exit+0x20/0x20 [spl]</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b099f&gt;] kthread+0xcf/0xe0</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff816b4fd8&gt;] ret_from_fork+0x58/0x90</span><br><span class="line">[Sun Sep 23 11:07:58 2018]  [&lt;ffffffff810b08d0&gt;] ? insert_kthread_work+0x40/0x40</span><br></pre></td></tr></table></figure>


<h3 id="OpenZFS-multihost-writes-failed-about-Invalid-DWORD-count"><a href="#OpenZFS-multihost-writes-failed-about-Invalid-DWORD-count" class="headerlink" title="OpenZFS multihost writes failed (about Invalid DWORD count)"></a>OpenZFS multihost writes failed (about Invalid DWORD count)</h3><pre><code>Invalid DWORD count = 124
Loss of DWORD synchronization = 31</code></pre><p><a href="//www.c0t0d0s0.org/archives/7601-Check-both-sides-or-Errors-on-the-SAN.html" target="_blank" rel="noopener">The interesting part is the highlighted one. A massive increase in invalid tx word count. When you see an massively increased counter here, your HBA just received rubbish from the storage. I never saw a different reason for this than a problem between the interface to the optics on the HBA and the interface to the optics on the switch ranging from not properly seated transceivers to blatant cases of ignoring the minimum bending radius of the fibre optic cables.</a></p>
<p>Suggestions to the customer based on the rule “check cheapest solution first”:<br>reseat cables<br>reseat transceivers<br>use a new cable<br>use new transceivers</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">status: The pool is suspended because multihost writes failed or were delayed;</span><br><span class="line">	another system could import the pool undetected.</span><br><span class="line">action: Make sure the pool<span class="string">'s devices are connected, then reboot your system and</span></span><br><span class="line"><span class="string">	import the pool.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: attempting task abort! scmd(ffff9285b2736a00)</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#10 CDB: Read(16) 88 00 00 00 00 02 45 fb ce 48 00 00 00 81 00 00</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] scsi target13:0:10: _scsih_tm_display_info: handle(0x0015), sas_address(0x5000cca251b4462e), phy(37)</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosurelogical id(0x500304800928dc3f), slot(10) </span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosure level(0x0000), connector name(     )</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: task abort: SUCCESS scmd(ffff9285b2736a00)</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#10 FAILED Result: hostbyte=DID_TIME_OUT driverbyte=DRIVER_OK</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#10 CDB: Read(16) 88 00 00 00 00 02 45 fb ce 48 00 00 00 81 00 00</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] blk_update_request: I/O error, dev sdff, sector 9764064840</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: attempting task abort! scmd(ffff9285af232f40)</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#6 CDB: Read(16) 88 00 00 00 00 02 45 fb cd 2f 00 00 00 ed 00 00</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] scsi target13:0:10: _scsih_tm_display_info: handle(0x0015), sas_address(0x5000cca251b4462e), phy(37)</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosurelogical id(0x500304800928dc3f), slot(10) </span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosure level(0x0000), connector name(     )</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: task abort: SUCCESS scmd(ffff9285af232f40)</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#6 FAILED Result: hostbyte=DID_TIME_OUT driverbyte=DRIVER_OK</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#6 CDB: Read(16) 88 00 00 00 00 02 45 fb cd 2f 00 00 00 ed 00 00</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] blk_update_request: I/O error, dev sdff, sector 9764064559</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: attempting task abort! scmd(ffff926d3ab36d80)</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#5 CDB: Read(16) 88 00 00 00 00 02 45 fb cc 41 00 00 00 d8 00 00</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] scsi target13:0:10: _scsih_tm_display_info: handle(0x0015), sas_address(0x5000cca251b4462e), phy(37)</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosurelogical id(0x500304800928dc3f), slot(10) </span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosure level(0x0000), connector name(     )</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: task abort: SUCCESS scmd(ffff926d3ab36d80)</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#5 FAILED Result: hostbyte=DID_TIME_OUT driverbyte=DRIVER_OK</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#5 CDB: Read(16) 88 00 00 00 00 02 45 fb cc 41 00 00 00 d8 00 00</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] blk_update_request: I/O error, dev sdff, sector 9764064321</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: attempting task abort! scmd(ffff9267c58cea00)</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#4 CDB: Read(16) 88 00 00 00 00 02 45 fb cb 69 00 00 00 97 00 00</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] scsi target13:0:10: _scsih_tm_display_info: handle(0x0015), sas_address(0x5000cca251b4462e), phy(37)</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosurelogical id(0x500304800928dc3f), slot(10) </span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] scsi target13:0:10: enclosure level(0x0000), connector name(     )</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: task abort: SUCCESS scmd(ffff9267c58cea00)</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#4 FAILED Result: hostbyte=DID_TIME_OUT driverbyte=DRIVER_OK</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] sd 13:0:10:0: [sdff] tag#4 CDB: Read(16) 88 00 00 00 00 02 45 fb cb 69 00 00 00 97 00 00</span></span><br><span class="line"><span class="string">[Tue May 14 15:12:58 2019] blk_update_request: I/O error, dev sdff, sector 9764064105</span></span><br><span class="line"><span class="string">[Tue May 14 15:14:14 2019] WARNING: MMP writes to pool '</span>ost_64<span class="string">' have not succeeded in over 20s; suspending pool</span></span><br><span class="line"><span class="string">[Tue May 14 15:14:14 2019] WARNING: Pool '</span>ost_64<span class="string">' has encountered an uncorrectable I/O failure and has been suspended.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sdff smart info:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Error counter log:</span></span><br><span class="line"><span class="string">           Errors Corrected by           Total   Correction     Gigabytes    Total</span></span><br><span class="line"><span class="string">               ECC          rereads/    errors   algorithm      processed    uncorrected</span></span><br><span class="line"><span class="string">           fast | delayed   rewrites  corrected  invocations   [10^9 bytes]  errors</span></span><br><span class="line"><span class="string">read:          0   493902         0    493902   12129373      97757.816           0</span></span><br><span class="line"><span class="string">write:         0        1         0         1     654716      29124.879           0</span></span><br><span class="line"><span class="string">verify:        0        0         0         0    7052436          0.000           0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Non-medium error count:        0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">No self-tests have been logged</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Background scan results log</span></span><br><span class="line"><span class="string">  Status: scan is active</span></span><br><span class="line"><span class="string">    Accumulated power on time, hours:minutes 17258:47 [1035527 minutes]</span></span><br><span class="line"><span class="string">    Number of background scans performed: 63,  scan progress: 64.66%</span></span><br><span class="line"><span class="string">    Number of background medium scans performed: 63</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Protocol Specific port log page for SAS SSP</span></span><br><span class="line"><span class="string">relative target port id = 1</span></span><br><span class="line"><span class="string">  generation code = 49</span></span><br><span class="line"><span class="string">  number of phys = 1</span></span><br><span class="line"><span class="string">  phy identifier = 0</span></span><br><span class="line"><span class="string">    attached device type: expander device</span></span><br><span class="line"><span class="string">    attached reason: hard reset</span></span><br><span class="line"><span class="string">    reason: unknown</span></span><br><span class="line"><span class="string">    negotiated logical link rate: reserved [11]</span></span><br><span class="line"><span class="string">    attached initiator port: ssp=0 stp=0 smp=0</span></span><br><span class="line"><span class="string">    attached target port: ssp=0 stp=0 smp=1</span></span><br><span class="line"><span class="string">    SAS address = 0x5000cca251b4462d</span></span><br><span class="line"><span class="string">    attached SAS address = 0x500304800928dc3f</span></span><br><span class="line"><span class="string">    attached phy identifier = 37</span></span><br><span class="line"><span class="string">    Invalid DWORD count = 56</span></span><br><span class="line"><span class="string">    Running disparity error count = 0</span></span><br><span class="line"><span class="string">    Loss of DWORD synchronization = 14</span></span><br><span class="line"><span class="string">    Phy reset problem = 0</span></span><br><span class="line"><span class="string">    Phy event descriptors:</span></span><br><span class="line"><span class="string">     Invalid word count: 56</span></span><br><span class="line"><span class="string">     Running disparity error count: 0</span></span><br><span class="line"><span class="string">     Loss of dword synchronization count: 14</span></span><br><span class="line"><span class="string">     Phy reset problem count: 0</span></span><br><span class="line"><span class="string">relative target port id = 2</span></span><br><span class="line"><span class="string">  generation code = 49</span></span><br><span class="line"><span class="string">  number of phys = 1</span></span><br><span class="line"><span class="string">  phy identifier = 1</span></span><br><span class="line"><span class="string">    attached device type: expander device</span></span><br><span class="line"><span class="string">    attached reason: hard reset</span></span><br><span class="line"><span class="string">    reason: unknown</span></span><br><span class="line"><span class="string">    negotiated logical link rate: reserved [11]</span></span><br><span class="line"><span class="string">    attached initiator port: ssp=0 stp=0 smp=0</span></span><br><span class="line"><span class="string">    attached target port: ssp=0 stp=0 smp=1</span></span><br><span class="line"><span class="string">    SAS address = 0x5000cca251b4462e</span></span><br><span class="line"><span class="string">    attached SAS address = 0x500304800928dd3f</span></span><br><span class="line"><span class="string">    attached phy identifier = 37</span></span><br><span class="line"><span class="string">    Invalid DWORD count = 124</span></span><br><span class="line"><span class="string">    Running disparity error count = 0</span></span><br><span class="line"><span class="string">    Loss of DWORD synchronization = 31</span></span><br><span class="line"><span class="string">    Phy reset problem = 0</span></span><br><span class="line"><span class="string">    Phy event descriptors:</span></span><br><span class="line"><span class="string">     Invalid word count: 124</span></span><br><span class="line"><span class="string">     Running disparity error count: 0</span></span><br><span class="line"><span class="string">     Loss of dword synchronization count: 31</span></span><br><span class="line"><span class="string">     Phy reset problem count: 0</span></span><br></pre></td></tr></table></figure>


<h3 id="For-Low-memroy-server"><a href="#For-Low-memroy-server" class="headerlink" title="For Low memroy server"></a>For Low memroy server</h3><p>I attacht 168 HDDs with 32GB memroy server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">kernel: mpt2sas1: iomem(0x0000000091c40000), mapped(0xffffc90003760000), size(65536)</span><br><span class="line">kernel: mpt2sas1: ioport(0x0000000000002000), size(256)</span><br><span class="line">kernel: mpt2sas1: Allocated physical memory: size(17329 kB)</span><br><span class="line">kernel: mpt2sas1: Current Controller Queue Depth(9979), Max Controller Queue Depth(10240)</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">kernel: Out of memory: Kill process 7795 (collectl) score 0 or sacrifice child</span><br><span class="line">kernel: Killed process 7795 (collectl) total-vm:177612kB, anon-rss:21400kB, file-rss:0kB, shmem-rss:0kB</span><br><span class="line">kernel: collectl: page allocation failure: order:0, mode:0x2015a</span><br><span class="line">...</span><br><span class="line">kernel: Out of memory: Kill process 4013 (tuned) score 0 or sacrifice child</span><br><span class="line">kernel: Killed process 4013 (tuned) total-vm:573848kB, anon-rss:13472kB, file-rss:0kB, shmem-rss:0kB</span><br><span class="line">systemd: tuned.service: main process exited, code=killed, status=9/KILL</span><br><span class="line">systemd: Unit tuned.service entered failed state</span><br><span class="line"></span><br><span class="line">CONFIG_SCSI_MPT2SAS_MAX_SGE: This option allows you to specify the</span><br><span class="line"> maximum number of scatter-gather entries per I/O. The driver default</span><br><span class="line"> is 128, <span class="built_in">which</span> matches MAX_HW_SEGMENTS. However, it may decreased</span><br><span class="line"> down to 16. Decreasing this parameter will reduce memory requirements</span><br><span class="line"> on a per controller instance.</span><br><span class="line"></span><br><span class="line">$ cat /etc/modprobe.d/mpt2sas.conf</span><br><span class="line">options mpt2sas max_msix_vectors=4</span><br><span class="line">options mpt2sas command_retry_count=32 <span class="comment">#if you have long timeout and much more retry count will cause the issue HDD retry many times</span></span><br><span class="line"></span><br><span class="line">options mpt2sas max_sgl_entries=32 <span class="comment">#for low memory system</span></span><br><span class="line">options mpt2sas max_queue_depth=300</span><br><span class="line"></span><br><span class="line">options mpt3sas max_queue_depth=512 <span class="comment">#</span></span><br><span class="line">options mpt3sas max_sgl_entries=256 <span class="comment"># enough memroy</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 5000 &gt; /sys/module/zfs/parameters/zfs_multihost_interval</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /sys/class/block/*/device/timeout; <span class="keyword">do</span> <span class="built_in">echo</span> 90 &gt; <span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /sys/block/*/device/queue_depth; <span class="keyword">do</span> <span class="built_in">echo</span> 254 &gt; <span class="variable">$i</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="zpool-could-not-be-import-because-single-HDD-failure-in-raidz3"><a href="#zpool-could-not-be-import-because-single-HDD-failure-in-raidz3" class="headerlink" title="zpool could not be import because single HDD failure in raidz3"></a>zpool could not be import because single HDD failure in raidz3</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">zpool import -f -o  cachefile&#x3D;none -o readonly&#x3D;on ost_61</span><br><span class="line">cannot import &#39;ost_61&#39;: I&#x2F;O error Destroy and re-create the pool from a backup source.</span><br><span class="line"></span><br><span class="line">------------------------oh shit--------------------</span><br><span class="line"></span><br><span class="line">zpool import show </span><br><span class="line"></span><br><span class="line">     pool: ost_61</span><br><span class="line">     id: 15498746923132605816</span><br><span class="line">  state: FAULTED</span><br><span class="line"> status: The pool metadata is corrupted.</span><br><span class="line"> action: The pool cannot be imported due to damaged devices or data.</span><br><span class="line">        The pool may be active on another system, but can be imported using</span><br><span class="line">        the &#39;-f&#39; flag.</span><br><span class="line">   see: http:&#x2F;&#x2F;zfsonlinux.org&#x2F;msg&#x2F;ZFS-8000-72</span><br><span class="line"> config:        ost_61                      FAULTED  corrupted data</span><br><span class="line">          raidz3-0                  ONLINE</span><br><span class="line">            sddd                    ONLINE</span><br><span class="line">            sdde                    ONLINE</span><br><span class="line">            sddf                    ONLINE</span><br><span class="line">            sddg                    ONLINE</span><br><span class="line">            sddh                    ONLINE</span><br><span class="line">            sddi                    ONLINE</span><br><span class="line">            scsi-35000c500a66c86f7  ONLINE</span><br><span class="line">            scsi-35000c500a675b907  ONLINE</span><br><span class="line">            scsi-35000c500a665afe7  ONLINE</span><br><span class="line">            scsi-35000c500a670c7a3  ONLINE</span><br><span class="line">            scsi-35000c500a66d665f  ONLINE</span><br><span class="line">            scsi-35000c500a65a86b7  ONLINE</span><br><span class="line">            scsi-35000c500a664a617  ONLINE</span><br><span class="line">            scsi-35000c500a665b353  ONLINE</span><br><span class="line">            scsi-35000c500a670c9fb  ONLINE</span><br><span class="line">            scsi-35000c500a670b10f  ONLINE</span><br><span class="line">            scsi-35000c500a65a9027  ONLINE</span><br><span class="line">            scsi-35000c500a65a02af  ONLINE</span><br><span class="line">            scsi-35000c500a670b213  ONLINE</span><br><span class="line">            scsi-35000c500a670b157  ONLINE</span><br><span class="line">            scsi-35000c500a665b1b3  ONLINE</span><br><span class="line">            scsi-35000c500a670c5fb  ONLINE</span><br><span class="line"></span><br><span class="line">$ zpool import -f -o  cachefile&#x3D;none -F -n ost_61</span><br><span class="line">$ echo $?</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">$ zdb -e ost_61 </span><br><span class="line">Configuration for import:</span><br><span class="line">        vdev_children: 1</span><br><span class="line">        version: 5000</span><br><span class="line">        pool_guid: 15498746923132605816</span><br><span class="line">        name: &#39;ost_61&#39;</span><br><span class="line">        state: 0</span><br><span class="line">        hostid: 3219179115</span><br><span class="line">        hostname: &#39;cngb-oss-c25-4.cngb.sz.hpc&#39;</span><br><span class="line">        vdev_tree:</span><br><span class="line">            type: &#39;root&#39;</span><br><span class="line">            id: 0</span><br><span class="line">            guid: 15498746923132605816</span><br><span class="line">            children[0]:</span><br><span class="line">                type: &#39;raidz&#39;</span><br><span class="line">                id: 0</span><br><span class="line">                guid: 18120440563767675975</span><br><span class="line">                nparity: 3</span><br><span class="line">                metaslab_array: 65</span><br><span class="line">                metaslab_shift: 40</span><br><span class="line">                ashift: 9</span><br><span class="line">                asize: 215529714352128</span><br><span class="line">                is_log: 0</span><br><span class="line">                create_txg: 4</span><br><span class="line">                children[0]:</span><br><span class="line">                    type: &#39;disk&#39;</span><br><span class="line">                    id: 0</span><br><span class="line">                    guid: 691489041564037318</span><br><span class="line">                    whole_disk: 1</span><br><span class="line">                    DTL: 277</span><br><span class="line">                    create_txg: 4</span><br><span class="line">                    path: &#39;&#x2F;dev&#x2F;sddd1&#39;</span><br><span class="line">                    devid: &#39;scsi-35000c500a670b7bf-part1&#39;</span><br><span class="line">                    phys_path: &#39;pci-0000:b3:00.0-sas-0x5000c500a670b7bd-lun-0&#39;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"> children[20]:</span><br><span class="line">                    type: &#39;disk&#39;</span><br><span class="line">                    id: 20</span><br><span class="line">                    guid: 3278057294213455851</span><br><span class="line">                    whole_disk: 1</span><br><span class="line">                    DTL: 257</span><br><span class="line">                    create_txg: 4</span><br><span class="line">                    path: &#39;&#x2F;dev&#x2F;disk&#x2F;by-id&#x2F;scsi-35000c500a665b1b3-part1&#39;</span><br><span class="line">                    devid: &#39;scsi-35000c500a665b1b3-part1&#39;</span><br><span class="line">                    phys_path: &#39;pci-0000:b3:00.0-sas-0x5000c500a665b1b1-lun-0&#39;</span><br><span class="line">                children[21]:</span><br><span class="line">                    type: &#39;disk&#39;</span><br><span class="line">                    id: 21</span><br><span class="line">                    guid: 10749955888611927037</span><br><span class="line">                    whole_disk: 1</span><br><span class="line">                    DTL: 256</span><br><span class="line">                    create_txg: 4</span><br><span class="line">                    path: &#39;&#x2F;dev&#x2F;disk&#x2F;by-id&#x2F;scsi-35000c500a670c5fb-part1&#39;</span><br><span class="line">                    devid: &#39;scsi-35000c500a670c5fb-part1&#39;</span><br><span class="line">                    phys_path: &#39;pci-0000:b3:00.0-sas-0x5000c500a670c5f9-lun-0&#39;</span><br><span class="line">        rewind-policy:</span><br><span class="line">            rewind-request-txg: 18446744073709551615</span><br><span class="line">            rewind-request: 2</span><br><span class="line">zdb: can&#39;t open &#39;ost_61&#39;: Input&#x2F;output error</span><br></pre></td></tr></table></figure>


<h4 id="I-guess-there-are-4-x-HDDs-could-read-zfs-metadata-in-this-zpool"><a href="#I-guess-there-are-4-x-HDDs-could-read-zfs-metadata-in-this-zpool" class="headerlink" title="I guess there are 4 x HDDs could read zfs metadata in this zpool"></a>I guess there are 4 x HDDs could read zfs metadata in this zpool</h4><p>Try it one by one</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">$ zdb -e ost_61 -d scsi-35000c500a665afe7</span><br><span class="line">Dataset mos [META], ID 0, cr_txg 4, 509M, 284 objects</span><br><span class="line"></span><br><span class="line">    Object  lvl   iblk   dblk  dsize  dnsize  lsize   %full  type</span><br><span class="line">         0    2   128K    16K   736K     512   592K   23.99  DMU dnode</span><br><span class="line"></span><br><span class="line">$ zdb -e ost_61 -d sddi</span><br><span class="line">zdb: can&#39;t open &#39;ost_61&#39;: Input&#x2F;output error </span><br><span class="line"></span><br><span class="line">$ zdb -e ost_61 -d -t 1274825</span><br><span class="line">Dataset mos [META], ID 0, cr_txg 4, 492M, 284 objects</span><br><span class="line">Dataset ost_61&#x2F;ost_61 [ZPL], ID 155, cr_txg 1744, 59.3T, 662232 objects</span><br><span class="line">Dataset ost_61 [ZPL], ID 51, cr_txg 1, 68.1K, 6 objects</span><br><span class="line">Verified large_blocks feature refcount of 1 is correct</span><br><span class="line">Verified large_dnode feature refcount of 0 is correct</span><br><span class="line">Verified sha512 feature refcount of 0 is correct</span><br><span class="line">Verified skein feature refcount of 0 is correct</span><br><span class="line">Verified edonr feature refcount of 0 is correct</span><br><span class="line">Verified userobj_accounting feature refcount of 2 is correct</span><br><span class="line">----sddh--finish-----</span><br><span class="line">----sddi-----</span><br><span class="line">zdb -e ost_61 -d -t 1414018</span><br><span class="line">zdb: can&#39;t open &#39;ost_61&#39;: Input&#x2F;output error</span><br><span class="line">zdb -e ost_61 -d -t 1414019</span><br><span class="line">zdb: can&#39;t open &#39;ost_61&#39;: Input&#x2F;output error</span><br><span class="line">zdb -e ost_61 -d -t 1414020</span><br><span class="line">zdb: can&#39;t open &#39;ost_61&#39;: Input&#x2F;output error</span><br><span class="line">zdb -e ost_61 -d -t 1414021</span><br><span class="line">zdb: can&#39;t open &#39;ost_61&#39;: Input&#x2F;output error</span><br><span class="line">zdb -e ost_61 -d -t 1414022</span><br><span class="line">zdb: can&#39;t open &#39;ost_61&#39;: Input&#x2F;output error</span><br><span class="line">zdb -e ost_61 -d -t 1414023</span><br><span class="line">zdb: can&#39;t open &#39;ost_61&#39;: Input&#x2F;output error</span><br><span class="line">zdb -e ost_61 -d -t 1414025</span><br><span class="line">zdb: can&#39;t open &#39;ost_61&#39;: Input&#x2F;output error</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">zdb -e ost_61 -d -t 1274813</span><br><span class="line">Dataset mos [META], ID 0, cr_txg 4, 492M, 284 objects</span><br><span class="line">Dataset ost_61&#x2F;ost_61 [ZPL], ID 155, cr_txg 1744, 59.3T, 662232 objects</span><br><span class="line">Dataset ost_61 [ZPL], ID 51, cr_txg 1, 68.1K, 6 objects</span><br><span class="line">Verified large_blocks feature refcount of 1 is correct</span><br><span class="line">Verified large_dnode feature refcount of 0 is correct</span><br><span class="line">Verified sha512 feature refcount of 0 is correct</span><br><span class="line">Verified skein feature refcount of 0 is correct</span><br><span class="line">Verified edonr feature refcount of 0 is correct</span><br><span class="line">Verified userobj_accounting feature refcount of 2 is correct</span><br><span class="line">zdb -e ost_61 -d -t 1274814</span><br><span class="line">Dataset mos [META], ID 0, cr_txg 4, 492M, 284 objects</span><br><span class="line">Dataset ost_61&#x2F;ost_61 [ZPL], ID 155, cr_txg 1744, 59.3T, 662232 objects</span><br><span class="line">Dataset ost_61 [ZPL], ID 51, cr_txg 1, 68.1K, 6 objects</span><br><span class="line">Verified large_blocks feature refcount of 1 is correct</span><br><span class="line">Verified large_dnode feature refcount of 0 is correct</span><br><span class="line">Verified sha512 feature refcount of 0 is correct</span><br><span class="line">Verified skein feature refcount of 0 is correct</span><br><span class="line">Verified edonr feature refcount of 0 is correct</span><br><span class="line">Verified userobj_accounting feature refcount of 2 is correct</span><br><span class="line">zdb -e ost_61 -d -t 1414007</span><br><span class="line">zdb: can&#39;t open &#39;ost_61&#39;: Input&#x2F;output error</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">----sddi--finish-----</span><br><span class="line">----scsi-35000c500a66c86f7-----</span><br><span class="line">zdb -e ost_61 -d -t 1274826</span><br><span class="line">Dataset mos [META], ID 0, cr_txg 4, 492M, 284 objects</span><br><span class="line">Dataset ost_61&#x2F;ost_61 [ZPL], ID 155, cr_txg 1744, 59.3T, 662232 objects</span><br><span class="line">Dataset ost_61 [ZPL], ID 51, cr_txg 1, 68.1K, 6 objects</span><br><span class="line">Verified large_blocks feature refcount of 1 is correct</span><br><span class="line">Verified large_dnode feature refcount of 0 is correct</span><br><span class="line">Verified sha512 feature refcount of 0 is correct</span><br><span class="line">Verified skein feature refcount of 0 is correct</span><br><span class="line">Verified edonr feature refcount of 0 is correct</span><br><span class="line">Verified userobj_accounting feature refcount of 2 is correct</span><br><span class="line">zdb -e ost_61 -d -t 1274827</span><br><span class="line">Dataset mos [META], ID 0, cr_txg 4, 492M, 284 objects</span><br><span class="line">Dataset ost_61&#x2F;ost_61 [ZPL], ID 155, cr_txg 1744, 59.3T, 662232 objects</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">Dataset mos [META], ID 0, cr_txg 4, 492M, 284 objects</span><br><span class="line">Dataset ost_61&#x2F;ost_61 [ZPL], ID 155, cr_txg 1744, 59.3T, 662232 objects</span><br><span class="line">Dataset ost_61 [ZPL], ID 51, cr_txg 1, 68.1K, 6 objects</span><br><span class="line">Verified large_blocks feature refcount of 1 is correct</span><br><span class="line">Verified large_dnode feature refcount of 0 is correct</span><br><span class="line">Verified sha512 feature refcount of 0 is correct</span><br><span class="line">Verified skein feature refcount of 0 is correct</span><br><span class="line">Verified edonr feature refcount of 0 is correct</span><br><span class="line">Verified userobj_accounting feature refcount of 2 is correct</span><br></pre></td></tr></table></figure>
<p>Only sddi show input/output error</p>
<h4 id="Ban-the-sddi"><a href="#Ban-the-sddi" class="headerlink" title="Ban the sddi"></a>Ban the sddi</h4><p>This is the <a href="https://github.com/zfsonlinux/zfs/issues/7184" target="_blank" rel="noopener">zfs bug</a>, the easy way is use zdb -lu /dev/sd(all zpool devices), you could compare txg number, single device has the wrong txg number with the others. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@cngb-oss-c25-3.cngb.sz.hpc &#x2F;tmp&#x2F;zdb]# diff sdcu sdcv # it &#39;s ok</span><br><span class="line">[root@cngb-oss-c25-3.cngb.sz.hpc &#x2F;tmp&#x2F;zdb]# diff sdcu sddi # found the wrong device</span><br><span class="line">25,37c25,37</span><br><span class="line">&lt; 	txg &#x3D; 2674112</span><br><span class="line">&lt; 	txg &#x3D; 2673986</span><br><span class="line">&lt; 	txg &#x3D; 2674114</span><br><span class="line">&lt; 	txg &#x3D; 2674115</span><br><span class="line">&lt; 	txg &#x3D; 2674116</span><br><span class="line">&lt; 	txg &#x3D; 2674117</span><br><span class="line">&lt; 	txg &#x3D; 2674118</span><br><span class="line">&lt; 	txg &#x3D; 2674119</span><br><span class="line">&lt; 	txg &#x3D; 2674120</span><br><span class="line">&lt; 	txg &#x3D; 2674121</span><br><span class="line">&lt; 	txg &#x3D; 2674122</span><br><span class="line">&lt; 	txg &#x3D; 2674123</span><br><span class="line">&lt; 	txg &#x3D; 2674124</span><br><span class="line">---</span><br><span class="line">&gt; 	txg &#x3D; 7727315</span><br><span class="line">&gt; 	txg &#x3D; 7727443</span><br><span class="line">&gt; 	txg &#x3D; 7727317</span><br><span class="line">&gt; 	txg &#x3D; 7727318</span><br><span class="line">&gt; 	txg &#x3D; 7727319</span><br><span class="line">&gt; 	txg &#x3D; 7727320</span><br><span class="line">&gt; 	txg &#x3D; 7727321</span><br><span class="line">&gt; 	txg &#x3D; 7727322</span><br><span class="line">&gt; 	txg &#x3D; 7727323</span><br><span class="line">&gt; 	txg &#x3D; 7727324</span><br><span class="line">&gt; 	txg &#x3D; 7727325</span><br><span class="line">&gt; 	txg &#x3D; 7727453</span><br><span class="line"></span><br><span class="line">echo 1 &gt; &#x2F;sys&#x2F;class&#x2F;block&#x2F;sddi&#x2F;device&#x2F;delete</span><br></pre></td></tr></table></figure>
<p>After ban the sddi, the zpool could be imported……wipe the sweat, wipe the sweat……<br>The issue because this device (sddi) has been in two diff zpool(server A and server B) at the same time</p>
<h3 id="Single-HDD-hang-cause-LSI-HBA-reset-self"><a href="#Single-HDD-hang-cause-LSI-HBA-reset-self" class="headerlink" title="Single HDD hang cause LSI HBA reset self"></a>Single HDD hang cause LSI HBA reset self</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br></pre></td><td class="code"><pre><span class="line">Mar 13 17:47:16 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">Mar 13 17:47:16 your_hostname kernel: mf:<span class="comment">#012#011000000a3 00000000 00000000 00000000 00000000 00000018 00000000 0000012c #012#01100000000 00000006 00000000 00000000 00000000 00000000 00000000 02000000 #012#01100000012 0000002c 00000000 00000000 00000000 00000000 00000000 00000000</span></span><br><span class="line">Mar 13 17:47:16 your_hostname kernel: mpt3sas_cm0: issue target reset: handle = (0x00a3)</span><br><span class="line">Mar 13 17:47:44 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">Mar 13 17:47:44 your_hostname kernel: mf:<span class="comment">#012#011000000a3 00000000 00000000 00000000 00000000 00000018 00000000 0000012c #012#01100000000 00000006 00000000 00000000 00000000 00000000 00000000 02000000 #012#01100000012 0000002c 00000000 00000000 00000000 00000000 00000000 00000000</span></span><br><span class="line">Mar 13 17:47:44 your_hostname kernel: mpt3sas_cm0: issue target reset: handle = (0x00a3)</span><br><span class="line">Mar 13 17:47:52 your_hostname kernel: sd 17:0:144:0: attempting task abort! scmd(ffff9f4c57e31340)</span><br><span class="line">Mar 13 17:47:52 your_hostname kernel: sd 17:0:144:0: [sg145] tag<span class="comment">#13 CDB: Test Unit Ready 00 00 00 00 00 00</span></span><br><span class="line">Mar 13 17:47:52 your_hostname kernel: scsi target17:0:144: _scsih_tm_display_info: handle(0x00a3), sas_address(0x5000c500a6753d51), phy(20)</span><br><span class="line">Mar 13 17:47:52 your_hostname kernel: scsi target17:0:144: enclosurelogical id(0x50050cc11ac01694), slot(1)</span><br><span class="line">Mar 13 17:47:52 your_hostname kernel: scsi target17:0:144: enclosure level(0x0000), connector name( 1   )</span><br><span class="line">Mar 13 17:47:52 your_hostname kernel: sd 17:0:144:0: task abort: SUCCESS scmd(ffff9f4c57e31340)</span><br><span class="line">Mar 13 17:47:58 your_hostname kernel: sd 17:0:144:0: attempting task abort! scmd(ffff9f4e947adb00)</span><br><span class="line">Mar 13 17:47:58 your_hostname kernel: sd 17:0:144:0: [sg145] tag<span class="comment">#172 CDB: Log Sense 4d 00 6f 00 00 00 00 10 00 00</span></span><br><span class="line">Mar 13 17:47:58 your_hostname kernel: scsi target17:0:144: _scsih_tm_display_info: handle(0x00a3), sas_address(0x5000c500a6753d51), phy(20)</span><br><span class="line">Mar 13 17:47:58 your_hostname kernel: scsi target17:0:144: enclosurelogical id(0x50050cc11ac01694), slot(1)</span><br><span class="line">Mar 13 17:47:58 your_hostname kernel: scsi target17:0:144: enclosure level(0x0000), connector name( 1   )</span><br><span class="line">Mar 13 17:47:58 your_hostname kernel: sd 17:0:144:0: task abort: SUCCESS scmd(ffff9f4e947adb00)</span><br><span class="line">.......</span><br><span class="line">Mar 13 17:51:40 your_hostname kernel: sd 17:0:144:0: attempting task abort! scmd(ffff9f4e21ff0e00)</span><br><span class="line">Mar 13 17:51:40 your_hostname kernel: sd 17:0:144:0: tag<span class="comment">#0 CDB: Read capacity(16) 9e 10 00 00 00 00 00 00 00 00 00 00 00 20 00 00</span></span><br><span class="line">Mar 13 17:51:40 your_hostname kernel: scsi target17:0:144: _scsih_tm_display_info: handle(0x00a3), sas_address(0x5000c500a6753d51), phy(20)</span><br><span class="line">Mar 13 17:51:40 your_hostname kernel: scsi target17:0:144: enclosurelogical id(0x50050cc11ac01694), slot(1)</span><br><span class="line">Mar 13 17:51:40 your_hostname kernel: scsi target17:0:144: enclosure level(0x0000), connector name( 1   )</span><br><span class="line">Mar 13 17:51:40 your_hostname kernel: sd 17:0:144:0: task abort: SUCCESS scmd(ffff9f4e21ff0e00)</span><br><span class="line">Mar 13 17:52:11 your_hostname kernel: sd 17:0:144:0: attempting task abort! scmd(ffff9f480939bf00)</span><br><span class="line">Mar 13 17:52:11 your_hostname kernel: sd 17:0:144:0: tag<span class="comment">#0 CDB: Read capacity(16) 9e 10 00 00 00 00 00 00 00 00 00 00 00 20 00 00</span></span><br><span class="line">Mar 13 17:52:11 your_hostname kernel: scsi target17:0:144: _scsih_tm_display_info: handle(0x00a3), sas_address(0x5000c500a6753d51), phy(20)</span><br><span class="line">Mar 13 17:52:11 your_hostname kernel: scsi target17:0:144: enclosurelogical id(0x50050cc11ac01694), slot(1)</span><br><span class="line">Mar 13 17:52:11 your_hostname kernel: scsi target17:0:144: enclosure level(0x0000), connector name( 1   )</span><br><span class="line">Mar 13 17:52:11 your_hostname kernel: sd 17:0:144:0: task abort: SUCCESS scmd(ffff9f480939bf00)</span><br><span class="line">Mar 13 17:52:11 your_hostname kernel: sd 17:0:144:0: [sdeh] Read Capacity(16) failed: Result: hostbyte=DID_TIME_OUT driverbyte=DRIVER_OK</span><br><span class="line">Mar 13 17:52:11 your_hostname kernel: sd 17:0:144:0: [sdeh] Sense not available.</span><br><span class="line">Mar 13 17:52:42 your_hostname kernel: sd 17:0:144:0: attempting task abort! scmd(ffff9f491c216c80)</span><br><span class="line">Mar 13 17:52:42 your_hostname kernel: sd 17:0:144:0: tag<span class="comment">#0 CDB: Read Capacity(10) 25 00 00 00 00 00 00 00 00 00</span></span><br><span class="line">......</span><br><span class="line">Mar 13 19:26:20 your_hostname kernel: sd 17:0:144:0: attempting task abort! scmd(ffff9f43a0ff6580)</span><br><span class="line">Mar 13 19:26:20 your_hostname kernel: sd 17:0:144:0: [sg145] tag<span class="comment">#33 CDB: Test Unit Ready 00 00 00 00 00 00</span></span><br><span class="line">Mar 13 19:26:20 your_hostname kernel: scsi target17:0:144: _scsih_tm_display_info: handle(0x00a3), sas_address(0x5000c500a6753d51), phy(20)</span><br><span class="line">Mar 13 19:26:20 your_hostname kernel: scsi target17:0:144: enclosurelogical id(0x50050cc11ac01694), slot(1)</span><br><span class="line">Mar 13 19:26:20 your_hostname kernel: scsi target17:0:144: enclosure level(0x0000), connector name( 1   )</span><br><span class="line">Mar 13 19:26:20 your_hostname kernel: sd 17:0:144:0: task abort: SUCCESS scmd(ffff9f43a0ff6580)</span><br><span class="line">Mar 13 19:26:20 your_hostname kernel: mpt3sas_cm0: attempting host reset! scmd(ffff9f43a0ff6580)</span><br><span class="line">Mar 13 19:26:20 your_hostname kernel: sd 17:0:144:0: [sg145] tag<span class="comment">#33 CDB: Inquiry 12 01 83 00 f0 00</span></span><br><span class="line">Mar 13 19:26:20 your_hostname kernel: mpt3sas_cm0: sending diag reset !!</span><br><span class="line">Mar 13 19:26:21 your_hostname kernel: mpt3sas_cm0: diag reset: SUCCESS</span><br><span class="line">Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: IOC Number : 0</span><br><span class="line">Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: CurrentHostPageSize is 0: Setting default host page size to 4k</span><br><span class="line">Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: FW Package Version(16.17.00.03)</span><br><span class="line">Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: LSISAS3008: FWVersion(16.00.04.00), ChipRevision(0x02), BiosVersion(18.00.00.00)</span><br><span class="line">Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: Dell 12Gbps SAS HBA</span><br><span class="line">Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: Protocol=(Initiator,Target), Capabilities=(TLR,EEDP,Snapshot Buffer,Diag Trace Buffer,Task Set Full,NCQ)</span><br><span class="line">Mar 13 19:26:22 your_hostname kernel: mpt3sas_cm0: sending port <span class="built_in">enable</span> !!</span><br><span class="line">Mar 13 19:26:24 your_hostname kernel: WARNING: MMP writes to pool <span class="string">'ost_6'</span> have not succeeded <span class="keyword">in</span> over 25s; suspending pool</span><br><span class="line">Mar 13 19:26:24 your_hostname kernel: WARNING: Pool <span class="string">'ost_6'</span> has encountered an uncorrectable I/O failure and has been suspended.</span><br><span class="line"></span><br><span class="line">line number, message</span><br><span class="line">27567:Mar 13 17:47:16 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">27570:Mar 13 17:47:44 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">28676:Mar 13 17:49:36 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">29851:Mar 13 17:58:36 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31211:Mar 13 17:59:51 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31817:Mar 13 18:00:26 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31852:Mar 13 18:01:47 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31855:Mar 13 18:02:13 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31878:Mar 13 18:03:33 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31881:Mar 13 18:03:57 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31910:Mar 13 18:05:13 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31913:Mar 13 18:05:37 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31931:Mar 13 18:06:48 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31940:Mar 13 18:07:17 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31961:Mar 13 18:08:28 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31964:Mar 13 18:08:52 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">31996:Mar 13 18:10:12 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32012:Mar 13 18:10:47 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32057:Mar 13 18:12:07 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32060:Mar 13 18:12:32 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32101:Mar 13 18:13:53 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32116:Mar 13 18:14:37 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32162:Mar 13 18:15:57 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32165:Mar 13 18:16:22 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32182:Mar 13 18:17:33 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32191:Mar 13 18:18:02 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32218:Mar 13 18:19:16 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32233:Mar 13 18:19:57 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32250:Mar 13 18:20:57 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32265:Mar 13 18:21:55 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32280:Mar 13 18:22:42 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32309:Mar 13 18:23:40 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32324:Mar 13 18:24:16 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32339:Mar 13 18:25:28 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32355:Mar 13 18:26:15 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32370:Mar 13 18:27:02 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32387:Mar 13 18:27:49 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32402:Mar 13 18:28:40 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32417:Mar 13 18:29:29 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32435:Mar 13 18:30:13 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32453:Mar 13 18:31:07 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32468:Mar 13 18:32:00 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32495:Mar 13 18:33:27 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32498:Mar 13 18:34:18 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32525:Mar 13 18:35:34 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32543:Mar 13 18:36:46 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32570:Mar 13 18:38:09 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32585:Mar 13 18:38:58 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32600:Mar 13 18:39:57 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32621:Mar 13 18:41:19 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32642:Mar 13 18:42:31 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32657:Mar 13 18:43:26 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32672:Mar 13 18:44:39 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32690:Mar 13 18:45:51 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32705:Mar 13 18:46:58 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32735:Mar 13 18:48:03 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32752:Mar 13 18:48:52 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32770:Mar 13 18:50:23 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32794:Mar 13 18:51:15 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32809:Mar 13 18:52:25 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32818:Mar 13 18:53:03 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32857:Mar 13 18:55:09 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32863:Mar 13 18:55:52 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32884:Mar 13 18:57:12 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32887:Mar 13 18:58:01 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32914:Mar 13 18:59:44 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32920:Mar 13 19:00:21 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32965:Mar 13 19:01:55 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">32968:Mar 13 19:02:33 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33007:Mar 13 19:04:28 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33010:Mar 13 19:05:14 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33028:Mar 13 19:06:14 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33055:Mar 13 19:07:24 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33070:Mar 13 19:08:35 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33091:Mar 13 19:09:52 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33097:Mar 13 19:10:32 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33115:Mar 13 19:11:45 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33130:Mar 13 19:12:45 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33157:Mar 13 19:13:59 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33160:Mar 13 19:14:39 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33190:Mar 13 19:16:11 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33205:Mar 13 19:17:05 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33232:Mar 13 19:18:27 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33235:Mar 13 19:19:06 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33253:Mar 13 19:20:24 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33283:Mar 13 19:21:38 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33298:Mar 13 19:22:32 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33313:Mar 13 19:23:34 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33328:Mar 13 19:24:30 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line">33364:Mar 13 19:25:59 your_hostname kernel: mpt3sas_cm0: Command Timeout</span><br><span class="line"></span><br><span class="line">after 90 <span class="built_in">times</span> timeout, the HBA reset itself</span><br><span class="line"></span><br><span class="line">33400:Mar 13 19:26:21 your_hostname kernel: mpt3sas_cm0: diag reset: SUCCESS</span><br><span class="line"></span><br><span class="line">$ zpool status your-pool</span><br><span class="line">  pool: your-pool</span><br><span class="line"> state: ONLINE</span><br><span class="line">  scan: resilvered 510K <span class="keyword">in</span> 0h0m with 0 errors on Sat Jan 26 17:05:55 2019</span><br><span class="line">config:</span><br><span class="line"></span><br><span class="line">        NAME                        STATE     READ WRITE CKSUM</span><br><span class="line">        ost_84                      ONLINE       0     0     0</span><br><span class="line">          raidz3-0                  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a670c507  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a65b41f7  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a6753d4b  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a670ccf3  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a670b117  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a675a767  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a6754883  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500957e33f7  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a675a25b  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a670c393  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a65a9e53  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a6515413  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a663e253  ONLINE       0     0     0</span><br><span class="line">            scsi-35000cca26c1b754c  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a663b1f7  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a670c503  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a6753c5b  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a663b05b  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a670b917  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a670c1af  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a65a8e9b  ONLINE       0     0     0</span><br><span class="line">            scsi-35000c500a6756753  ONLINE       0     0     0</span><br><span class="line"></span><br><span class="line">errors: No known data errors</span><br><span class="line"></span><br><span class="line"><span class="comment">## In this raid, only sdap is HGST dev, the others are seagate</span></span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           0.00    0.00   20.99   47.76    0.00   31.25</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sdo               0.00     0.00   10.00   60.00     0.14     5.35   160.51     6.87  105.14   94.95  106.83  14.28  99.95</span><br><span class="line">sdp               0.00     0.00   10.50   41.50     0.15     3.72   152.37     7.65  154.65  151.67  155.41  19.21  99.90</span><br><span class="line">sdr               0.00     0.00   12.50   35.50     0.19     3.16   143.05     7.30  141.66   98.84  156.73  20.81  99.90</span><br><span class="line">sdq               0.00     0.00    9.50   55.00     0.14     4.98   162.49     6.82  111.70   87.21  115.93  15.49  99.90</span><br><span class="line">sdap              0.00     0.00   12.50   71.00     0.19     3.61    93.22     0.23    2.71   14.28    0.67   1.96  16.40</span><br><span class="line">sdad              0.00     0.00   13.50   52.50     0.21     4.69   151.88     6.93  113.20   69.00  124.56  15.14  99.90</span><br><span class="line">sdv               0.00     0.00   10.50   68.50     0.16     5.06   135.30     6.71   78.85  155.86   67.04  12.64  99.85</span><br><span class="line">sdak              0.00     0.00    9.50   85.50     0.19     6.53   144.90     5.53   65.13   99.84   61.27  10.36  98.40</span><br><span class="line">sdal              0.00     0.00   10.50   48.00     0.19     4.27   156.03     6.87  116.79   84.00  123.97  17.07  99.85</span><br><span class="line">sdan              0.00     0.00    9.00   39.50     0.16     3.56   156.88     6.58  125.02   57.61  140.38  20.60  99.90</span><br><span class="line">sdu               0.00     0.00   12.00   61.50     0.16     5.53   158.49     7.11  104.78   95.92  106.50  13.59  99.85</span><br><span class="line">sdaf              0.00     0.00   11.00   38.50     0.19     3.42   149.39     6.93  128.40   79.00  142.52  20.17  99.85</span><br><span class="line">sdac              0.00     0.00   11.00   62.50     0.18     4.27   123.96     5.17   67.90   97.59   62.67  13.28  97.60</span><br><span class="line">sdag              0.00     0.00   10.00   41.00     0.19     3.77   158.72     7.08  139.36  102.00  148.48  19.58  99.85</span><br><span class="line">sdao              0.00     0.00    8.50   54.00     0.14     4.90   165.24     6.91  115.50  100.65  117.84  15.97  99.80</span><br><span class="line">sdaj              0.00     0.00   11.00   66.00     0.20     5.48   151.16     6.83   92.98  115.36   89.25  12.96  99.80</span><br><span class="line">sdai              0.00     0.00   11.00   35.00     0.20     3.13   148.52     6.82  145.83   68.82  170.03  21.70  99.80</span><br><span class="line">sdt               0.00     0.00   13.50   44.00     0.18     3.90   145.22     6.78  117.48   53.89  136.99  17.36  99.80</span><br><span class="line">sdah              0.00     0.00   12.00   53.50     0.20     4.79   156.21     7.39  115.08  110.71  116.06  15.24  99.80</span><br><span class="line">sds               0.00     0.00   10.50   53.00     0.12     4.77   157.54     6.86  111.13   51.00  123.05  15.71  99.75</span><br><span class="line">sdae              0.00     0.00   11.00   42.50     0.19     3.66   147.39     6.85  133.48   73.23  149.07  18.64  99.75</span><br><span class="line">sdam              0.00     0.00    8.00   50.00     0.15     4.61   167.91     6.31  114.64   40.50  126.50  17.19  99.70</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           0.20    0.00   22.24   34.84    0.00   42.71</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sdo               0.00     0.00    0.50   86.00     0.02     6.59   156.42     5.86   67.03   20.00   67.31  11.55  99.95</span><br><span class="line">sdp               0.00     0.00    1.00   84.50     0.03     7.16   172.36     7.03   70.34   33.50   70.78  11.70 100.00</span><br><span class="line">sdr               0.00     0.00    1.00   72.50     0.03     6.08   170.44     6.22   90.38   21.00   91.34  13.61 100.00</span><br><span class="line">sdq               0.00     0.00    1.00   84.00     0.03     7.01   169.64     6.08   69.63   13.50   70.30  11.76 100.00</span><br><span class="line">sdap              0.00     0.00    0.50  129.50     0.02     6.47   102.29     0.07    0.53   13.00    0.48   0.32   4.10</span><br><span class="line">sdad              0.00     0.00    1.00   76.50     0.03     6.42   170.63     6.21   77.92  216.00   76.12  12.90 100.00</span><br><span class="line">sdv               0.00     0.00    1.00   84.00     0.03     6.79   164.50     8.07   73.64   73.00   73.65  11.76 100.00</span><br><span class="line">sdak              0.00     0.00    1.00   83.00     0.03     6.34   155.41     5.95   66.38  106.00   65.90  11.83  99.40</span><br><span class="line">sdal              0.00     0.00    1.00   67.50     0.03     5.59   167.98     6.07   92.59   76.50   92.83  14.60 100.00</span><br><span class="line">sdan              0.00     0.00    1.00   73.50     0.03     6.19   171.05     7.69   75.56   41.50   76.02  13.42  99.95</span><br><span class="line">sdu               0.00     0.00    1.00   80.00     0.03     6.40   162.69     6.04   73.44   54.00   73.69  12.35 100.00</span><br><span class="line">sdaf              0.00     0.00    1.00   78.00     0.01     6.69   173.73     6.45   77.08   94.00   76.87  12.66 100.00</span><br><span class="line">sdac              0.00     0.00    1.50   83.00     0.03     6.68   162.79     6.28   74.35  237.33   71.40  11.84 100.05</span><br><span class="line">sdag              0.00     0.00    0.50   83.50     0.01     7.11   173.65     7.13   70.86   77.00   70.82  11.90 100.00</span><br><span class="line">sdao              0.00     0.00    1.00   87.00     0.02     7.19   167.85     6.57   75.49  418.00   71.56  11.37 100.05</span><br><span class="line">sdaj              0.00     0.00    1.00   75.00     0.03     6.16   166.95     6.82   75.19   66.50   75.31  13.16 100.00</span><br><span class="line">sdai              0.00     0.00    1.00   79.00     0.03     6.74   173.41     7.01   75.91   18.00   76.64  12.51 100.05</span><br><span class="line">sdt               0.00     0.00    1.50   78.50     0.03     6.56   168.79     6.58   85.08  239.33   82.13  12.50 100.00</span><br><span class="line">sdah              0.00     0.00    0.50   79.00     0.02     6.69   172.81     7.25   76.71   37.00   76.96  12.58 100.00</span><br><span class="line">sds               0.00     0.00    1.00   81.50     0.03     6.90   172.09     8.08   74.24   80.00   74.17  12.13 100.05</span><br><span class="line">sdae              0.00     0.00    1.00   80.00     0.01     6.77   171.45     6.18   79.00  257.00   76.78  12.35 100.05</span><br><span class="line">sdam              0.00     0.00    1.00   78.50     0.03     6.64   171.82     6.02   79.11   24.50   79.81  12.58 100.05</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           1.17    0.00   20.85   37.54    0.00   40.44</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sdo               0.00     0.00    2.00   85.00     0.00     7.11   167.36     5.37   56.57   74.25   56.15  10.51  91.40</span><br><span class="line">sdp               0.00     0.00    3.00   83.50     0.00     6.95   164.62     5.70   62.18  158.50   58.72  10.81  93.50</span><br><span class="line">sdr               0.00     0.00    2.00   90.50     0.00     7.43   164.43     6.44   59.36  112.25   58.19  10.79  99.85</span><br><span class="line">sdq               0.00     0.00    1.50   91.00     0.00     7.58   167.91     6.70   65.33  330.33   60.96  10.74  99.30</span><br><span class="line">sdap              0.00     0.00    2.50  143.50     0.00     7.53   105.66     0.11    0.76    9.00    0.62   0.42   6.10</span><br><span class="line">sdad              0.00     0.00    2.50   85.00     0.00     7.00   163.93     6.48   64.74  242.60   59.51  10.70  93.60</span><br><span class="line">sdv               0.00     0.00    2.00   74.50     0.00     6.58   176.24     6.50   90.99  229.50   87.27  13.07 100.00</span><br><span class="line">sdak              0.00     0.00    2.00   90.00     0.00     8.06   179.35     6.99   59.90  163.50   57.59  10.87 100.00</span><br><span class="line">sdal              0.00     0.00    4.50   79.50     0.00     6.71   163.76     6.76   82.09  202.89   75.25  11.90 100.00</span><br><span class="line">sdan              0.00     0.00    2.50   87.50     0.00     7.24   164.77     6.21   62.68  115.80   61.17  10.43  93.90</span><br><span class="line">sdu               0.00     0.00    2.00   85.00     0.00     7.61   179.13     6.41   73.32  184.00   70.72  11.49 100.00</span><br><span class="line">sdaf              0.00     0.00    2.00   88.00     0.00     7.82   177.91     6.83   74.74  414.00   67.03  11.11 100.00</span><br><span class="line">sdac              0.00     0.00    1.50   88.50     0.00     7.14   162.38     6.69   66.64  101.33   66.06  10.69  96.25</span><br><span class="line">sdag              0.00     0.00    0.50   87.50     0.00     7.21   167.86     6.95   67.72  240.00   66.73  11.03  97.10</span><br><span class="line">sdao              0.00     0.00    2.50   90.50     0.00     7.24   159.50     5.69   60.65  119.20   59.03  10.36  96.35</span><br><span class="line">sdaj              0.00     0.00    3.00   86.50     0.00     7.37   168.70     7.64   82.65  508.17   67.90  11.17 100.00</span><br><span class="line">sdai              0.00     0.00    1.50   80.50     0.00     6.68   166.99     5.25   62.49   55.67   62.62  11.07  90.75</span><br><span class="line">sdt               0.00     0.00    2.50   88.00     0.00     7.90   178.77     6.47   70.90  183.80   67.69  11.05 100.00</span><br><span class="line">sdah              0.00     0.00    2.50   87.50     0.00     7.79   177.33     6.26   69.06   73.00   68.95  11.11 100.00</span><br><span class="line">sds               0.00     0.00    1.00   94.00     0.00     8.42   181.62     7.84   65.32   35.50   65.63  10.53 100.00</span><br><span class="line">sdae              0.00     0.00    2.00   82.00     0.00     6.92   168.83     6.91   79.28  140.25   77.79  11.90 100.00</span><br><span class="line">sdam              0.00     0.00    3.50   77.50     0.00     6.40   161.80     5.96   73.86  198.14   68.25  11.69  94.70</span><br></pre></td></tr></table></figure>
<p>In this raidz3, only sdap is HGST dev, the others are seagate HDD<br>In a pair of another server not use the HDD, the bug will cause the server HBA reset again because the single dev timeout<br>Bad HDD verdor is seagate, when the HDD use ratio up to 75%, that too terrible, the HDD firmware is TT54, when you disable read buff, seagate HDD read/write jitter is very serious, 100x ~ 400x bad than WD(HGST), I guess it nothing to do with firmware, I don ‘t think TT55 could resolve it.<br>When you reset JBOD encolsure, Out of a week, the issue will show again.</p>
<p>$ sdparm -s RCE=0 /dev/sdxx could reduce the seagate latency</p>
<p>In client, read are very slow</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[&lt;ffffffff811315c0&gt;] sync_page+0x40/0x50</span><br><span class="line">[&lt;ffffffff811315de&gt;] sync_page_killable+0xe/0x40</span><br><span class="line">[&lt;ffffffff811314e7&gt;] __lock_page_killable+0x67/0x70</span><br><span class="line">[&lt;ffffffff81133254&gt;] generic_file_aio_read+0x4c4/0x710</span><br><span class="line">[&lt;ffffffffa0b7f02c&gt;] ll_file_aio_read+0x1ec/0x4c0 [lustre]</span><br><span class="line">[&lt;ffffffffa0b8024a&gt;] ll_file_read+0x13a/0x270 [lustre]</span><br><span class="line">[&lt;ffffffff8119d927&gt;] vfs_read+0xb7/0x1a0</span><br><span class="line">[&lt;ffffffff8119dc71&gt;] sys_read+0x51/0xb0</span><br><span class="line">[&lt;ffffffff8155e375&gt;] system_call_fastpath+0x19/0x34</span><br><span class="line">[&lt;ffffffffffffffff&gt;] 0xffffffffffffffff</span><br><span class="line">--------</span><br><span class="line">[&lt;ffffffff811315c0&gt;] sync_page+0x40/0x50</span><br><span class="line">[&lt;ffffffff811315de&gt;] sync_page_killable+0xe/0x40</span><br><span class="line">[&lt;ffffffff811314e7&gt;] __lock_page_killable+0x67/0x70</span><br><span class="line">[&lt;ffffffff81133278&gt;] generic_file_aio_read+0x4e8/0x710</span><br><span class="line">[&lt;ffffffffa0bd0d52&gt;] vvp_io_read_start+0x302/0x570 [lustre]</span><br><span class="line">[&lt;ffffffffa073975a&gt;] cl_io_start+0x6a/0x140 [obdclass]</span><br><span class="line">[&lt;ffffffffa073c459&gt;] cl_io_loop+0x129/0xb20 [obdclass]</span><br><span class="line">[&lt;ffffffffa0b7e5d1&gt;] ll_file_io_generic+0x231/0xaa0 [lustre]</span><br><span class="line">[&lt;ffffffffa0b7f1e3&gt;] ll_file_aio_read+0x3a3/0x4c0 [lustre]</span><br><span class="line">[&lt;ffffffffa0b8024a&gt;] ll_file_read+0x13a/0x270 [lustre]</span><br><span class="line">[&lt;ffffffff8119d927&gt;] vfs_read+0xb7/0x1a0</span><br><span class="line">[&lt;ffffffff8119dc71&gt;] sys_read+0x51/0xb0</span><br><span class="line">[&lt;ffffffff8155e375&gt;] system_call_fastpath+0x19/0x34</span><br><span class="line">[&lt;ffffffffffffffff&gt;] 0xffffffffffffffff</span><br><span class="line">--------</span><br><span class="line">[&lt;ffffffff811315c0&gt;] sync_page+0x40/0x50</span><br><span class="line">[&lt;ffffffff811315de&gt;] sync_page_killable+0xe/0x40</span><br><span class="line">[&lt;ffffffff811314e7&gt;] __lock_page_killable+0x67/0x70</span><br><span class="line">[&lt;ffffffff81133254&gt;] generic_file_aio_read+0x4c4/0x710</span><br><span class="line">[&lt;ffffffffa0b7f02c&gt;] ll_file_aio_read+0x1ec/0x4c0 [lustre]</span><br><span class="line">[&lt;ffffffffa0b8024a&gt;] ll_file_read+0x13a/0x270 [lustre]</span><br><span class="line">[&lt;ffffffff8119d927&gt;] vfs_read+0xb7/0x1a0</span><br><span class="line">[&lt;ffffffff8119dc71&gt;] sys_read+0x51/0xb0</span><br><span class="line">[&lt;ffffffff8155e375&gt;] system_call_fastpath+0x19/0x34</span><br><span class="line">[&lt;ffffffffffffffff&gt;] 0xffffffffffffffff</span><br><span class="line">--------</span><br><span class="line">[&lt;ffffffffa0739d35&gt;] cl_sync_io_wait+0x2a5/0x380 [obdclass]</span><br><span class="line">[&lt;ffffffffa07386ae&gt;] cl_lock_request+0x1ce/0x200 [obdclass]</span><br><span class="line">[&lt;ffffffffa0bc9d13&gt;] cl_glimpse_lock+0x113/0x2b0 [lustre]</span><br><span class="line">[&lt;ffffffffa0bca097&gt;] cl_glimpse_size0+0x1e7/0x240 [lustre]</span><br><span class="line">[&lt;ffffffffa0b857cc&gt;] ll_getattr+0x31c/0x8a0 [lustre]</span><br><span class="line">[&lt;ffffffff811a2e44&gt;] vfs_getattr+0x54/0x90</span><br><span class="line">[&lt;ffffffff811a2ee4&gt;] vfs_fstatat+0x64/0xa0</span><br><span class="line">[&lt;ffffffff811a304b&gt;] vfs_stat+0x1b/0x20</span><br><span class="line">[&lt;ffffffff811a3074&gt;] sys_newstat+0x24/0x50</span><br><span class="line">[&lt;ffffffff8155e375&gt;] system_call_fastpath+0x19/0x34</span><br><span class="line">[&lt;ffffffffffffffff&gt;] 0xffffffffffffffff</span><br></pre></td></tr></table></figure>

<h3 id="Error-ICRC-ABRT-at-LBA-in-SATA-device"><a href="#Error-ICRC-ABRT-at-LBA-in-SATA-device" class="headerlink" title="Error: ICRC, ABRT at LBA in SATA device"></a>Error: ICRC, ABRT at LBA in SATA device</h3><p>zfs show a lot of check sum error<br>fix it by upgrade IO expander firmware</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Error 17 occurred at disk power-on lifetime: 1903 hours (79 days + 7 hours)</span><br><span class="line">  When the <span class="built_in">command</span> that caused the error occurred, the device was doing SMART Offline or Self-test.</span><br><span class="line"></span><br><span class="line">  After <span class="built_in">command</span> completion occurred, registers were:</span><br><span class="line">  ER ST SC SN CL CH DH</span><br><span class="line">  -- -- -- -- -- -- --</span><br><span class="line">  84 41 00 00 00 00 00  Error: ICRC, ABRT at LBA = 0x00000000 = 0</span><br><span class="line"></span><br><span class="line">  Commands leading to the <span class="built_in">command</span> that caused the error were:</span><br><span class="line">  CR FR SC SN CL CH DH DC   Powered_Up_Time  Command/Feature_Name</span><br><span class="line">  -- -- -- -- -- -- -- --  ----------------  --------------------</span><br><span class="line">  61 05 10 b2 8e 78 40 00  23d+05:55:53.717  WRITE FPDMA QUEUED</span><br><span class="line">  61 01 38 b1 8e 78 40 00  23d+05:55:53.716  WRITE FPDMA QUEUED</span><br><span class="line">  61 01 30 d9 8e 78 40 00  23d+05:55:53.716  WRITE FPDMA QUEUED</span><br><span class="line">  61 01 28 d8 8e 78 40 00  23d+05:55:53.716  WRITE FPDMA QUEUED</span><br><span class="line">  61 0a 20 68 ac 53 40 00  23d+05:55:53.715  WRITE FPDMA QUEUED</span><br><span class="line"></span><br><span class="line">  pool: tank</span><br><span class="line"> state: ONLINE</span><br><span class="line">status: One or more devices has experienced an unrecoverable error.  An</span><br><span class="line">	attempt was made to correct the error.  Applications are unaffected.</span><br><span class="line">action: Determine <span class="keyword">if</span> the device needs to be replaced, and clear the errors</span><br><span class="line">	using <span class="string">'zpool clear'</span> or replace the device with <span class="string">'zpool replace'</span>.</span><br><span class="line">   see: http://zfsonlinux.org/msg/ZFS-8000-9P</span><br><span class="line">  scan: scrub repaired 55.5K <span class="keyword">in</span> 11h11m with 0 errors on Mon Mar 18 09:57:08 2019</span><br><span class="line">config:</span><br><span class="line"></span><br><span class="line">	NAME        STATE     READ WRITE CKSUM</span><br><span class="line">	tank        ONLINE       0     0     0</span><br><span class="line">	  raidz3-0  ONLINE       0     0     0</span><br><span class="line">	    sdh     ONLINE       0     0    51</span><br><span class="line">	    sdi     ONLINE       0     0    13</span><br><span class="line">	    sdj     ONLINE       0     0    19</span><br><span class="line">	    sdk     ONLINE       0     0    10</span><br><span class="line">	    sdl     ONLINE       0     0    28</span><br><span class="line">	    sdm     ONLINE       0     0    39</span><br><span class="line">	    sdn     ONLINE       0     0    70</span><br><span class="line">	    sdo     ONLINE       0     0    25</span><br></pre></td></tr></table></figure>

<h3 id="Enable-TLER-ERC-CCTL-function-for-SATA-device"><a href="#Enable-TLER-ERC-CCTL-function-for-SATA-device" class="headerlink" title="Enable TLER/ERC/CCTL function for SATA device"></a>Enable TLER/ERC/CCTL function for SATA device</h3><p>Some vendor default value was disabled</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ smartctl -l scterc,70,70 /dev/sdab</span><br><span class="line">smartctl 6.5 2016-05-07 r4318 [x86_64-linux-3.10.0-957.el7_lustre.x86_64] (<span class="built_in">local</span> build)</span><br><span class="line">Copyright (C) 2002-16, Bruce Allen, Christian Franke, www.smartmontools.org</span><br><span class="line"></span><br><span class="line">SCT Error Recovery Control <span class="built_in">set</span> to:</span><br><span class="line">           Read:     70 (7.0 seconds)</span><br><span class="line">          Write:     70 (7.0 seconds)</span><br><span class="line"></span><br><span class="line">$ smartctl -l scterc /dev/sdab</span><br><span class="line">smartctl 6.5 2016-05-07 r4318 [x86_64-linux-3.10.0-957.el7_lustre.x86_64] (<span class="built_in">local</span> build)</span><br><span class="line">Copyright (C) 2002-16, Bruce Allen, Christian Franke, www.smartmontools.org</span><br><span class="line"></span><br><span class="line">SCT Error Recovery Control:</span><br><span class="line">           Read:     70 (7.0 seconds)</span><br><span class="line">          Write:     70 (7.0 seconds)</span><br></pre></td></tr></table></figure>


<h3 id="SAS-smart-status"><a href="#SAS-smart-status" class="headerlink" title="SAS smart status"></a>SAS smart status</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">20c20</span><br><span class="line">&lt; Local Time is:        Tue Jun  4 19:01:23 2019 CST</span><br><span class="line">---</span><br><span class="line">&gt; Local Time is:        Tue Jun  4 19:00:14 2019 CST</span><br><span class="line">39c39</span><br><span class="line">&lt;   Blocks sent to initiator = 30411897006194688</span><br><span class="line">---</span><br><span class="line">&gt;   Blocks sent to initiator = 30411894288285696</span><br><span class="line">45,46c45,46</span><br><span class="line">&lt; <span class="built_in">read</span>:          0  1074545         0   1813692   56373220      72544.663         180</span><br><span class="line">&lt; write:         0        1         0         3    4864356      42356.396           0</span><br><span class="line">---</span><br><span class="line">&gt; <span class="built_in">read</span>:          0  1074502         0   1813649   56371166      72544.656         180</span><br><span class="line">&gt; write:         0        1         0         3    4864355      42356.390           0</span><br><span class="line"></span><br><span class="line">Error counter <span class="built_in">log</span>:</span><br><span class="line">           Errors Corrected by           Total   Correction     Gigabytes    Total</span><br><span class="line">               ECC          rereads/    errors   algorithm      processed    uncorrected</span><br><span class="line">           fast | delayed   rewrites  corrected  invocations   [10^9 bytes]  errors</span><br><span class="line"><span class="built_in">read</span>:          0  1074545         0   1813692   56373220      72544.663         180</span><br><span class="line">write:         0        1         0         3    4864356      42356.396           0</span><br><span class="line">...</span><br><span class="line"><span class="built_in">read</span>:          0  1074502         0   1813649   56371166      72544.656         180</span><br><span class="line">write:         0        1         0         3    4864355      42356.390           0</span><br></pre></td></tr></table></figure>

<h3 id="replace-sas-devices"><a href="#replace-sas-devices" class="headerlink" title="replace sas devices"></a>replace sas devices</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">[Wed Jun  5 11:10:29 2019] sd 13:0:59:0: device_block, handle(0x0047)</span><br><span class="line">[Wed Jun  5 11:10:31 2019] sd 13:0:59:0: device_unblock and setting to running, handle(0x0047)</span><br><span class="line">[Wed Jun  5 11:10:31 2019] sd 13:0:59:0: [sdes] Synchronizing SCSI cache</span><br><span class="line">[Wed Jun  5 11:10:31 2019] sd 13:0:59:0: [sdes] Synchronize Cache(10) failed: Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># echo 1 &gt; delete</span></span><br><span class="line"></span><br><span class="line">[Wed Jun  5 11:10:31 2019] mpt3sas_cm2: removing handle(0x0047), sas_addr(0x5000cca2516f15ae)</span><br><span class="line">[Wed Jun  5 11:10:31 2019] mpt3sas_cm2: enclosure logical id(0x500304800928a0bf), slot(6)</span><br><span class="line">[Wed Jun  5 11:10:31 2019] mpt3sas_cm2: enclosure level(0x0001),connector name(     )</span><br><span class="line">[Wed Jun  5 11:13:50 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:13:50 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:13:50 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:51 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:13:51 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:13:51 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:51 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:51 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:52 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:13:52 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:13:52 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:52 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:52 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:53 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:13:53 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:13:53 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:53 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:53 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:54 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:13:54 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:13:54 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:54 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:54 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:55 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:13:55 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:13:55 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:55 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:55 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:56 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:13:56 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:13:56 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:56 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:56 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:57 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:13:57 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:13:57 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:57 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:57 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:58 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:13:58 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:13:58 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:58 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:58 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:59 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:13:59 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:13:59 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:59 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:13:59 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:00 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:14:00 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:14:00 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:00 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:00 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:01 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:14:01 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:14:01 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:01 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:01 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:02 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:14:02 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:14:02 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:02 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:02 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:03 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:14:03 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:14:03 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:03 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:03 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:04 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:14:04 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:14:04 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:04 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:04 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:05 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:14:05 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:14:06 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:14:06 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:14:06 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:06 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:06 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:07 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:14:07 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:14:07 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:07 2019] mpt3sas_cm2: START_UNIT: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:07 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:08 2019] mpt3sas_cm2: detecting: handle(0x0069), sas_address(0x5000cca2519ae8fe), phy(7)</span><br><span class="line">[Wed Jun  5 11:14:08 2019] mpt3sas_cm2: REPORT_LUNS: handle(0x0069), retries(0)</span><br><span class="line">[Wed Jun  5 11:14:08 2019] mpt3sas_cm2: TEST_UNIT_READY: handle(0x0069), lun(0)</span><br><span class="line">[Wed Jun  5 11:14:08 2019] scsi 13:0:93:0: Direct-Access     HGST     HUH721010AL5200  A21D PQ: 0 ANSI: 6</span><br><span class="line">[Wed Jun  5 11:14:08 2019] scsi 13:0:93:0: SSP: handle(0x0069), sas_addr(0x5000cca2519ae8fe), phy(7), device_name(0x5000cca2519ae8ff)</span><br><span class="line">[Wed Jun  5 11:14:08 2019] scsi 13:0:93:0: enclosure logical id(0x500304800928a0bf), slot(6)</span><br><span class="line">[Wed Jun  5 11:14:08 2019] scsi 13:0:93:0: enclosure level(0x0001), connector name(     )</span><br><span class="line">[Wed Jun  5 11:14:08 2019] scsi 13:0:93:0: serial_number(        7PJS61HC)</span><br><span class="line">[Wed Jun  5 11:14:08 2019] scsi 13:0:93:0: qdepth(254), tagged(1), simple(0), ordered(0), scsi_level(7), cmd_que(1)</span><br><span class="line">[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: Attached scsi generic sg154 <span class="built_in">type</span> 0</span><br><span class="line">[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: [sdes] 19532873728 512-byte logical blocks: (10.0 TB/9.09 TiB)</span><br><span class="line">[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: [sdes] 4096-byte physical blocks</span><br><span class="line">[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: [sdes] Write Protect is off</span><br><span class="line">[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: [sdes] Mode Sense: f7 00 10 08</span><br><span class="line">[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: [sdes] Write cache: enabled, <span class="built_in">read</span> cache: enabled, supports DPO and FUA</span><br><span class="line">[Wed Jun  5 11:14:09 2019]  sdes:</span><br><span class="line">[Wed Jun  5 11:14:09 2019] sd 13:0:93:0: [sdes] Attached SCSI disk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### zfs cksum error</span></span><br><span class="line"><span class="comment">#### Cache issue</span></span><br><span class="line">Some <span class="built_in">times</span> you could not found any errro from scsi, drvier, cable, hba, IO expander, smart check HDD is ok, no error</span><br><span class="line">Looks like smartctl -t long could not check SAS/SATA device <span class="built_in">read</span>/write cache</span><br><span class="line">If you <span class="built_in">disable</span> the device write cache, the cksum error is missing</span><br></pre></td></tr></table></figure>
<p>Dec 18 2019 03:34:03.733962748 ereport.fs.zfs.checksum<br>        class = “ereport.fs.zfs.checksum”<br>        ena = 0xe4ec5ccfb8a01001<br>        detector = (embedded nvlist)<br>                version = 0x0<br>                scheme = “zfs”<br>                pool = 0x2c8f99507dfa8d55<br>                vdev = 0x43a5020a3f617b3a<br>        (end detector)<br>        pool = “ost_48”<br>        pool_guid = 0x2c8f99507dfa8d55<br>        pool_state = 0x0<br>        pool_context = 0x0<br>        pool_failmode = “wait”<br>        vdev_guid = 0x43a5020a3f617b3a<br>        vdev_type = “disk”<br>        vdev_path = “/dev/disk/by-id/scsi-35000cca251b14e3c”<br>        vdev_ashift = 0xc<br>        vdev_complete_ts = 0x60e4ec5af404e<br>        vdev_delta_ts = 0xf254e8<br>        vdev_read_errors = 0x0<br>        vdev_write_errors = 0x0<br>        vdev_cksum_errors = 0x3865<br>        parent_guid = 0x7ed8241b267c55ce<br>        parent_type = “raidz”<br>        vdev_spare_paths =<br>        vdev_spare_guids =<br>        zio_err = 0x0<br>        zio_flags = 0x1008b0<br>        zio_stage = 0x100000<br>        zio_pipeline = 0xf80000<br>        zio_delay = 0x0<br>        zio_timestamp = 0x0<br>        zio_delta = 0x0<br>        zio_offset = 0x35b7ff04400<br>        zio_size = 0x2a00<br>        zio_objset = 0x2b<br>        zio_object = 0xd988<br>        zio_level = 0x0<br>        zio_blkid = 0x8654<br>        bad_ranges = 0x0 0x2a00<br>        bad_ranges_min_gap = 0x8<br>        bad_range_sets = 0x2956<br>        bad_range_clears = 0x855f<br>        bad_set_histogram = 0x76 0x7e 0xbc 0xc8 0xd6 0x9c 0xcc 0x96 0x6c 0x81 0xb0 0xce 0xd7 0x74 0xcb 0x8b 0x72 0x74 0xbe 0xcd 0xc6 0x92 0xb2 0x96 0x7a 0x93 0xc3 0xe1 0xd7 0x9b 0xce 0x88 0x7c 0x72 0xaa 0xdd 0xbe 0x86 0xbc 0x83 0x6d 0x74 0xcc 0xc2 0xc6 0x86 0xc1 0x87 0x74 0x8b 0xbe 0xc0 0xc2 0xa0 0xce 0x8c 0x73 0x8e 0xb3 0xe4 0xc8 0x8a 0xbc 0x9a<br>        bad_cleared_histogram = 0x253 0x242 0x1ff 0x1d8 0x1e5 0x233 0x1d9 0x22a 0x243 0x24b 0x20b 0x1f9 0x1dc 0x24b 0x1f7 0x23f 0x23c 0x25b 0x1fa 0x1db 0x1e9 0x223 0x1f7 0x20f 0x235 0x224 0x1ff 0x1ee 0x1d3 0x225 0x1fa 0x23b 0x253 0x271 0x20f 0x1ec 0x1e5 0x221 0x1fb 0x248 0x24e 0x228 0x1e7 0x1e0 0x1ed 0x24f 0x1f2 0x24f 0x264 0x22d 0x202 0x1e5 0x1ff 0x236 0x1ca 0x222 0x250 0x230 0x217 0x1e6 0x1d6 0x22b 0x1e7 0x238<br>        time = 0x5df92dab 0x2bbf61fc<br>        eid = 0x6ec1ab2</p>
<pre><code></code></pre>
    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/zfs/" rel="tag"><i class="fa fa-tag"></i> zfs</a>
              <a href="/tags/scsi/" rel="tag"><i class="fa fa-tag"></i> scsi</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/04/13/dell/" rel="prev" title="Dell command line in linux">
      <i class="fa fa-chevron-left"></i> Dell command line in linux
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/11/09/mdadm/" rel="next" title="mdadm tips">
      mdadm tips <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#About-SMR-HDD"><span class="nav-number">1.</span> <span class="nav-text">About SMR HDD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#I-don-‘t-think-it-‘s-the-MMP-issue-because-the-same-issue-in-OpenZFS-0-6-5-7"><span class="nav-number">2.</span> <span class="nav-text">I don ‘t think it ‘s the MMP issue, because the same issue in OpenZFS 0.6.5.7</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Reproduce-the-issue-and-my-work-experiences"><span class="nav-number">2.1.</span> <span class="nav-text">Reproduce the issue and my work experiences.</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Looks-like-MMP-will-cause-more-issues-on-zfs-0-7-9"><span class="nav-number">2.1.1.</span> <span class="nav-text">Looks like MMP will cause more issues on zfs 0.7.9</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Openzfs-issue"><span class="nav-number">2.2.</span> <span class="nav-text">Openzfs issue</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zpool-could-not-mount"><span class="nav-number">3.</span> <span class="nav-text">[zpool could not mount]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Replace-FX-parameter"><span class="nav-number">4.</span> <span class="nav-text">[Replace FX parameter]</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#very-dangerours"><span class="nav-number">4.1.</span> <span class="nav-text">very dangerours</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Import-zpool-hang-single-dev-just-respond-very-slow-cause-all-zpool-command-hang"><span class="nav-number">4.2.</span> <span class="nav-text">Import zpool hang, single dev just respond very slow cause all zpool command hang</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OpenZFS-multihost-writes-failed-about-Invalid-DWORD-count"><span class="nav-number">5.</span> <span class="nav-text">OpenZFS multihost writes failed (about Invalid DWORD count)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#For-Low-memroy-server"><span class="nav-number">6.</span> <span class="nav-text">For Low memroy server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zpool-could-not-be-import-because-single-HDD-failure-in-raidz3"><span class="nav-number">7.</span> <span class="nav-text">zpool could not be import because single HDD failure in raidz3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#I-guess-there-are-4-x-HDDs-could-read-zfs-metadata-in-this-zpool"><span class="nav-number">7.1.</span> <span class="nav-text">I guess there are 4 x HDDs could read zfs metadata in this zpool</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Ban-the-sddi"><span class="nav-number">7.2.</span> <span class="nav-text">Ban the sddi</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Single-HDD-hang-cause-LSI-HBA-reset-self"><span class="nav-number">8.</span> <span class="nav-text">Single HDD hang cause LSI HBA reset self</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-ICRC-ABRT-at-LBA-in-SATA-device"><span class="nav-number">9.</span> <span class="nav-text">Error: ICRC, ABRT at LBA in SATA device</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enable-TLER-ERC-CCTL-function-for-SATA-device"><span class="nav-number">10.</span> <span class="nav-text">Enable TLER&#x2F;ERC&#x2F;CCTL function for SATA device</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SAS-smart-status"><span class="nav-number">11.</span> <span class="nav-text">SAS smart status</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#replace-sas-devices"><span class="nav-number">12.</span> <span class="nav-text">replace sas devices</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ginger"
      src="/img/logo-4-blog.png">
  <p class="site-author-name" itemprop="name">Ginger</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">60</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ginger</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">752k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">11:23</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.6.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://b946c5a0bf547c89.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "http://yoursite.com/2017/09/26/openzfs-issues/",
            identifier: "2017/09/26/openzfs-issues/",
            title: "openzfs issues"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://b946c5a0bf547c89.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
